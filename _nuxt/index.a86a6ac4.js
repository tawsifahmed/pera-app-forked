import Ie from"./dropdown.esm.d38a9420.js";import Le from"./calendar.esm.1d193478.js";import Ae from"./button.esm.ab872eb1.js";import{a as Fe}from"./CreateCompany.152207a9.js";import{a2 as Me,a3 as O,$ as a,a5 as G,ar as J,b as c,i as o,l as n,u as m,e as D,F as Ue,f as Be,c as Ne,a as Oe,o as i,s as Re,k as ze,K as Ee,t as R,a8 as Ye,a9 as He,ca as We,an as qe}from"./entry.198ba3db.js";import{u as Ge}from"./fetch.53facc60.js";import{u as Je}from"./cookie.4537ecc8.js";import{u as Ke}from"./layout.46fababe.js";import{a as S}from"./usePermission.e4dc5c7d.js";import{u as K}from"./auth.d18feaee.js";import{u as X}from"./company.9b6106ad.js";import{u as Q}from"./workCompany.6a66780b.js";import Z from"./chart.esm.f6fafa8b.js";import"./baseicon.esm.9510ddf5.js";import"./basecomponent.esm.8266eeb3.js";import"./index.esm.d18f7c7e.js";import"./index.esm.3622bfba.js";import"./index.esm.b37bf06f.js";import"./index.esm.6bc1d8f1.js";import"./index.esm.428bbe49.js";import"./overlayeventbus.esm.97fbed22.js";import"./portal.esm.1155227e.js";import"./virtualscroller.esm.31157379.js";import"./index.esm.eb14047b.js";import"./index.esm.2e9e6151.js";import"./index.esm.277b7f6a.js";import"./badge.esm.ac3ed985.js";import"./inputtext.esm.426f9e47.js";import"./dialog.esm.88595072.js";const h=x=>(Ye("data-v-878ee643"),x=x(),He(),x),Xe={class:"grid"},Qe={key:0,class:"col-12 xl:col-6"},Ze={class:"card h-full"},et={class:"flex gap-2 align-items-center flex-wrap",style:{"padding-bottom":"10px"}},tt=h(()=>o("h5",{class:"mb-2"},"Tasks",-1)),lt={class:"flex gap-2 flex-wrap justify-content-end filter-container"},at={class:"mb-2 relative w-full md:w-8rem"},ot={class:"mb-2 relative w-full md:w-8rem"},st={class:"task-container"},nt={key:0,class:"flex justify-content-center align-items-center",style:{height:"22rem"}},rt=h(()=>o("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2.25rem"}},null,-1)),it=[rt],ct={key:1},ut=["onClick"],dt={class:"title-group"},pt={class:"title line-clamp-1",style:{"font-weight":"600"}},vt=h(()=>o("div",{style:{"background-color":"#00000040",height:"5px",width:"5px","border-radius":"15px"}},null,-1)),mt={class:"title-project line-clamp-1"},gt={style:{"font-size":"12px"}},ft={key:2},_t=h(()=>o("p",{class:"text-black text-lg text-center"},"No Tasks found!",-1)),ht=[_t],yt={class:"w-full flex justify-content-center"},bt={class:"col-12 xl:col-6"},Ct={class:"card h-full"},wt=h(()=>o("h5",null,"Tasks Statistics",-1)),Dt={class:"w-full flex justify-content-center"},St={class:"col-12 h-full"},xt={class:"card dashChart"},kt={class:"flex justify-content-between align-items-start dash-inf"},Pt={class:"flex align-items-center gap-3 dash-inf-left"},$t=h(()=>o("h5",{class:"mb-0"},"Projects Overview",-1)),Tt={class:"flex gap-2 flex-wrap dash-inf-right"},Vt={class:"chartWrapper"},jt={class:"chartAreaWrapper"},It={key:1},Lt={__name:"index",setup(x){Q();const{totalCompanies:At,totalProjects:ee}=O(Q()),te=We(),{getChartData:le,getTaskAssignModalData:ae,getRoles:oe,getTagsAssignModalData:se}=X(),{chartProjectInfo:ne,inProgressCnt:re,chartClosedTaskInfo:ie,totalDashboardProjects:ce,completedTasksChartData:ue,inProgressTasksChartData:de,unAssignedTasksChartData:pe,users:Ft,rolesLists:Mt,tags:Ut}=O(X());K(),O(K()),a(S("read_user")),a(S("read_role")),a(S("read_tags"));const ve=a(S("read_task"));a(S("create_company"));const{isDarkTheme:me}=Ke();a(null);const ge=a({labels:ne,datasets:[{label:"In Progress",data:re,fill:!1,backgroundColor:"#6366f1",borderColor:"#6366f1",tension:.4},{label:"Completed",data:ie,fill:!1,backgroundColor:"#2f4860",borderColor:"#2f4860",tension:.4}]});G(()=>{z.value=ye(),E.value=be()});const z=a(),E=a();let fe=localStorage.getItem("completedTasksChartData"),_e=localStorage.getItem("inProgressTasksChartData"),he=localStorage.getItem("unAssignedTasksChartData");const ye=()=>{const t=getComputedStyle(document.body);return{labels:["Completed","In Progress","Unassigned"],datasets:[{data:[fe,_e,he],backgroundColor:[t.getPropertyValue("--cyan-500"),t.getPropertyValue("--orange-500"),t.getPropertyValue("--gray-500")],hoverBackgroundColor:[t.getPropertyValue("--cyan-400"),t.getPropertyValue("--orange-400"),t.getPropertyValue("--gray-400")]}]}},be=()=>({plugins:{legend:{labels:{usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")}}}}),y=a([]);a([{label:"Add New",icon:"pi pi-fw pi-plus"},{label:"Remove",icon:"pi pi-fw pi-minus"}]);const A=a(null),k=a(!1),P=a(null),Ce=()=>{var t;P.value=JSON.parse(localStorage.getItem("userCompany")),console.log("hasUserCompany =>",P.value),P.value===null||((t=P.value)==null?void 0:t.length)==0?k.value=!0:k.value=!1,console.log("visibleCreateCompany =>",k.value)},we=()=>{A.value={plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}},De=()=>{A.value={plugins:{legend:{labels:{color:"#ebedef"}}},scales:{x:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}},y:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}}}}},u=a(),Y=a(),H=a(),g=a(),f=a(),$=a(!1),T=a(!1),F=a(!1);J(u,t=>{var e,s;Y.value=[{name:"All",id:""},...((s=(e=u.value)==null?void 0:e.statuses)==null?void 0:s.map(d=>({name:d.name,id:d.id})))||[]]});const b=a(),V=a(),j=a(),M=a(),C=a(),W=a(1);let p=a(1);const v=async()=>{V.value=u.value?u.value.id:"",j.value=b.value?b.value.id:"",M.value=g.value,C.value=f.value,B?p.value++:p.value=1,W.value=p.value,I.value=0,U(V.value,j.value,M.value,C.value,W.value),B=!1},Se=t=>{$.value=!0;const e=new Date(t);g.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},xe=t=>{T.value=!0;const e=new Date(t);f.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},ke=()=>{$.value=!1,g.value="",C.value="",v()},Pe=()=>{T.value=!1,f.value="",C.value="",v()},$e=()=>{if(u.value||H.value||g.value||f.value||p.value>1)u.value="",H.value="",g.value="",f.value="",V.value="",j.value="",b.value="",T.value=!1,$.value=!1,v();else return},Te=async t=>{const e=localStorage.getItem("userCompany");console.log("Task click: ",t),await qe({path:`/companies/${e}/spaces/${t==null?void 0:t.space_id}/projects/${t==null?void 0:t.project_id}`,query:{task_key:t.id}})},Ve=t=>{const e=t,s=new Date(e),d=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0");return`${String(s.getDate()).padStart(2,"0")}-${r}-${d}`},I=a(0),q=a(!1),w=a(!1),je=async t=>{t==="hide-loader"&&(q.value=!0),w.value=!0,p.value++,await U(V.value,j.value,M.value,C.value,p.value)},U=async(t="",e="",s="",d="",r=1)=>{var L;q.value||(F.value=!0),console.log("status",e);try{const l=Je("token"),{data:_,pending:Bt,error:Nt}=await Ge(`${te.public.apiUrl}/tasks/list?start_due_date=${s}&end_due_date=${d}&status=${e}&project_id=${t}&limit=30&page=${r}`,{method:"GET",headers:{Authorization:`Bearer ${l.value}`}},"$PslAyef5YX");_.value&&_.value.data&&((L=_.value.counts)!=null&&L.total_tasks)?(I.value=Math.ceil(_.value.counts.total_tasks/30),y.value=r===1?_.value.data:[...y.value,..._.value.data],w.value=!1):(y.value=[],w.value=!1)}catch(l){console.log(l),w.value=!1}finally{F.value=!1}};let B=!1;return window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:e,clientHeight:s}=document.documentElement;t+s>=e-50&&p.value<I&&(B=!0,v())}),U(),G(()=>{oe(),ae(),se(),le(),Ce()}),J(me,t=>{t?De():we()},{immediate:!0}),(t,e)=>{const s=Ie,d=Le,r=Ae,N=Fe,L=Oe("tooltip");return i(),c("div",Xe,[ve.value?(i(),c("div",Qe,[o("div",Ze,[o("div",et,[tt,o("div",lt,[n(s,{onChange:e[0]||(e[0]=l=>v()),modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),options:m(ee),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Project",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options"]),n(s,{onChange:e[2]||(e[2]=l=>v()),modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),options:Y.value,disabled:!u.value,optionLabel:"name",placeholder:"Select Status",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options","disabled"]),o("div",at,[n(d,{onDateSelect:e[4]||(e[4]=l=>Se(l)),modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=l=>g.value=l),placeholder:"Start Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),$.value?(i(),c("p",{key:0,onClick:ke,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),o("div",ot,[n(d,{onDateSelect:e[6]||(e[6]=l=>xe(l)),modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=l=>f.value=l),placeholder:"Due Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),T.value?(i(),c("p",{key:0,onClick:Pe,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),n(r,{onClick:$e,label:"Reset",class:"mb-2",severity:"secondary"})])]),o("div",st,[F.value?(i(),c("div",nt,it)):y.value.length>0?(i(),c("div",ct,[(i(!0),c(Ue,null,Be(y.value,l=>(i(),c("div",{key:l.id,onClick:()=>Te(l),class:"task-card"},[o("div",dt,[Re(o("div",{class:ze("status"),style:Ee(`background-color: ${l==null?void 0:l.status_color};`)},null,4),[[L,{value:`Status: ${l.status_name}`},void 0,{left:!0}]]),o("p",pt,R(l==null?void 0:l.name),1),vt,o("p",mt,R(l==null?void 0:l.project_name),1)]),o("div",null,[o("p",gt,"Due: "+R(l.due_date?Ve(l==null?void 0:l.due_date):"Not Set"),1)])],8,ut))),128))])):(i(),c("div",ft,ht)),o("div",yt,[m(p)<I.value?(i(),Ne(r,{key:0,onClick:e[8]||(e[8]=l=>je("hide-loader")),loading:w.value,label:"Load More",severity:"secondary"},null,8,["loading"])):D("",!0)])])])])):D("",!0),o("div",bt,[o("div",Ct,[wt,o("div",Dt,[n(m(Z),{type:"pie",data:z.value,options:E.value,class:"w-full md:w-30rem"},null,8,["data","options"])])])]),o("div",St,[o("div",xt,[o("div",kt,[o("div",Pt,[$t,n(r,{class:"nwrp",label:`Total Projects: ${m(ce)}`,severity:"secondary"},null,8,["label"])]),o("div",Tt,[n(r,{class:"nwrp",label:`In Progress: ${m(de)}`,severity:"info",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Unassigned: ${m(pe)}`,severity:"help",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Completed: ${m(ue)}`,severity:"contrast",outlined:""},null,8,["label"])])]),o("div",Vt,[o("div",jt,[n(m(Z),{type:"bar",data:ge.value,options:A.value},null,8,["data","options"])])])])]),k.value?(i(),c("div",It,[n(N)])):D("",!0)])}}},gl=Me(Lt,[["__scopeId","data-v-878ee643"]]);export{gl as default};
