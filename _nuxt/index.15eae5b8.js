import Ie from"./dropdown.esm.88881cd6.js";import Le from"./calendar.esm.24eba8c3.js";import Ae from"./button.esm.6289413f.js";import{a as Fe}from"./CreateCompany.42b56d8b.js";import{a2 as Me,a5 as O,$ as l,a7 as G,ar as J,b as c,i as a,l as n,u as m,e as D,F as Ue,f as Be,c as Ne,a as Oe,o as i,s as Re,k as ze,K as Ee,t as R,a3 as Ye,a4 as He,ca as We,an as qe}from"./entry.98b7e0bb.js";import{u as Ge}from"./fetch.a9118f92.js";import{u as Je}from"./cookie.a532e10e.js";import{u as Ke}from"./layout.72058563.js";import{a as S}from"./usePermission.65c9d539.js";import{u as K}from"./auth.da154401.js";import{u as X}from"./company.c53b5196.js";import{u as Q}from"./workCompany.f4e886d5.js";import Z from"./chart.esm.26706567.js";import"./baseicon.esm.623cedf9.js";import"./basecomponent.esm.cced9ad3.js";import"./index.esm.d44ff1a2.js";import"./index.esm.f152d981.js";import"./index.esm.6a4471bc.js";import"./index.esm.a1ec4135.js";import"./index.esm.69bae774.js";import"./overlayeventbus.esm.c04a2fc7.js";import"./portal.esm.26dcef28.js";import"./virtualscroller.esm.eb200c0e.js";import"./index.esm.b32ba167.js";import"./index.esm.776e1c02.js";import"./index.esm.96c298b4.js";import"./badge.esm.5405b223.js";import"./inputtext.esm.bffcfa87.js";import"./dialog.esm.4250b180.js";const h=x=>(Ye("data-v-7dbb6864"),x=x(),He(),x),Xe={class:"grid"},Qe={key:0,class:"col-12 xl:col-6"},Ze={class:"card h-full"},et={class:"flex gap-2 align-items-center flex-wrap",style:{"padding-bottom":"10px"}},tt=h(()=>a("h5",{class:"mb-2"},"Tasks",-1)),lt={class:"flex gap-2 flex-wrap justify-content-end filter-container"},at={class:"mb-2 relative w-full md:w-8rem"},st={class:"mb-2 relative w-full md:w-8rem"},ot={class:"task-container"},nt={key:0,class:"flex justify-content-center align-items-center",style:{height:"22rem"}},rt=h(()=>a("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2.25rem"}},null,-1)),it=[rt],ct={key:1},ut=["onClick"],dt={class:"title-group"},pt={class:"title line-clamp-1",style:{"font-weight":"600"}},vt=h(()=>a("div",{style:{"background-color":"#00000040",height:"5px",width:"5px","border-radius":"15px"}},null,-1)),mt={class:"title-project line-clamp-1"},ft={style:{"font-size":"12px"}},_t={key:2},gt=h(()=>a("p",{class:"text-black text-lg text-center"},"No Tasks found!",-1)),ht=[gt],yt={class:"w-full flex justify-content-center"},bt={class:"col-12 xl:col-6"},Ct={class:"card h-full"},wt=h(()=>a("h5",null,"Tasks Statistics",-1)),Dt={class:"w-full flex justify-content-center"},St={class:"col-12 h-full"},xt={class:"card dashChart"},kt={class:"flex justify-content-between align-items-start dash-inf"},$t={class:"flex align-items-center gap-3 dash-inf-left"},Tt=h(()=>a("h5",{class:"mb-0"},"Projects Overview",-1)),Pt={class:"flex gap-2 flex-wrap dash-inf-right"},jt={class:"chartWrapper"},Vt={class:"chartAreaWrapper"},It={key:1},Lt={__name:"index",setup(x){Q();const{totalCompanies:At,totalProjects:ee}=O(Q()),te=We(),{getChartData:le,getTaskAssignModalData:ae,getRoles:se,getTagsAssignModalData:oe}=X(),{chartProjectInfo:ne,inProgressCnt:re,chartClosedTaskInfo:ie,totalDashboardProjects:ce,completedTasksChartData:ue,inProgressTasksChartData:de,unAssignedTasksChartData:pe,users:Ft,rolesLists:Mt,tags:Ut}=O(X());K(),O(K()),l(S("read_user")),l(S("read_role")),l(S("read_tags"));const ve=l(S("read_task"));l(S("create_company"));const{isDarkTheme:me}=Ke();l(null);const fe=l({labels:ne,datasets:[{label:"In Progress",data:re,fill:!1,backgroundColor:"#6366f1",borderColor:"#6366f1",tension:.4},{label:"Completed",data:ie,fill:!1,backgroundColor:"#2f4860",borderColor:"#2f4860",tension:.4}]});G(()=>{z.value=ye(),E.value=be()});const z=l(),E=l();let _e=localStorage.getItem("completedTasksChartData"),ge=localStorage.getItem("inProgressTasksChartData"),he=localStorage.getItem("unAssignedTasksChartData");const ye=()=>(getComputedStyle(document.body),{labels:["Completed","In Progress","Unassigned"],datasets:[{data:[_e,ge,he],backgroundColor:["#33bd7c","#0ea5e9","#475569"],hoverBackgroundColor:["#1a8251","#0087c3","#2c3644"]}]}),be=()=>({plugins:{legend:{labels:{usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")}}}}),y=l([]);l([{label:"Add New",icon:"pi pi-fw pi-plus"},{label:"Remove",icon:"pi pi-fw pi-minus"}]);const A=l(null),k=l(!1),$=l(null),Ce=()=>{var s;$.value=JSON.parse(localStorage.getItem("userCompany")),console.log("hasUserCompany =>",$.value),$.value===null||((s=$.value)==null?void 0:s.length)==0?k.value=!0:k.value=!1,console.log("visibleCreateCompany =>",k.value)},we=()=>{A.value={plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}},De=()=>{A.value={plugins:{legend:{labels:{color:"#ebedef"}}},scales:{x:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}},y:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}}}}},u=l(),Y=l(),H=l(),f=l(),_=l(),T=l(!1),P=l(!1),F=l(!1);J(u,s=>{var e,o;Y.value=[{name:"All",id:""},...((o=(e=u.value)==null?void 0:e.statuses)==null?void 0:o.map(d=>({name:d.name,id:d.id})))||[]]});const b=l(),j=l(),V=l(),M=l(),C=l(),W=l(1);let p=l(1);const v=async()=>{j.value=u.value?u.value.id:"",V.value=b.value?b.value.id:"",M.value=f.value,C.value=_.value,B?p.value++:p.value=1,W.value=p.value,I.value=0,U(j.value,V.value,M.value,C.value,W.value),B=!1},Se=s=>{T.value=!0;const e=new Date(s);f.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},xe=s=>{P.value=!0;const e=new Date(s);_.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},ke=()=>{T.value=!1,f.value="",C.value="",v()},$e=()=>{P.value=!1,_.value="",C.value="",v()},Te=()=>{if(u.value||H.value||f.value||_.value||p.value>1)u.value="",H.value="",f.value="",_.value="",j.value="",V.value="",b.value="",P.value=!1,T.value=!1,v();else return},Pe=async s=>{const e=localStorage.getItem("userCompany");console.log("Task click: ",s),await qe({path:`/companies/${e}/spaces/${s==null?void 0:s.space_id}/projects/${s==null?void 0:s.project_id}`,query:{task_key:s.id}})},je=s=>{const e=s,o=new Date(e),d=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0");return`${String(o.getDate()).padStart(2,"0")}-${r}-${d}`},I=l(0),q=l(!1),w=l(!1),Ve=async s=>{s==="hide-loader"&&(q.value=!0),w.value=!0,p.value++,await U(j.value,V.value,M.value,C.value,p.value)},U=async(s="",e="",o="",d="",r=1)=>{var L;q.value||(F.value=!0),console.log("status",e);try{const t=Je("token"),{data:g,pending:Bt,error:Nt}=await Ge(`${te.public.apiUrl}/tasks/list?start_due_date=${o}&end_due_date=${d}&status=${e}&project_id=${s}&limit=30&page=${r}`,{method:"GET",headers:{Authorization:`Bearer ${t.value}`}},"$PslAyef5YX");g.value&&g.value.data&&((L=g.value.counts)!=null&&L.total_tasks)?(I.value=Math.ceil(g.value.counts.total_tasks/30),y.value=r===1?g.value.data:[...y.value,...g.value.data],w.value=!1):(y.value=[],w.value=!1)}catch(t){console.log(t),w.value=!1}finally{F.value=!1}};let B=!1;return window.addEventListener("scroll",()=>{const{scrollTop:s,scrollHeight:e,clientHeight:o}=document.documentElement;s+o>=e-50&&p.value<I&&(B=!0,v())}),U(),G(()=>{se(),ae(),oe(),le(),Ce()}),J(me,s=>{s?De():we()},{immediate:!0}),(s,e)=>{const o=Ie,d=Le,r=Ae,N=Fe,L=Oe("tooltip");return i(),c("div",Xe,[ve.value?(i(),c("div",Qe,[a("div",Ze,[a("div",et,[tt,a("div",lt,[n(o,{onChange:e[0]||(e[0]=t=>v()),modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),options:m(ee),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Project",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options"]),n(o,{onChange:e[2]||(e[2]=t=>v()),modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),options:Y.value,disabled:!u.value,optionLabel:"name",placeholder:"Status",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options","disabled"]),a("div",at,[n(d,{onDateSelect:e[4]||(e[4]=t=>Se(t)),modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=t=>f.value=t),placeholder:"Start Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),T.value?(i(),c("p",{key:0,onClick:ke,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),a("div",st,[n(d,{onDateSelect:e[6]||(e[6]=t=>xe(t)),modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),placeholder:"Due Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),P.value?(i(),c("p",{key:0,onClick:$e,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),n(r,{onClick:Te,label:"Reset",class:"mb-2",severity:"secondary"})])]),a("div",ot,[F.value?(i(),c("div",nt,it)):y.value.length>0?(i(),c("div",ct,[(i(!0),c(Ue,null,Be(y.value,t=>(i(),c("div",{key:t.id,onClick:()=>Pe(t),class:"task-card"},[a("div",dt,[Re(a("div",{class:ze("status"),style:Ee(`background-color: ${t==null?void 0:t.status_color};`)},null,4),[[L,{value:`Status: ${t.status_name}`},void 0,{left:!0}]]),a("p",pt,R(t==null?void 0:t.name),1),vt,a("p",mt,R(t==null?void 0:t.project_name),1)]),a("div",null,[a("p",ft,"Due: "+R(t.due_date?je(t==null?void 0:t.due_date):"Not Set"),1)])],8,ut))),128))])):(i(),c("div",_t,ht)),a("div",yt,[m(p)<I.value?(i(),Ne(r,{key:0,onClick:e[8]||(e[8]=t=>Ve("hide-loader")),loading:w.value,label:"Load More",severity:"secondary"},null,8,["loading"])):D("",!0)])])])])):D("",!0),a("div",bt,[a("div",Ct,[wt,a("div",Dt,[n(m(Z),{type:"pie",data:z.value,options:E.value,class:"w-full md:w-30rem"},null,8,["data","options"])])])]),a("div",St,[a("div",xt,[a("div",kt,[a("div",$t,[Tt,n(r,{class:"nwrp",label:`Total Projects: ${m(ce)}`,severity:"secondary"},null,8,["label"])]),a("div",Pt,[n(r,{class:"nwrp",label:`In Progress: ${m(de)}`,severity:"info",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Unassigned: ${m(pe)}`,severity:"help",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Completed: ${m(ue)}`,severity:"contrast",outlined:""},null,8,["label"])])]),a("div",jt,[a("div",Vt,[n(m(Z),{type:"bar",data:fe.value,options:A.value},null,8,["data","options"])])])])]),k.value?(i(),c("div",It,[n(N)])):D("",!0)])}}},fl=Me(Lt,[["__scopeId","data-v-7dbb6864"]]);export{fl as default};
