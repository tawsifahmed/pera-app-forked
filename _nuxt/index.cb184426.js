import ue from"./toast.esm.d27a7706.js";import J from"./button.esm.d894c6b9.js";import ce from"./inputicon.esm.f4d7d1c8.js";import Q from"./inputtext.esm.82c47927.js";import me from"./iconfield.esm.dfb55232.js";import pe from"./toolbar.esm.bd897502.js";import ve from"./progressspinner.esm.13b54962.js";import ae from"./checkbox.esm.55face87.js";import ie from"./divider.esm.d65c8185.js";import{a4 as Z,$ as r,a5 as ee,a6 as ne,o as v,b as g,i as e,l as n,u as t,a7 as R,F as D,f as A,t as O,q as K,ca as te,a2 as fe,ar as _e,a8 as he,a9 as ye,w as x,e as G,P as ge,c as Y,bO as be}from"./entry.b05169bb.js";import{u as re}from"./fetch.c151ceb9.js";import{u as q,a as se}from"./cookie.416e135a.js";import z from"./column.esm.88ba1349.js";import xe from"./datatable.esm.39423859.js";import{a as H}from"./usePermission.d6b0f011.js";import oe from"./dialog.esm.f07ad18a.js";import"./portal.esm.39565f33.js";import"./basecomponent.esm.6e390554.js";import"./index.esm.db346f38.js";import"./baseicon.esm.f83ecc40.js";import"./index.esm.aec58548.js";import"./index.esm.779f875b.js";import"./index.esm.0fba9862.js";import"./badge.esm.0b5611e9.js";import"./index.esm.0efc0dbe.js";import"./paginator.esm.28b7d602.js";import"./index.esm.ae1bfc83.js";import"./dropdown.esm.4392c331.js";import"./index.esm.b72c07a4.js";import"./index.esm.bf42e7c6.js";import"./overlayeventbus.esm.73a94089.js";import"./virtualscroller.esm.45a8e57c.js";import"./inputnumber.esm.0cb23e22.js";import"./index.esm.8c31c9ce.js";import"./index.esm.46c2c759.js";import"./index.esm.173b6d2a.js";import"./index.esm.7f7895ab.js";import"./index.esm.e278a9df.js";import"./radiobutton.esm.4d40a8ff.js";import"./index.esm.cbede32b.js";import"./index.esm.3e191ac1.js";const $e={class:"field"},Ce=e("label",{for:"company"},[K("Role Name"),e("i",{class:"text-red-400 text-italic"},"*")],-1),we=e("div",{class:"mb-3"},[e("label",null,[K("Permissions"),e("i",{class:"text-red-400 text-italic"},"*")])],-1),ke={class:"groupPer-container mb-3"},Pe={class:"flex align-items-start justify-content-between w-full mb-3"},Re={class:"flex justify-content-start",style:{width:"50%"}},Ve={class:"group-selection"},Se=["for"],Ie={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},Ee=["for"],Ne={class:"create-btn-wrapper mb-0"},Te={__name:"CreateRole",props:{param:{type:Object,required:!0}},emits:["closeCreateModal"],setup(V,{emit:B}){const j=te(),k=V,h=Z(),p=r(""),b=r(k.param.groupPermissions),u=r([]),o=r([]),f=r(!0),$=B,I=c=>{const l=c.group.id,i=c.children.map(s=>s.id);o.value.includes(l)?u.value=[...new Set([...u.value,...i])]:u.value=u.value.filter(s=>!i.includes(s))},M=c=>{c.children.map(s=>s.id).every(s=>u.value.includes(s))?o.value.includes(c.group.id)||o.value.push(c.group.id):o.value=o.value.filter(s=>s!==c.group.id)},F=async()=>{var c;if(p.value===""){h.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(u.value.length===0){h.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(p.value===""&&u.value.length===0){h.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{const l=q("token"),{data:i,pending:s}=await re(`${j.public.apiUrl}/roles/create`,{method:"POST",headers:{Authorization:`Bearer ${l.value}`},body:{name:p.value,permissions:u.value}},"$lLTkTCcXoV");((c=i.value)==null?void 0:c.code)===201?(p.value=null,f.value=!1,$("closeCreateModal",!1),h.add({severity:"success",summary:"Success",detail:"Role Created successfully!",group:"br",life:3e3})):h.add({severity:"error",summary:"Error",detail:"Role Creation Failed!",group:"br",life:3e3})}};return ee(()=>{const c=document.getElementById("createRoleName");ne(()=>{c&&c.focus()})}),(c,l)=>{const i=Q,s=ae,C=ie,S=J;return v(),g("div",null,[e("div",$e,[Ce,n(i,{id:"createRoleName",modelValue:t(p),"onUpdate:modelValue":l[0]||(l[0]=y=>R(p)?p.value=y:null),class:"w-full",placeholder:"Enter role name"},null,8,["modelValue"])]),we,e("div",ke,[(v(!0),g(D,null,A(t(b),y=>(v(),g("div",{key:y.group.id},[e("div",Pe,[e("div",Re,[e("div",Ve,[n(s,{modelValue:t(o),"onUpdate:modelValue":l[1]||(l[1]=m=>R(o)?o.value=m:null),inputId:"group-"+y.group.id,value:y.group.id,onChange:m=>I(y)},null,8,["modelValue","inputId","value","onChange"]),e("label",{class:"grp-title ml-2",for:"group-"+y.group.id},O(y.group.name),9,Se)])]),e("div",Ie,[(v(!0),g(D,null,A(y.children,m=>(v(),g("div",{key:m.id,class:"flex align-items-center"},[n(s,{modelValue:t(u),"onUpdate:modelValue":l[2]||(l[2]=a=>R(u)?u.value=a:null),inputId:m.id,value:m.id,onChange:a=>M(y)},null,8,["modelValue","inputId","value","onChange"]),e("label",{for:m.id,class:"ml-2"},O(m.name),9,Ee)]))),128))])]),n(C)]))),128))]),e("div",Ne,[n(S,{label:"Save",icon:"pi pi-check",text:"",onClick:F})])])}}};const de=V=>(he("data-v-f82efc06"),V=V(),ye(),V),Ue={class:"field"},Be=de(()=>e("label",{for:"company"},[K("Role Name"),e("i",{class:"text-red-400 text-italic"},"*")],-1)),Me=de(()=>e("div",{class:"mb-3"},[e("label",null,[K("Permissions"),e("i",{class:"text-red-400 text-italic"},"*")])],-1)),Fe={class:"groupPer-container mb-3"},Le={class:"flex align-items-start justify-content-between w-full mb-3"},je={class:"flex justify-content-start",style:{width:"50%"}},De={class:"group-selection"},Ae={class:"grp-title ml-2"},Oe={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},We=["for"],Ge={class:"create-btn-wrappe"},ze={__name:"EditRole",props:{param:{type:Object,required:!0}},emits:["closeEditModal"],setup(V,{emit:B}){const j=te(),k=V,h=Z(),p=r(k.param.id),b=r(k.param.name);r(k.param.permissionsList);const u=r(k.param.groupPermissions),o=r(k.param.slctdPermissions||[]),f=r([]),$=r(!0),I=B,M=()=>{u.value.forEach(l=>{l.children.every(s=>o.value.includes(s.id))&&f.value.push(l.group.id)})},F=l=>{const i=l.children.map(s=>s.id);f.value.includes(l.group.id)?o.value=[...new Set([...o.value,...i])]:o.value=o.value.filter(s=>!i.includes(s))};_e(o,()=>{u.value.forEach(l=>{const i=l.children.every(s=>o.value.includes(s.id));i&&!f.value.includes(l.group.id)?f.value.push(l.group.id):!i&&f.value.includes(l.group.id)&&(f.value=f.value.filter(s=>s!==l.group.id))})});const c=async()=>{var l;if(b.value===""){h.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(o.value.length===0){h.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(b.value===""&&o.value.length===0){h.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{const i=q("token"),{data:s,pending:C}=await re(`${j.public.apiUrl}/roles/update/${p.value}`,{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:{name:b.value,permissions:o.value}},"$AftFLbfnYe");((l=s.value)==null?void 0:l.code)===200?($.value=!1,I("closeEditModal",!1),h.add({severity:"success",summary:"Success",detail:"Role updated successfully!",group:"br",life:3e3})):h.add({severity:"error",summary:"Error",detail:"Failed to update role!",group:"br",life:3e3})}};return ee(async()=>{M();const l=document.getElementById("editTeamName");ne(()=>{l&&l.focus()})}),(l,i)=>{const s=Q,C=ae,S=ie,y=J;return v(),g("div",null,[e("div",Ue,[Be,n(s,{id:"editTeamName",modelValue:t(b),"onUpdate:modelValue":i[0]||(i[0]=m=>R(b)?b.value=m:null),class:"w-full",placeholder:"Edit role name"},null,8,["modelValue"])]),Me,e("div",Fe,[(v(!0),g(D,null,A(t(u),m=>(v(),g("div",{key:m.group.id},[e("div",Le,[e("div",je,[e("div",De,[n(C,{modelValue:t(f),"onUpdate:modelValue":i[1]||(i[1]=a=>R(f)?f.value=a:null),value:m.group.id,onChange:a=>F(m)},null,8,["modelValue","value","onChange"]),e("label",Ae,O(m.group.name),1)])]),e("div",Oe,[(v(!0),g(D,null,A(m.children,a=>(v(),g("div",{key:a.id,class:"flex align-items-center"},[n(C,{modelValue:t(o),"onUpdate:modelValue":i[2]||(i[2]=d=>R(o)?o.value=d:null),inputId:a.id,value:a.id},null,8,["modelValue","inputId","value"]),e("label",{for:a.id,class:"ml-2"},O(a.name),9,We)]))),128))])]),n(S)]))),128))]),e("div",Ge,[n(y,{label:"Update",icon:"pi pi-check",text:"",onClick:c})])])}}},qe=fe(ze,[["__scopeId","data-v-f82efc06"]]);const Ke={key:0,class:"card"},Xe=e("div",{class:"d-flex mr-2"},[e("h5",{class:"mb-1"},"User Role")],-1),Ye=e("i",{class:"pi pi-search"},null,-1),He=e("p",{class:"text-center"},"No Data found...",-1),Je={style:{display:"flex","flex-wrap":"wrap",gap:"5px"}},jt={__name:"index",setup(V){const B=te(),j=r(H("read_role")),k=r(H("create_role")),h=r(H("update_role")),p=r(),b=r(!0);Z();const u=r(!1),o=r(!1),f=r([]),$=r([]),I=r([]),M=r(""),F=r(""),c=a=>{u.value=!1,C()},l=a=>{o.value=!1,C()},i=()=>{u.value=!0,C()},s=a=>{var L;o.value=!0,M.value=a.id,F.value=a.name,$.value=$.value;let d=[];((L=a==null?void 0:a.permissions)==null?void 0:L.length)>0&&a.permissions.map(P=>{$.value.map(w=>{P.id===w.id&&d.push({id:w.id})})}),I.value=d.map(P=>P.id),console.log("sPp",be(I.value))},C=async()=>{var w,E,N;const a=q("token"),{data:d,pending:L,error:P}=await se("roleList",()=>$fetch(`${B.public.apiUrl}/roles/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((E=(w=d.value)==null?void 0:w.data)==null?void 0:E.length)>0&&(f.value=(N=d.value)==null?void 0:N.data.map((T,U)=>({...T,index:U+1})))},S=r([]),y=async()=>{var w,E,N;const a=q("token"),{data:d,pending:L,error:P}=await se("permissionList",()=>$fetch(`${B.public.apiUrl}/permissions/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((E=(w=d.value)==null?void 0:w.data)==null?void 0:E.length)>0&&($.value=(N=d.value)==null?void 0:N.data.map((T,U)=>({...T,index:U+1})),S.value=Object.entries(d.value.group).map(([T,U],X)=>({group:{name:T,id:X+1},children:U.map(W=>({id:W.id,name:W.name}))})),console.log(S.value))},m=()=>{p.value={global:{value:null,matchMode:ge.CONTAINS}}};return ee(()=>{C(),y(),b.value=!1}),m(),(a,d)=>{const L=ue,P=J,w=ce,E=Q,N=me,T=pe,U=ve,X=Te,W=qe;return t(j)?(v(),g("div",Ke,[n(L,{position:"bottom-right",group:"br"}),Xe,n(T,{class:"border-0 px-0"},{start:x(()=>[t(k)?(v(),Y(P,{key:0,icon:"pi pi-plus",label:"Create",onClick:i,class:"mr-2",severity:"secondary"})):G("",!0)]),end:x(()=>[n(N,{iconPosition:"right",raised:""},{default:x(()=>[n(w,null,{default:x(()=>[Ye]),_:1}),n(E,{modelValue:t(p).global.value,"onUpdate:modelValue":d[0]||(d[0]=_=>t(p).global.value=_),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})]),_:1}),n(t(xe),{filters:t(p),"onUpdate:filters":d[1]||(d[1]=_=>R(p)?p.value=_:null),class:"table-stR",value:t(f),stripedRows:"",paginator:"",tableStyle:"min-width: 50rem",rows:15,dataKey:"id",filterDisplay:"menu",loading:t(b)},{empty:x(()=>[He]),loading:x(()=>[n(U,{style:{width:"50px",height:"50px"}})]),default:x(()=>[n(t(z),{field:"index",header:"Serial",sortable:""}),n(t(z),{style:{"text-wrap":"nowrap"},field:"name",header:"Role Name"}),n(t(z),{field:"permissions",header:"Permission"},{body:x(_=>[e("div",Je,[(v(!0),g(D,null,A(_.data.permissions,le=>(v(),g("div",{class:"border rounded",key:a.permission,style:{border:"1px solid rgba(167, 167, 167, 0.486)","border-radius":"5px",padding:"2px 5px"}},[e("p",null,O(le.name),1)]))),128))])]),_:1}),n(t(z),{field:"action",header:"Action"},{body:x(_=>[t(h)?(v(),Y(P,{key:0,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",onClick:le=>s(_.data)},null,8,["onClick"])):G("",!0),t(h)?G("",!0):(v(),Y(P,{key:1,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",style:{visibility:"hidden"}}))]),_:1})]),_:1},8,["filters","value","loading"]),n(t(oe),{visible:t(u),"onUpdate:visible":d[3]||(d[3]=_=>R(u)?u.value=_:null),modal:"",header:"Create Role",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[n(X,{param:{permissionsList:t($),groupPermissions:t(S)},onCloseCreateModal:d[2]||(d[2]=_=>c(_))},null,8,["param"])]),_:1},8,["visible"]),n(t(oe),{visible:t(o),"onUpdate:visible":d[5]||(d[5]=_=>R(o)?o.value=_:null),modal:"",header:"Edit Role",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[n(W,{param:{id:t(M),name:t(F),permissionsList:t($),groupPermissions:t(S),slctdPermissions:t(I)},onCloseEditModal:d[4]||(d[4]=_=>l(_))},null,8,["param"])]),_:1},8,["visible"])])):G("",!0)}}};export{jt as default};
