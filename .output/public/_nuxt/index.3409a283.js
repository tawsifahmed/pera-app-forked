import ke from"./dropdown.esm.64eb9ca6.js";import Pe from"./calendar.esm.1b6d8527.js";import $e from"./button.esm.388dac8c.js";import{a as Te}from"./CreateCompany.0992e90d.js";import{a2 as Ve,a3 as F,$ as l,a5 as H,ar as Y,b as u,i as o,l as n,u as m,e as j,F as je,f as Ie,c as Le,a as Ae,o as r,s as Me,k as Fe,K as Ue,t as U,a8 as Be,a9 as Ne,ca as Oe,an as Re}from"./entry.301ffb3a.js";import{u as ze}from"./fetch.34ea3734.js";import{u as Ee}from"./cookie.92fabe3b.js";import{u as He}from"./layout.5ed334fc.js";import{a as w}from"./usePermission.5e248a7e.js";import{u as W}from"./auth.7bb336e4.js";import{u as q}from"./company.7fdb6b98.js";import{u as G}from"./workCompany.3516056b.js";import J from"./chart.esm.86535f13.js";import"./baseicon.esm.ae76dc18.js";import"./basecomponent.esm.3ef3224a.js";import"./index.esm.a4fbc4b7.js";import"./index.esm.0c3c4133.js";import"./index.esm.3cb2c250.js";import"./index.esm.34d947f9.js";import"./index.esm.304061f5.js";import"./overlayeventbus.esm.6d6e2075.js";import"./portal.esm.21667c44.js";import"./virtualscroller.esm.6321cf3d.js";import"./index.esm.e6ce8021.js";import"./index.esm.f65fce28.js";import"./index.esm.f1cf85e2.js";import"./badge.esm.8601ea29.js";import"./inputtext.esm.785b4390.js";import"./dialog.esm.882b91ad.js";const _=S=>(Be("data-v-1da34ebb"),S=S(),Ne(),S),Ye={class:"grid"},We={key:0,class:"col-12 xl:col-6"},qe={class:"card h-full"},Ge={class:"flex gap-2 align-items-center flex-wrap",style:{"padding-bottom":"10px"}},Je=_(()=>o("h5",{class:"mb-2"},"Tasks",-1)),Ke={class:"flex gap-2 flex-wrap justify-content-end filter-container"},Xe={class:"mb-2 relative w-full md:w-12rem"},Qe={class:"task-container"},Ze={key:0,class:"flex justify-content-center align-items-center",style:{height:"22rem"}},et=_(()=>o("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2.25rem"}},null,-1)),tt=[et],at={key:1},lt=["onClick"],ot={class:"title-group"},st={class:"title line-clamp-1",style:{"font-weight":"600"}},nt=_(()=>o("div",{style:{"background-color":"#00000040",height:"5px",width:"5px","border-radius":"15px"}},null,-1)),rt={class:"title-project line-clamp-1"},it={style:{"font-size":"12px"}},ct={key:2},dt=_(()=>o("p",{class:"text-black text-lg text-center"},"No Tasks found!",-1)),ut=[dt],pt={class:"w-full flex justify-content-center"},mt={class:"col-12 xl:col-6"},vt={class:"card h-full"},gt=_(()=>o("h5",null,"Tasks Statistics",-1)),_t={class:"w-full flex justify-content-center"},ft={class:"col-12 h-full"},ht={class:"card dashChart"},yt={class:"flex justify-content-between align-items-start dash-inf"},bt={class:"flex align-items-center gap-3 dash-inf-left"},Ct=_(()=>o("h5",{class:"mb-0"},"Projects Overview",-1)),wt={class:"flex gap-2 flex-wrap dash-inf-right"},St={class:"chartWrapper"},xt={class:"chartAreaWrapper"},Dt={key:1},kt={__name:"index",setup(S){G();const{totalCompanies:Pt,totalProjects:K}=F(G()),X=Oe(),{getChartData:Q,getTaskAssignModalData:Z,getRoles:ee,getTagsAssignModalData:te}=q(),{chartProjectInfo:ae,inProgressCnt:le,chartClosedTaskInfo:oe,totalDashboardProjects:se,completedTasksChartData:ne,inProgressTasksChartData:re,unAssignedTasksChartData:ie,users:$t,rolesLists:Tt,tags:Vt}=F(q());W(),F(W()),l(w("read_user")),l(w("read_role")),l(w("read_tags"));const ce=l(w("read_task"));l(w("create_company"));const{isDarkTheme:de}=He();l(null);const ue=l({labels:ae,datasets:[{label:"In Progress",data:le,fill:!1,backgroundColor:"#6366f1",borderColor:"#6366f1",tension:.4},{label:"Completed",data:oe,fill:!1,backgroundColor:"#2f4860",borderColor:"#2f4860",tension:.4}]});H(()=>{B.value=ge(),N.value=_e()});const B=l(),N=l();let pe=localStorage.getItem("completedTasksChartData"),me=localStorage.getItem("inProgressTasksChartData"),ve=localStorage.getItem("unAssignedTasksChartData");const ge=()=>{const t=getComputedStyle(document.body);return{labels:["Completed","In Progress","Unassigned"],datasets:[{data:[pe,me,ve],backgroundColor:[t.getPropertyValue("--cyan-500"),t.getPropertyValue("--orange-500"),t.getPropertyValue("--gray-500")],hoverBackgroundColor:[t.getPropertyValue("--cyan-400"),t.getPropertyValue("--orange-400"),t.getPropertyValue("--gray-400")]}]}},_e=()=>({plugins:{legend:{labels:{usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")}}}}),f=l([]);l([{label:"Add New",icon:"pi pi-fw pi-plus"},{label:"Remove",icon:"pi pi-fw pi-minus"}]);const I=l(null),x=l(!1),D=l(null),fe=()=>{var t;D.value=JSON.parse(localStorage.getItem("userCompany")),console.log("hasUserCompany =>",D.value),D.value===null||((t=D.value)==null?void 0:t.length)==0?x.value=!0:x.value=!1,console.log("visibleCreateCompany =>",x.value)},he=()=>{I.value={plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}},ye=()=>{I.value={plugins:{legend:{labels:{color:"#ebedef"}}},scales:{x:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}},y:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}}}}},i=l(),O=l(),R=l(),v=l(),k=l(!1),L=l(!1);Y(i,t=>{var a,s;O.value=[{name:"All",id:""},...((s=(a=i.value)==null?void 0:a.statuses)==null?void 0:s.map(c=>({name:c.name,id:c.id})))||[]]});const h=l(),P=l(),$=l(),T=l(),z=l(1);let p=l(1);const g=async()=>{P.value=i.value?i.value.id:"",$.value=h.value?h.value.id:"",T.value=v.value,M?p.value++:p.value=1,z.value=p.value,V.value=0,A(P.value,$.value,T.value,z.value),M=!1},be=t=>{k.value=!0;const a=new Date(t);v.value=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),g()},Ce=()=>{k.value=!1,v.value="",T.value="",g()},we=()=>{if(i.value||R.value||v.value||p.value>1)i.value="",R.value="",v.value="",P.value="",$.value="",h.value="",k.value=!1,g();else return},Se=async t=>{const a=localStorage.getItem("userCompany");console.log("Task click: ",t),await Re({path:`/companies/${a}/spaces/${t==null?void 0:t.space_id}/projects/${t==null?void 0:t.project_id}`,query:{task_key:t.id}})},xe=t=>{const a=t,s=new Date(a),c=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0");return`${String(s.getDate()).padStart(2,"0")}-${d}-${c}`},V=l(0),E=l(!1),y=l(!1),De=async t=>{t==="hide-loader"&&(E.value=!0),y.value=!0,p.value++,await A(P.value,$.value,T.value,p.value)},A=async(t="",a="",s="",c=1)=>{var b;E.value||(L.value=!0),console.log("status",a);try{const C=Ee("token"),{data:e,pending:jt,error:It}=await ze(`${X.public.apiUrl}/tasks/list?due_date=${s}&status=${a}&project_id=${t}&limit=30&page=${c}`,{method:"GET",headers:{Authorization:`Bearer ${C.value}`}},"$PslAyef5YX");e.value&&e.value.data&&((b=e.value.counts)!=null&&b.total_tasks)?(V.value=Math.ceil(e.value.counts.total_tasks/30),f.value=c===1?e.value.data:[...f.value,...e.value.data],y.value=!1):(f.value=[],y.value=!1)}catch(C){console.log(C),y.value=!1}finally{L.value=!1}};let M=!1;return window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:a,clientHeight:s}=document.documentElement;t+s>=a-50&&p.value<V&&(M=!0,g())}),A(),H(()=>{ee(),Z(),te(),Q(),fe()}),Y(de,t=>{t?ye():he()},{immediate:!0}),(t,a)=>{const s=ke,c=Pe,d=$e,b=Te,C=Ae("tooltip");return r(),u("div",Ye,[ce.value?(r(),u("div",We,[o("div",qe,[o("div",Ge,[Je,o("div",Ke,[n(s,{onChange:a[0]||(a[0]=e=>g()),modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),options:m(K),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Project",class:"w-full md:w-12rem mb-2"},null,8,["modelValue","options"]),n(s,{onChange:a[2]||(a[2]=e=>g()),modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e),options:O.value,disabled:!i.value,optionLabel:"name",placeholder:"Select Status",class:"w-full md:w-12rem mb-2"},null,8,["modelValue","options","disabled"]),o("div",Xe,[n(c,{onDateSelect:a[4]||(a[4]=e=>be(e)),modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),placeholder:"Select Date",class:"w-full md:w-12rem"},null,8,["modelValue"]),k.value?(r(),u("p",{key:0,onClick:Ce,class:"pi pi-times end-cross absolute cursor-pointer"})):j("",!0)]),n(d,{onClick:we,label:"Reset",class:"mb-2",severity:"secondary"})])]),o("div",Qe,[L.value?(r(),u("div",Ze,tt)):f.value.length>0?(r(),u("div",at,[(r(!0),u(je,null,Ie(f.value,e=>(r(),u("div",{key:e.id,onClick:()=>Se(e),class:"task-card"},[o("div",ot,[Me(o("div",{class:Fe("status"),style:Ue(`background-color: ${e==null?void 0:e.status_color};`)},null,4),[[C,{value:`Status: ${e.status_name}`},void 0,{left:!0}]]),o("p",st,U(e==null?void 0:e.name),1),nt,o("p",rt,U(e==null?void 0:e.project_name),1)]),o("div",null,[o("p",it,"Due: "+U(e.due_date?xe(e==null?void 0:e.due_date):"Not Set"),1)])],8,lt))),128))])):(r(),u("div",ct,ut)),o("div",pt,[m(p)<V.value?(r(),Le(d,{key:0,onClick:a[6]||(a[6]=e=>De("hide-loader")),loading:y.value,label:"Load More",severity:"secondary"},null,8,["loading"])):j("",!0)])])])])):j("",!0),o("div",mt,[o("div",vt,[gt,o("div",_t,[n(m(J),{type:"pie",data:B.value,options:N.value,class:"w-full md:w-30rem"},null,8,["data","options"])])])]),o("div",ft,[o("div",ht,[o("div",yt,[o("div",bt,[Ct,n(d,{class:"nwrp",label:`Total Projects: ${m(se)}`,severity:"secondary"},null,8,["label"])]),o("div",wt,[n(d,{class:"nwrp",label:`In Progress: ${m(re)}`,severity:"info",outlined:""},null,8,["label"]),n(d,{class:"nwrp",label:`Unassigned: ${m(ie)}`,severity:"help",outlined:""},null,8,["label"]),n(d,{class:"nwrp",label:`Completed: ${m(ne)}`,severity:"contrast",outlined:""},null,8,["label"])])]),o("div",St,[o("div",xt,[n(m(J),{type:"bar",data:ue.value,options:I.value},null,8,["data","options"])])])])]),x.value?(r(),u("div",Dt,[n(b)])):j("",!0)])}}},ia=Ve(kt,[["__scopeId","data-v-1da34ebb"]]);export{ia as default};
