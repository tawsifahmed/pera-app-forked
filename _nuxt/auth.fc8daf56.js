import{u}from"./fetch.d396a0f8.js";import{u as p}from"./cookie.485eaee6.js";import{ao as y}from"./entry.a40096a8.js";const P=y("auth",{state:()=>({authenticated:!1,authOtp:!1,checkOTP:!1,resendOtpResponse:!1,userCreated:!1,loading:!1,userProfile:null,userCompany:null,resendOtpMsg:null,detectDuplicateEmail:!1,resetState:null,resetToken:""}),actions:{async authenticateUser({email:t,password:a}){var r,i,l,d,h,n,v,c,g;const{data:e,error:s,pending:o}=await u("https://pbe.singularitybd.net/api/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t,password:a}},"$L7GOUGH2Ei");if(console.log("loginData",e.value),console.log("loginErrData",(r=s.value)==null?void 0:r.data),s.value&&((l=(i=s.value)==null?void 0:i.data)==null?void 0:l.code)===403&&(this.checkOTP=!0,this.resendOtpMsg=s.value.data.message,this.resendOtp({email:t})),s.value&&((h=(d=s.value)==null?void 0:d.data)==null?void 0:h.code)===401&&(this.authenticated=!1),e.value)if(e.value.code===200){console.log("login.value",e.value),this.userCompany=(v=(n=e==null?void 0:e.value)==null?void 0:n.company)==null?void 0:v.id,this.userCompany&&localStorage.setItem("userCompany",JSON.stringify(this.userCompany));const m=p("token");m.value=(c=e==null?void 0:e.value)==null?void 0:c.access_token;const f=p("rolePermission");f.value=(g=e==null?void 0:e.value)==null?void 0:g.permissions,this.authenticated=!0}else this.authenticated=!1,token.value=""},async registerUser({userName:t,email:a,password:e,confirmPass:s}){var l,d;const{data:o,pending:r,error:i}=await u("https://pbe.singularitybd.net/api/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:{name:t,email:a,password:e,password_confirmation:s}},"$9tIGMbEnCX");i.value&&((d=(l=i.value)==null?void 0:l.data)==null?void 0:d.code)===422&&(this.detectDuplicateEmail=!0,this.checkOTP=!1),o.value?o.value.code===201?(this.checkOTP=!0,this.detectDuplicateEmail=!1):(this.checkOTP=!1,this.detectDuplicateEmail=!1):this.checkOTP=!1},async registerInviteUser({id:t,userName:a,email:e,password:s,confirmPass:o}){var l;const{data:r,pending:i}=await u("https://pbe.singularitybd.net/api/v1/invite-user-register",{method:"POST",headers:{"Content-Type":"application/json"},body:{id:t,name:a,email:e,password:s,password_confirmation:o}},"$vHZDuP3yg3");((l=r.value)==null?void 0:l.message)==="User registered successfully"?this.checkOTP=!0:this.checkOTP=!1},async otpVerify({email:t,password:a,otp:e}){var i,l,d,h;const{data:s,error:o,pending:r}=await u("https://pbe.singularitybd.net/api/v1/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t,otp:e}},"$uBQ1dQU52h");if(o.value)o.value.data.code===403&&(this.authenticated=!1,this.resendOtpMsg=o.value.data.message);else if(s.value){if((s.value.code=200)&&(this.resendOtpMsg=s.value.message,this.userCreated=!0,this.userCreated)){const{data:n,pending:v}=await u("https://pbe.singularitybd.net/api/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t,password:a}},"$vHgpamTGo5");if(n.value)if(n.value.code===200){this.userCompany=(l=(i=n==null?void 0:n.value)==null?void 0:i.company)==null?void 0:l.id,this.userCompany&&localStorage.setItem("userCompany",JSON.stringify(this.userCompany));const c=p("token");c.value=(d=n==null?void 0:n.value)==null?void 0:d.access_token;const g=p("rolePermission");g.value=(h=n==null?void 0:n.value)==null?void 0:h.permissions,this.authenticated=!0}else{const c=p("token");this.authenticated=!1,c.value=""}}}else this.resendOtpMsg="An error occured while verifying OTP, try again.",this.authOtp=!1,this.authenticated=!1},async resendOtp({email:t}){var o,r,i;const{data:a,error:e,pending:s}=await u("https://pbe.singularitybd.net/api/v1/resend-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t}},"$wunc3cMmhH");console.log("data",(o=a.value)==null?void 0:o.code),console.log("error",(i=(r=e.value)==null?void 0:r.data)==null?void 0:i.code),e.value?e.value.data.code===404&&(this.resendOtpResponse=!1,this.resendOtpMsg="Email does not exist, register first.",console.log("404")):e.value?e.value.data.code===500&&(this.resendOtpResponse=!1,this.resendOtpMsg="En error occured while sending OTP, try again."):(this.resendOtpResponse=!0,this.resendOtpMsg="OTP sent successfully."),console.log("resendOtpResponse",this.resendOtpResponse)},async forgotPassword(t){const{data:a,error:e,pending:s}=await u("https://pbe.singularitybd.net/api/v1/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t}},"$9Nvsun3BrV");return a.value?{code:200,message:"otp"}:{code:e.value.status,message:e.value.data.message}},async forgotPasswordOtp(t,a){const{data:e,error:s,pending:o}=await u("https://pbe.singularitybd.net/api/v1/forgot-password-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:{email:t,otp:a}},"$S7yIlzHA1O");return e.value?(this.resetToken=e.value.token,{code:200,message:"new-password"}):{code:s.value.status,message:s.value.data.message}},async passwordReset(t,a){const e=p("token"),s=e.value?e.value:this.resetToken;console.log("token",e.value),console.log("this.resetToken",this.resetToken);const{data:o,error:r,pending:i}=await u("https://pbe.singularitybd.net/api/v1/reset-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:{email:t,password:a.value.password,password_confirmation:a.value.confirm_password}},"$oVJ9oNItCm");return o.value?(this.resetToken="",{code:200,message:"Password Changed"}):{code:r.value.status,message:r.value.data.message}},logUserOut(){const t=p("token"),a=p("rolePermission");localStorage.removeItem("userCompany"),localStorage.removeItem("taskDetailID"),this.authenticated=!1,t.value=null,a.value=null}}});export{P as u};
