import $e from"./dropdown.esm.b38244db.js";import ke from"./calendar.esm.690e8560.js";import De from"./button.esm.74499959.js";import{a as Te}from"./CreateCompany.a4c2d73c.js";import{a2 as Pe,a6 as U,$ as e,ae as K,a7 as B,b as m,i as s,l as i,u as v,F as je,f as Ie,c as Ve,e as N,a as Le,o as c,s as Fe,k as Ae,K as Me,t as O,a3 as Ue,a4 as Be,ca as Ne,as as Oe}from"./entry.16a2dcd8.js";import{u as Re}from"./fetch.c40f6d97.js";import{u as ze}from"./cookie.32c14903.js";import{u as Ee}from"./layout.0520d883.js";import{a as C}from"./usePermission.677f8de4.js";import{u as X}from"./auth.7b55189c.js";import{u as Q}from"./company.3711220d.js";import{u as Z}from"./workCompany.4ad7c1db.js";import ee from"./chart.esm.79430a15.js";import"./baseicon.esm.93be3154.js";import"./basecomponent.esm.9fe29877.js";import"./index.esm.a5db7524.js";import"./index.esm.f2190bec.js";import"./index.esm.f2c3858c.js";import"./index.esm.3d74c508.js";import"./index.esm.8a0289b2.js";import"./overlayeventbus.esm.478b259c.js";import"./portal.esm.e101d55e.js";import"./virtualscroller.esm.ec20e19e.js";import"./index.esm.8037e112.js";import"./index.esm.7a1290e4.js";import"./index.esm.02f70546.js";import"./badge.esm.22000882.js";import"./inputtext.esm.57954747.js";import"./dialog.esm.309fde2a.js";const f=w=>(Ue("data-v-9b492929"),w=w(),Be(),w),He={class:"grid"},We={key:0,class:"col-12 xl:col-6"},Ye={class:"card h-full"},qe={class:"flex gap-2 align-items-center flex-wrap md:flex-nowrap",style:{"padding-bottom":"10px"}},Ge=f(()=>s("h5",{class:"mb-2"},"Tasks",-1)),Je={class:"flex gap-2 flex-wrap justify-content-end filter-container"},Ke={class:"mb-2 relative w-full md:w-16rem"},Xe={class:"task-container"},Qe={key:0,class:"flex justify-content-center align-items-center",style:{height:"22rem"}},Ze=f(()=>s("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2.25rem"}},null,-1)),et=[Ze],tt={key:1},at=["onClick"],lt={class:"title-group"},st={class:"title line-clamp-1",style:{"font-weight":"600"}},ot=f(()=>s("div",{style:{"background-color":"#00000040",height:"5px",width:"5px","border-radius":"15px"}},null,-1)),nt={class:"title-project line-clamp-1"},it={style:{"font-size":"12px"}},rt={key:2},ct=f(()=>s("p",{class:"text-black text-lg text-center"},"No Tasks found!",-1)),dt=[ct],ut={class:"w-full flex justify-content-center"},pt={class:"col-12 xl:col-6"},mt={class:"card h-full"},vt=f(()=>s("h5",null,"Tasks Statistics",-1)),_t={class:"w-full flex justify-content-center"},ft={class:"col-12 h-full"},ht={class:"card dashChart"},gt={class:"flex justify-content-between align-items-start dash-inf"},yt={class:"flex align-items-center gap-3 dash-inf-left"},bt=f(()=>s("h5",{class:"mb-0"},"Projects Overview",-1)),Ct={class:"flex gap-2 flex-wrap dash-inf-right"},wt={class:"chartWrapper"},xt={class:"chartAreaWrapper"},St={key:1},$t={__name:"index",setup(w){Z();const{totalCompanies:kt,totalProjects:te}=U(Z()),ae=Ne(),{getChartData:le,getTaskAssignModalData:se,getRoles:oe,getTagsAssignModalData:ne}=Q(),{chartProjectInfo:ie,inProgressCnt:re,chartClosedTaskInfo:ce,totalDashboardProjects:de,completedTasksChartData:R,inProgressTasksChartData:z,unAssignedTasksChartData:E,users:Dt,rolesLists:Tt,tags:Pt}=U(Q());X(),U(X()),e(C("read_user")),e(C("read_role")),e(C("read_tags"));const ue=e(C("read_task"));e(C("create_company"));const{isDarkTheme:pe}=Ee();e(null);const me=e({labels:ie,datasets:[{label:"In Progress",data:re,fill:!1,backgroundColor:"#6366f1",borderColor:"#6366f1",tension:.4},{label:"Completed",data:ce,fill:!1,backgroundColor:"#2f4860",borderColor:"#2f4860",tension:.4}]});K(()=>{W.value=_e(),B([R,z,E],([t,a,o])=>{t&&a&&o&&(H.value=ve(t,a,o))},{immediate:!0})});const H=e(),W=e(),ve=(t,a,o)=>(getComputedStyle(document.body),{labels:["Completed","In Progress","Unassigned"],datasets:[{data:[t,a,o],backgroundColor:["#33bd7c","#0ea5e9","#475569"],hoverBackgroundColor:["#1a8251","#0087c3","#2c3644"]}]}),_e=()=>({plugins:{legend:{labels:{usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")}}}}),h=e([]);e([{label:"Add New",icon:"pi pi-fw pi-plus"},{label:"Remove",icon:"pi pi-fw pi-minus"}]);const D=e(null),T=e(!1),P=e(null),fe=()=>{var t;P.value=JSON.parse(localStorage.getItem("userCompany")),P.value===null||((t=P.value)==null?void 0:t.length)==0?T.value=!0:T.value=!1},he=()=>{D.value={plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}},ge=()=>{D.value={plugins:{legend:{labels:{color:"#ebedef"}}},scales:{x:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}},y:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}}}}},r=e(),Y=e(),q=e(),d=e(),ye=e(!1),be=e(!1),j=e(!1);B(r,t=>{var a,o;Y.value=[{name:"All",id:""},...((o=(a=r.value)==null?void 0:a.statuses)==null?void 0:o.map(p=>({name:p.name,id:p.id})))||[]]});const g=e(),x=e(),S=e(),I=e(),V=e(),G=e(1);let u=e(1);const y=async()=>{x.value=r.value?r.value.id:"",S.value=g.value?g.value.id:"",I.value=d.value[0]?L(d.value[0]):"",V.value=d.value[1]?L(d.value[1]):"",A?u.value++:u.value=1,G.value=u.value,$.value=0,F(x.value,S.value,I.value,V.value,G.value),A=!1},Ce=()=>{y()},we=()=>{if(r.value||q.value||d.value||u.value>1)r.value="",q.value="",d.value=[],x.value="",S.value="",g.value="",be.value=!1,ye.value=!1,y();else return},xe=async t=>{const a=localStorage.getItem("userCompany");console.log("Task click: ",t),await Oe({path:`/companies/${a}/spaces/${t==null?void 0:t.space_id}/projects/${t==null?void 0:t.project_id}`,query:{task_key:t.id}})},L=t=>{const a=t,o=new Date(a),p=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0");return`${String(o.getDate()).padStart(2,"0")}-${n}-${p}`},$=e(0),J=e(!1),b=e(!1),Se=async t=>{t==="hide-loader"&&(J.value=!0),b.value=!0,u.value++,await F(x.value,S.value,I.value,V.value,u.value)},F=async(t="",a="",o="",p="",n=1)=>{var k;J.value||(j.value=!0);try{const l=ze("token"),{data:_,pending:jt,error:It}=await Re(`${ae.public.apiUrl}/tasks/list?start_due_date=${o}&end_due_date=${p}&status=${a}&project_id=${t}&limit=30&page=${n}`,{method:"GET",headers:{Authorization:`Bearer ${l.value}`}},"$PslAyef5YX");_.value&&_.value.data&&((k=_.value.counts)!=null&&k.total_tasks)?($.value=Math.ceil(_.value.counts.total_tasks/30),h.value=n===1?_.value.data:[...h.value,..._.value.data],b.value=!1):(h.value=[],b.value=!1)}catch(l){console.log(l),b.value=!1}finally{j.value=!1}};let A=!1;return window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:a,clientHeight:o}=document.documentElement;t+o>=a-50&&u.value<$&&(A=!0,y())}),F(),K(()=>{oe(),se(),ne(),le(),fe()}),B(pe,t=>{t?ge():he()},{immediate:!0}),(t,a)=>{const o=$e,p=ke,n=De,M=Te,k=Le("tooltip");return c(),m("div",He,[ue.value?(c(),m("div",We,[s("div",Ye,[s("div",qe,[Ge,s("div",Je,[i(o,{onChange:a[0]||(a[0]=l=>y()),modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=l=>r.value=l),options:v(te),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Project",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options"]),i(o,{onChange:a[2]||(a[2]=l=>y()),modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=l=>g.value=l),options:Y.value,disabled:!r.value,optionLabel:"name",placeholder:"Status",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options","disabled"]),s("div",Ke,[i(p,{onHide:Ce,dateFormat:"dd/mm/yy",manualInput:!1,selectionMode:"range",modelValue:d.value,"onUpdate:modelValue":a[4]||(a[4]=l=>d.value=l),placeholder:"Filter by Due Dates",class:"w-full text-sm"},null,8,["modelValue"])]),i(n,{onClick:we,label:"Reset",class:"mb-2",severity:"secondary"})])]),s("div",Xe,[j.value?(c(),m("div",Qe,et)):h.value.length>0?(c(),m("div",tt,[(c(!0),m(je,null,Ie(h.value,l=>(c(),m("div",{key:l.id,onClick:()=>xe(l),class:"task-card"},[s("div",lt,[Fe(s("div",{class:Ae("status"),style:Me(`background-color: ${l==null?void 0:l.status_color};`)},null,4),[[k,{value:`Status: ${l.status_name}`},void 0,{left:!0}]]),s("p",st,O(l==null?void 0:l.name),1),ot,s("p",nt,O(l==null?void 0:l.project_name),1)]),s("div",null,[s("p",it,"Due: "+O(l.due_date?L(l==null?void 0:l.due_date):"Not Set"),1)])],8,at))),128))])):(c(),m("div",rt,dt)),s("div",ut,[v(u)<$.value?(c(),Ve(n,{key:0,onClick:a[5]||(a[5]=l=>Se("hide-loader")),loading:b.value,label:"Load More",severity:"secondary"},null,8,["loading"])):N("",!0)])])])])):N("",!0),s("div",pt,[s("div",mt,[vt,s("div",_t,[i(v(ee),{type:"pie",data:H.value,options:W.value,class:"w-full md:w-30rem"},null,8,["data","options"])])])]),s("div",ft,[s("div",ht,[s("div",gt,[s("div",yt,[bt,i(n,{class:"nwrp",label:`Total Projects: ${v(de)}`,severity:"secondary"},null,8,["label"])]),s("div",Ct,[i(n,{class:"nwrp",label:`In Progress: ${v(z)}`,severity:"info",outlined:""},null,8,["label"]),i(n,{class:"nwrp",label:`Unassigned: ${v(E)}`,severity:"help",outlined:""},null,8,["label"]),i(n,{class:"nwrp",label:`Completed: ${v(R)}`,severity:"contrast",outlined:""},null,8,["label"])])]),s("div",wt,[s("div",xt,[i(v(ee),{type:"bar",data:me.value,options:D.value},null,8,["data","options"])])])])]),T.value?(c(),m("div",St,[i(M)])):N("",!0)])}}},ia=Pe($t,[["__scopeId","data-v-9b492929"]]);export{ia as default};
