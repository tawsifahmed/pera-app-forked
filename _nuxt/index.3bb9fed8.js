import Ie from"./dropdown.esm.33fa9d59.js";import Le from"./calendar.esm.1b0e0d0a.js";import Ae from"./button.esm.cc72e76b.js";import{a as Fe}from"./CreateCompany.a975925e.js";import{a2 as Me,a5 as O,$ as l,a7 as G,ar as J,b as c,i as o,l as n,u as m,e as D,F as Ue,f as Be,c as Ne,a as Oe,o as i,s as Re,k as ze,K as Ee,t as R,a3 as Ye,a4 as He,ca as We,an as qe}from"./entry.f5ea297c.js";import{u as Ge}from"./fetch.6b2fb259.js";import{u as Je}from"./cookie.451fffa9.js";import{u as Ke}from"./layout.18b57ca9.js";import{a as S}from"./usePermission.f88c73f5.js";import{u as K}from"./auth.0127fac6.js";import{u as X}from"./company.096d3862.js";import{u as Q}from"./workCompany.2075752e.js";import Z from"./chart.esm.2a364f94.js";import"./baseicon.esm.8a0a1832.js";import"./basecomponent.esm.d5209ab2.js";import"./index.esm.64e38950.js";import"./index.esm.31c8a365.js";import"./index.esm.c964197b.js";import"./index.esm.0994c14c.js";import"./index.esm.8b7ef7ae.js";import"./overlayeventbus.esm.6a0a7c71.js";import"./portal.esm.236df3f1.js";import"./virtualscroller.esm.1bb55791.js";import"./index.esm.687b5edb.js";import"./index.esm.255e5ed6.js";import"./index.esm.7e54af1a.js";import"./badge.esm.6fb23254.js";import"./inputtext.esm.2b814e00.js";import"./dialog.esm.d829ef8f.js";const h=x=>(Ye("data-v-fd5aad50"),x=x(),He(),x),Xe={class:"grid"},Qe={key:0,class:"col-12 xl:col-6"},Ze={class:"card h-full"},et={class:"flex gap-2 align-items-center flex-wrap",style:{"padding-bottom":"10px"}},tt=h(()=>o("h5",{class:"mb-2"},"Tasks",-1)),at={class:"flex gap-2 flex-wrap justify-content-end filter-container"},lt={class:"mb-2 relative w-full md:w-8rem"},ot={class:"mb-2 relative w-full md:w-8rem"},st={class:"task-container"},nt={key:0,class:"flex justify-content-center align-items-center",style:{height:"22rem"}},rt=h(()=>o("i",{class:"pi pi-spin pi-spinner",style:{"font-size":"2.25rem"}},null,-1)),it=[rt],ct={key:1},ut=["onClick"],dt={class:"title-group"},pt={class:"title line-clamp-1",style:{"font-weight":"600"}},vt=h(()=>o("div",{style:{"background-color":"#00000040",height:"5px",width:"5px","border-radius":"15px"}},null,-1)),mt={class:"title-project line-clamp-1"},ft={style:{"font-size":"12px"}},gt={key:2},_t=h(()=>o("p",{class:"text-black text-lg text-center"},"No Tasks found!",-1)),ht=[_t],yt={class:"w-full flex justify-content-center"},bt={class:"col-12 xl:col-6"},Ct={class:"card h-full"},wt=h(()=>o("h5",null,"Tasks Statistics",-1)),Dt={class:"w-full flex justify-content-center"},St={class:"col-12 h-full"},xt={class:"card dashChart"},kt={class:"flex justify-content-between align-items-start dash-inf"},Pt={class:"flex align-items-center gap-3 dash-inf-left"},$t=h(()=>o("h5",{class:"mb-0"},"Projects Overview",-1)),Tt={class:"flex gap-2 flex-wrap dash-inf-right"},Vt={class:"chartWrapper"},jt={class:"chartAreaWrapper"},It={key:1},Lt={__name:"index",setup(x){Q();const{totalCompanies:At,totalProjects:ee}=O(Q()),te=We(),{getChartData:ae,getTaskAssignModalData:le,getRoles:oe,getTagsAssignModalData:se}=X(),{chartProjectInfo:ne,inProgressCnt:re,chartClosedTaskInfo:ie,totalDashboardProjects:ce,completedTasksChartData:ue,inProgressTasksChartData:de,unAssignedTasksChartData:pe,users:Ft,rolesLists:Mt,tags:Ut}=O(X());K(),O(K()),l(S("read_user")),l(S("read_role")),l(S("read_tags"));const ve=l(S("read_task"));l(S("create_company"));const{isDarkTheme:me}=Ke();l(null);const fe=l({labels:ne,datasets:[{label:"In Progress",data:re,fill:!1,backgroundColor:"#6366f1",borderColor:"#6366f1",tension:.4},{label:"Completed",data:ie,fill:!1,backgroundColor:"#2f4860",borderColor:"#2f4860",tension:.4}]});G(()=>{z.value=ye(),E.value=be()});const z=l(),E=l();let ge=localStorage.getItem("completedTasksChartData"),_e=localStorage.getItem("inProgressTasksChartData"),he=localStorage.getItem("unAssignedTasksChartData");const ye=()=>{const t=getComputedStyle(document.body);return{labels:["Completed","In Progress","Unassigned"],datasets:[{data:[ge,_e,he],backgroundColor:[t.getPropertyValue("--cyan-500"),t.getPropertyValue("--orange-500"),t.getPropertyValue("--gray-500")],hoverBackgroundColor:[t.getPropertyValue("--cyan-400"),t.getPropertyValue("--orange-400"),t.getPropertyValue("--gray-400")]}]}},be=()=>({plugins:{legend:{labels:{usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")}}}}),y=l([]);l([{label:"Add New",icon:"pi pi-fw pi-plus"},{label:"Remove",icon:"pi pi-fw pi-minus"}]);const A=l(null),k=l(!1),P=l(null),Ce=()=>{var t;P.value=JSON.parse(localStorage.getItem("userCompany")),console.log("hasUserCompany =>",P.value),P.value===null||((t=P.value)==null?void 0:t.length)==0?k.value=!0:k.value=!1,console.log("visibleCreateCompany =>",k.value)},we=()=>{A.value={plugins:{legend:{labels:{color:"#495057"}}},scales:{x:{ticks:{color:"#495057"},grid:{color:"#ebedef"}},y:{ticks:{color:"#495057"},grid:{color:"#ebedef"}}}}},De=()=>{A.value={plugins:{legend:{labels:{color:"#ebedef"}}},scales:{x:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}},y:{ticks:{color:"#ebedef"},grid:{color:"rgba(160, 167, 181, .3)"}}}}},u=l(),Y=l(),H=l(),f=l(),g=l(),$=l(!1),T=l(!1),F=l(!1);J(u,t=>{var e,s;Y.value=[{name:"All",id:""},...((s=(e=u.value)==null?void 0:e.statuses)==null?void 0:s.map(d=>({name:d.name,id:d.id})))||[]]});const b=l(),V=l(),j=l(),M=l(),C=l(),W=l(1);let p=l(1);const v=async()=>{V.value=u.value?u.value.id:"",j.value=b.value?b.value.id:"",M.value=f.value,C.value=g.value,B?p.value++:p.value=1,W.value=p.value,I.value=0,U(V.value,j.value,M.value,C.value,W.value),B=!1},Se=t=>{$.value=!0;const e=new Date(t);f.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},xe=t=>{T.value=!0;const e=new Date(t);g.value=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),v()},ke=()=>{$.value=!1,f.value="",C.value="",v()},Pe=()=>{T.value=!1,g.value="",C.value="",v()},$e=()=>{if(u.value||H.value||f.value||g.value||p.value>1)u.value="",H.value="",f.value="",g.value="",V.value="",j.value="",b.value="",T.value=!1,$.value=!1,v();else return},Te=async t=>{const e=localStorage.getItem("userCompany");console.log("Task click: ",t),await qe({path:`/companies/${e}/spaces/${t==null?void 0:t.space_id}/projects/${t==null?void 0:t.project_id}`,query:{task_key:t.id}})},Ve=t=>{const e=t,s=new Date(e),d=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0");return`${String(s.getDate()).padStart(2,"0")}-${r}-${d}`},I=l(0),q=l(!1),w=l(!1),je=async t=>{t==="hide-loader"&&(q.value=!0),w.value=!0,p.value++,await U(V.value,j.value,M.value,C.value,p.value)},U=async(t="",e="",s="",d="",r=1)=>{var L;q.value||(F.value=!0),console.log("status",e);try{const a=Je("token"),{data:_,pending:Bt,error:Nt}=await Ge(`${te.public.apiUrl}/tasks/list?start_due_date=${s}&end_due_date=${d}&status=${e}&project_id=${t}&limit=30&page=${r}`,{method:"GET",headers:{Authorization:`Bearer ${a.value}`}},"$PslAyef5YX");_.value&&_.value.data&&((L=_.value.counts)!=null&&L.total_tasks)?(I.value=Math.ceil(_.value.counts.total_tasks/30),y.value=r===1?_.value.data:[...y.value,..._.value.data],w.value=!1):(y.value=[],w.value=!1)}catch(a){console.log(a),w.value=!1}finally{F.value=!1}};let B=!1;return window.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:e,clientHeight:s}=document.documentElement;t+s>=e-50&&p.value<I&&(B=!0,v())}),U(),G(()=>{oe(),le(),se(),ae(),Ce()}),J(me,t=>{t?De():we()},{immediate:!0}),(t,e)=>{const s=Ie,d=Le,r=Ae,N=Fe,L=Oe("tooltip");return i(),c("div",Xe,[ve.value?(i(),c("div",Qe,[o("div",Ze,[o("div",et,[tt,o("div",at,[n(s,{onChange:e[0]||(e[0]=a=>v()),modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),options:m(ee),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Project",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options"]),n(s,{onChange:e[2]||(e[2]=a=>v()),modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),options:Y.value,disabled:!u.value,optionLabel:"name",placeholder:"Status",class:"w-full md:w-10rem mb-2"},null,8,["modelValue","options","disabled"]),o("div",lt,[n(d,{onDateSelect:e[4]||(e[4]=a=>Se(a)),modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),placeholder:"Start Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),$.value?(i(),c("p",{key:0,onClick:ke,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),o("div",ot,[n(d,{onDateSelect:e[6]||(e[6]=a=>xe(a)),modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=a=>g.value=a),placeholder:"Due Date",class:"w-full md:w-8rem"},null,8,["modelValue"]),T.value?(i(),c("p",{key:0,onClick:Pe,class:"pi pi-times end-cross absolute cursor-pointer"})):D("",!0)]),n(r,{onClick:$e,label:"Reset",class:"mb-2",severity:"secondary"})])]),o("div",st,[F.value?(i(),c("div",nt,it)):y.value.length>0?(i(),c("div",ct,[(i(!0),c(Ue,null,Be(y.value,a=>(i(),c("div",{key:a.id,onClick:()=>Te(a),class:"task-card"},[o("div",dt,[Re(o("div",{class:ze("status"),style:Ee(`background-color: ${a==null?void 0:a.status_color};`)},null,4),[[L,{value:`Status: ${a.status_name}`},void 0,{left:!0}]]),o("p",pt,R(a==null?void 0:a.name),1),vt,o("p",mt,R(a==null?void 0:a.project_name),1)]),o("div",null,[o("p",ft,"Due: "+R(a.due_date?Ve(a==null?void 0:a.due_date):"Not Set"),1)])],8,ut))),128))])):(i(),c("div",gt,ht)),o("div",yt,[m(p)<I.value?(i(),Ne(r,{key:0,onClick:e[8]||(e[8]=a=>je("hide-loader")),loading:w.value,label:"Load More",severity:"secondary"},null,8,["loading"])):D("",!0)])])])])):D("",!0),o("div",bt,[o("div",Ct,[wt,o("div",Dt,[n(m(Z),{type:"pie",data:z.value,options:E.value,class:"w-full md:w-30rem"},null,8,["data","options"])])])]),o("div",St,[o("div",xt,[o("div",kt,[o("div",Pt,[$t,n(r,{class:"nwrp",label:`Total Projects: ${m(ce)}`,severity:"secondary"},null,8,["label"])]),o("div",Tt,[n(r,{class:"nwrp",label:`In Progress: ${m(de)}`,severity:"info",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Unassigned: ${m(pe)}`,severity:"help",outlined:""},null,8,["label"]),n(r,{class:"nwrp",label:`Completed: ${m(ue)}`,severity:"contrast",outlined:""},null,8,["label"])])]),o("div",Vt,[o("div",jt,[n(m(Z),{type:"bar",data:fe.value,options:A.value},null,8,["data","options"])])])])]),k.value?(i(),c("div",It,[n(N)])):D("",!0)])}}},fa=Me(Lt,[["__scopeId","data-v-fd5aad50"]]);export{fa as default};
