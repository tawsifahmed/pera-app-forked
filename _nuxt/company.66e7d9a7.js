import{u as l,a as v}from"./cookie.3bc34ce6.js";import{u as g}from"./fetch.773b5ca7.js";import{ao as x}from"./entry.6ba041bf.js";import{u as M}from"./workCompany.6298b5ea.js";const b=M(),Q=x("workStation",{state:()=>({loading:!1,createCompany:null,isCompanyCreated:!1,isCompanyDeleted:!1,isCompanyEdited:!1,compList:null,companyId:null,singleCompany:null,singleCompanySpaces:null,singleCompanyName:null,isCompanySwitched:!1,companySwitchToast:null,spaceList:null,isSpaceCreated:!1,isSpaceDeleted:!1,isSpaceEdited:!1,singleSpace:null,singleSpaceProjects:null,spaceSidebarlist:[],projectList:null,isProjectCreated:!1,isProjectEdited:!1,isProjectDeleted:!1,singleProject:null,taskList:null,isTaskCreated:!1,detectDuplicateTask:!1,isTaskDeleted:!1,isTaskEdited:!1,tasks:[],kanbanTasks:[],ganttChartData:[],recentTaskData:[],tasksAttachments:[],totalTaskCount:[],countTasksByStatus:[],taskStatusCounts:[],asngUsers:[],subTasks:[],taskDetails:[],taskActivity:[],taskStatus:[],users:[],tags:[],priorityList:[],singleTaskComments:null,isTaskCommentCreated:!1,statuslist:[],modStatusList:[],chartProjectInfo:null,chartTaskInfo:null,chartClosedTaskInfo:null,rolesLists:null}),actions:{async getCompanyList(){var i,s,o;const e=l("token"),{data:t,pending:a,error:r}=await v("compList",()=>$fetch("https://pbe.singularitybd.net/api/v1/company/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.compList=(i=t.value)==null?void 0:i.data.map((n,c)=>({...n,index:c+1})),this.singleCompanyName=(o=(s=t.value)==null?void 0:s.data[0])==null?void 0:o.name},async getSingleCompany(e){var s,o;const t=l("token"),{data:a,pending:r,error:i}=await v("singleCompany",()=>$fetch(`https://pbe.singularitybd.net/api/v1/company/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleCompany=(s=a.value)==null?void 0:s.data,this.singleCompanySpaces=(o=this.singleCompany)==null?void 0:o.spaces.map((n,c)=>({...n,index:c+1}))},async createCompany({name:e,email:t,address:a,contact_number:r,number_of_employees:i,company_type:s,logo:o}){var h,y,k,$,D,T;const n=l("token"),{data:c,pending:p}=await g("https://pbe.singularitybd.net/api/v1/company/create",{method:"POST",headers:{Authorization:`Bearer ${n.value}`},body:{name:e,email:t,address:a,contact_number:r,number_of_employees:i,company_type:s,logo:o}},"$FPXU5moxCx");if(((h=c.value)==null?void 0:h.app_message)==="success"){localStorage.setItem("userCompany",JSON.stringify((k=(y=c.value)==null?void 0:y.data)==null?void 0:k.id)),this.isCompanyCreated=!0,this.companyId=(D=($=c.value)==null?void 0:$.data)==null?void 0:D.id;const w=l("rolePermission");w.value=(T=c==null?void 0:c.value)==null?void 0:T.permissions,await this.getCompanyList(),await b.getCompany()}},async editCompany({id:e,name:t,email:a,address:r,contact_number:i,number_of_employees:s,company_type:o,logo:n}){var y;const c=l("token"),{data:p,pending:h}=await g(`https://pbe.singularitybd.net/api/v1/company/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:{id:e,name:t,email:a,address:r,contact_number:i,number_of_employees:s,company_type:o,logo:n}},"$LkMGR8lsUV");((y=p.value)==null?void 0:y.app_message)==="success"&&(this.isCompanyEdited=!0,this.getCompanyList(),await b.getCompany())},async switchCompany(e){var i,s,o;const t=l("token"),{data:a,pending:r}=await g("https://pbe.singularitybd.net/api/v1/switch-company",{method:"POST",headers:{Authorization:`Bearer ${t.value}`},body:{company_id:e}},"$y3MaeJU29x");if(((i=a.value)==null?void 0:i.code)===200){const n=l("userType");n.value=(s=a==null?void 0:a.value)==null?void 0:s.user_type;const c=l("rolePermission");c.value=(o=a==null?void 0:a.value)==null?void 0:o.permissions,this.isCompanySwitched=!0,this.companySwitchToast=a.value.message,location.reload()}else this.isCompanySwitched=!1,this.companySwitchToast="Unable to switch company"},async deleteCompany(e){var i;const t=l("token"),{data:a,pending:r}=await g(`https://pbe.singularitybd.net/api/v1/company/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.value}`},body:{id:e}},"$m5SlSHdl7U");((i=a.value)==null?void 0:i.app_message)==="success"&&(this.isCompanyDeleted=!0,await b.getCompany(),this.getCompanyList())},async getSpaceList(){var a,r;let e=null;e=JSON.parse(localStorage.getItem("userCompany"));const t=l("token");if(e){const{data:i,pending:s,error:o}=await v("spaceList",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/list/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.spaceList=(a=i.value)==null?void 0:a.data,((r=this.spaceList)==null?void 0:r.length)>0&&(this.spaceSidebarlist=[],this.spaceList.forEach(n=>{let c={label:n==null?void 0:n.name,icon:"pi pi-globe",to:`/companies/${n==null?void 0:n.company_id}/spaces/${n==null?void 0:n.id}`};this.spaceSidebarlist.push(c)}))}},async getSingleSpace(e){var s,o;const t=l("token"),{data:a,pending:r,error:i}=await v("singleSpace",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleSpace=(s=a.value)==null?void 0:s.data,this.singleSpaceProjects=(o=this.singleSpace)==null?void 0:o.projects.map((n,c)=>({...n,index:c+1}))},async createSpace({name:e,description:t,company_id:a,color:r,users:i}){var c;const s=l("token"),{data:o,pending:n}=await g("https://pbe.singularitybd.net/api/v1/space/create",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{name:e,description:t,company_id:a,color:r,users:i}},"$RESrNdzmLo");((c=o.value)==null?void 0:c.app_message)==="success"&&(this.isSpaceCreated=!0)},async editSpace({id:e,name:t,description:a,company_id:r,color:i,users:s}){var p;const o=l("token"),{data:n,pending:c}=await g(`https://pbe.singularitybd.net/api/v1/space/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${o.value}`},body:{id:e,name:t,description:a,company_id:r,color:i,users:s}},"$11QSDyM4E2");((p=n.value)==null?void 0:p.app_message)==="success"&&(this.isSpaceEdited=!0,await b.getCompany(),this.getSingleCompany(r))},async deleteSpace(e,t){var s;const a=l("token"),{data:r,pending:i}=await g(`https://pbe.singularitybd.net/api/v1/space/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$lPsqIgvGMV");((s=r.value)==null?void 0:s.app_message)==="success"&&(this.isSpaceDeleted=!0,await b.getCompany(),this.getSingleCompany(t))},async getProjectList(){var i;const e=l("token"),{data:t,pending:a,error:r}=await v("projectList",()=>$fetch("https://pbe.singularitybd.net/api/v1/space/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.spaceList=(i=t.value)==null?void 0:i.data},async getSingleProject(e,t="",a="",r="",i="",s="",o=""){var _,E,B;const n=l("token");t&&(t=t.join(","));const{data:c,pending:p,error:h}=await v("singleProject",()=>$fetch(`
          https://pbe.singularitybd.net/api/v1/projects/show/${e}?assignees=${t}&priority=${a}&status=${r}&search=${i}&start=${s}&end=${o}`,{headers:{Authorization:`Bearer ${n.value}`}}));this.singleProject=(_=c.value)==null?void 0:_.data,this.tasks=(E=c.value)==null?void 0:E.tasks,this.statuslist=(B=c.value)==null?void 0:B.taskStatus;const y=this.statuslist.map(d=>{const f=this.tasks.filter(m=>m.data.status.name===d.name);return{name:d.name,statusColor:d.color_code,status:d,content:f}});this.kanbanTasks=y,this.modStatusList=[{name:"All",code:""},...this.statuslist];function k(d){let f=[];function m(u){const{name:C,created_at:S,dueDate:P,status:A}=u.data;S&&P&&f.push({x:C,y:[new Date(S).getTime(),new Date(P).getTime()],fillColor:A.color_code}),u.children&&u.children.length>0&&u.children.forEach(j=>m(j))}return d.forEach(u=>m(u)),[{data:f}]}function $(d){let f=[];const m=new Date().getTime(),u=m-3*24*60*60*1e3;function C(S){const{name:P,created_at:A,dueDate:j,status:L}=S.data,{key:O}=S,z=new Date(A).getTime();z>=u&&z<=m&&f.push({key:O,taskName:P,dueDate:j,statusName:L.name,statusColor:L.color_code}),S.children&&S.children.length>0&&S.children.forEach(N=>C(N))}return d.forEach(S=>C(S)),f}function D(d){let f=0;function m(u){f++,u.children&&u.children.length>0&&u.children.forEach(C=>m(C))}return d.forEach(u=>m(u)),{totalTaskCount:f}}const T=this.statuslist.map(d=>({statusName:d.name,statusColor:d.color_code,taskCount:0}));function w(d){const f=d.data.status,m=T.findIndex(u=>u.statusName===f.name);m!==-1&&(T[m].taskCount+=1),d.children&&d.children.length>0&&d.children.forEach(u=>w(u))}this.tasks.forEach(d=>w(d)),this.countTasksByStatus=T,console.log("this.countTasksByStatus",this.countTasksByStatus);let I=D(this.tasks);this.recentTaskData=$(this.tasks),this.totalTaskCount=I.totalTaskCount,this.ganttChartData=k(this.tasks)},async createProject({name:e,description:t,space_id:a,statuses:r}){var n;const i=l("token"),{data:s,pending:o}=await g("https://pbe.singularitybd.net/api/v1/projects/create",{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:{name:e,description:t,space_id:a,statuses:r}},"$dFqFkzlBiI");((n=s.value)==null?void 0:n.app_message)==="success"&&(this.isProjectCreated=!0,await b.getCompany(),this.getSingleSpace(a),this.getChartData())},async editProject({id:e,name:t,description:a,space_id:r,statuses:i}){var c;console.log("statuses Pinia",i);const s=l("token"),{data:o,pending:n}=await g(`https://pbe.singularitybd.net/api/v1/projects/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{id:e,name:t,description:a,space_id:r,statuses:i}},"$74BArWPOdE");((c=o.value)==null?void 0:c.app_message)==="success"&&(this.isProjectEdited=!0,await b.getCompany(),this.getSingleSpace(r))},async deleteProject(e,t){var s;const a=l("token"),{data:r,pending:i}=await g(`https://pbe.singularitybd.net/api/v1/projects/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$BnkY4zQQhW");((s=r.value)==null?void 0:s.app_message)==="success"&&(this.isProjectDeleted=!0,await b.getCompany(),this.getSingleSpace(t))},async getTaskDetails(e){var o,n,c,p,h;const t=l("token"),{data:a,pending:r,error:i}=await v("taskDetails",()=>$fetch(`https://pbe.singularitybd.net/api/v1/tasks/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.taskDetails=(o=a.value)==null?void 0:o.data,this.taskActivity=(n=a.value)==null?void 0:n.taskActivity,this.singleTaskComments=(c=a.value)==null?void 0:c.data.comments,this.subTasks=(p=a.value)==null?void 0:p.subTasks,this.taskStatus=[];let s=(h=a.value)==null?void 0:h.taskStatus;s&&s.length>0&&s.forEach(y=>{let k={name:y.name,code:y.id};this.taskStatus.push(k)})},async createTask({name:e,description:t,project_id:a,parent_task_id:r,dueDate:i,priority:s,assignees:o,tags:n}){console.log("dueDate formatted",i);const c=l("token"),{data:p,error:h,pending:y}=await g("https://pbe.singularitybd.net/api/v1/tasks/create",{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:{name:e,project_id:a,parent_task_id:r,due_date:i,priority:s,assignees:o,tags:n,description:t}},"$yabYYCCfIV");if(h.value&&h.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskCreated=!1),p.value&&p.value.code===201){this.isTaskCreated=!0,this.detectDuplicateTask=!1,this.getSingleProject(a);let k=Number(localStorage.getItem("taskDetailID"));k&&this.getTaskDetails(k)}},async editTask({id:e,name:t,description:a,project_id:r,dueDate:i,priority:s,assignees:o,tags:n}){const c=l("token"),{data:p,error:h,pending:y}=await g(`https://pbe.singularitybd.net/api/v1/tasks/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:{id:e,name:t,description:a,due_date:i,priority:s,assignees:o,tags:n,project_id:r}},"$vVLnpjK6QE");if(console.log("data",p),h.value&&h.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskEdited=!1),p.value&&p.value.code===200){this.isTaskEdited=!0,this.detectDuplicateTask=!1,this.getSingleProject(r);let k=Number(localStorage.getItem("taskDetailID"));k&&this.getTaskDetails(k)}},async deleteTask(e,t){var s;const a=l("token"),{data:r,pending:i}=await g(`https://pbe.singularitybd.net/api/v1/tasks/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$4BH7YSjOJ4");if(((s=r.value)==null?void 0:s.app_message)==="success"){this.isTaskDeleted=!0,this.getSingleProject(t);let o=Number(localStorage.getItem("taskDetailID"));o&&this.getTaskDetails(o)}},async getTaskAssignModalData(){var i,s,o;const e=l("token"),{data:t,pending:a,error:r}=await v("taskAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/users/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0&&(this.users=[],(o=t.value)==null||o.data.forEach(n=>{let c={id:n.id,name:n.name};this.users.push(c)}))},async getTagsAssignModalData(){var i,s,o;const e=l("token"),{data:t,pending:a,error:r}=await v("tagsAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/tag/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0&&(this.tags=[],(o=t.value)==null||o.data.forEach(n=>{let c={id:n.id,name:n.name};this.tags.push(c)}))},async addTaskComment(e,t,a){var n;const r=new FormData;r.append("comment",t),r.append("commentable_id",e),r.append("file",a);const i=l("token"),{data:s,pending:o}=await g("https://pbe.singularitybd.net/api/v1/comments/create",{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:r},"$Sdwr0JJQY2");((n=s.value)==null?void 0:n.app_message)==="success"&&(this.isTaskCommentCreated=!0,this.getTaskDetails(e))},async getChartData(){var i,s,o,n,c,p,h;const e=l("token"),{data:t,pending:a,error:r}=await v("chartData",()=>$fetch("https://pbe.singularitybd.net/api/v1/chart-data",{headers:{Authorization:`Bearer ${e.value}`}}));console.log("chartData",t.value),((i=t==null?void 0:t.value)==null?void 0:i.code)===200?(this.chartProjectInfo=(o=(s=t==null?void 0:t.value)==null?void 0:s.data)==null?void 0:o.projects,console.log("chartProjectInfo",this.chartProjectInfo),this.chartTaskInfo=(c=(n=t==null?void 0:t.value)==null?void 0:n.data)==null?void 0:c.total_task_count,this.chartClosedTaskInfo=(h=(p=t==null?void 0:t.value)==null?void 0:p.data)==null?void 0:h.close_task_count):(this.chartProjectInfo=[],this.chartTaskInfo=[])},async getRoles(){var i,s,o;const e=l("token"),{data:t,pending:a,error:r}=await v("roleLit",()=>$fetch("https://pbe.singularitybd.net/api/v1/roles/list",{headers:{Authorization:`Bearer ${e.value}`}}));console.log("rolesData",t),((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0?this.rolesLists=(o=t.value)==null?void 0:o.data:this.rolesLists=[]},formatDate(e){const t=new Date(e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}/${t.getFullYear()}`}}});export{Q as u};
