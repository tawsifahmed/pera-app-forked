import O from"./toast.esm.c05b6e52.js";import Y from"./multiselect.esm.f7939525.js";import q from"./calendar.esm.1b6d8527.js";import J from"./button.esm.388dac8c.js";import K from"./toolbar.esm.fe0d1b79.js";import Q from"./column.esm.0e7ea2df.js";import X from"./datatable.esm.79293d9e.js";import Z from"./tabpanel.esm.a992b45d.js";import ee from"./tabview.esm.8ea79199.js";import{a2 as te,a3 as ae,$ as v,a4 as oe,a5 as le,ar as se,b as G,l as e,w as h,o as $,i as t,u as o,a7 as B,c as U,e as M,a8 as ne,a9 as ie,ca as re}from"./entry.301ffb3a.js";import{u as W}from"./fetch.34ea3734.js";import{u as z}from"./cookie.92fabe3b.js";import{u as de}from"./workCompany.3516056b.js";import"./radiobutton.esm.9223a76d.js";import"./portal.esm.21667c44.js";import"./basecomponent.esm.3ef3224a.js";import"./index.esm.a4fbc4b7.js";import"./baseicon.esm.ae76dc18.js";import"./index.esm.55e3f621.js";import"./index.esm.304061f5.js";import"./index.esm.e8f446c1.js";import"./checkbox.esm.b0f3ce9e.js";import"./index.esm.0c3c4133.js";import"./index.esm.3cb2c250.js";import"./index.esm.34d947f9.js";import"./overlayeventbus.esm.6d6e2075.js";import"./virtualscroller.esm.6321cf3d.js";import"./index.esm.e6ce8021.js";import"./index.esm.f65fce28.js";import"./index.esm.f1cf85e2.js";import"./badge.esm.8601ea29.js";import"./paginator.esm.53ed8919.js";import"./index.esm.0eaa7c6d.js";import"./dropdown.esm.64eb9ca6.js";import"./inputnumber.esm.850e79d6.js";import"./index.esm.96d7a8d4.js";import"./index.esm.0b4b155a.js";import"./inputtext.esm.785b4390.js";import"./index.esm.976e0566.js";import"./index.esm.fc3355bd.js";import"./index.esm.1c2b60d2.js";import"./index.esm.cee30326.js";const i=I=>(ne("data-v-86912460"),I=I(),ie(),I),ce={class:"card"},ue=i(()=>t("div",{class:"d-flex mr-2"},[t("h5",{class:"mb-1"},"Project Reports")],-1)),pe={class:"card"},me=i(()=>t("div",{class:"d-flex mr-2"},[t("h5",{class:"mb-1"},"Task Reports")],-1)),_e={class:"flex gap-2 flex-wrap align-items-center"},fe={class:"user-selection w-full md:w-14rem w-full"},ve=i(()=>t("label",{class:"font-bold block mb-2"},"Spaces:",-1)),he={class:"flex justify-content-center"},be={class:"user-selection w-full md:w-14rem w-full"},ge=i(()=>t("label",{class:"font-bold block mb-2"},"Projects:",-1)),we={class:"flex justify-content-center"},ye={class:"flex-auto"},De=i(()=>t("label",{for:"icondisplay",class:"font-bold block mb-2"},"From: ",-1)),Se={class:"flex-auto"},je=i(()=>t("label",{for:"icondisplay",class:"font-bold block mb-2"},"To: ",-1)),xe={key:0,class:"card"},ke={class:"flex align-items-center justify-content-between gap-2 mb-5"},$e=i(()=>t("h5",{class:"m-0"},"Preview",-1)),Ie={class:"card"},Ne=i(()=>t("p",{class:"text-center"},"No Data found...",-1)),Pe=i(()=>t("br",null,null,-1)),Te={class:"card"},Ce=i(()=>t("div",{class:"flex align-items-center justify-content-between gap-2 mb-5"},[t("h5",{class:"m-0"},"Project Wise Count")],-1)),Ve=i(()=>t("p",{class:"text-center"},"No Data found...",-1)),Fe=i(()=>t("br",null,null,-1)),Be={class:"card"},Me=i(()=>t("div",{class:"flex align-items-center justify-content-between gap-2 mb-5"},[t("h5",{class:"m-0"},"Sprint")],-1)),Ue=i(()=>t("p",{class:"text-center"},"No Data found...",-1)),Re={__name:"index",setup(I){const{totalProjectsforReport:y,totalSpaces:A}=ae(de()),R=re(),p=v(""),m=v(""),r=v(),D=v([]),b=v(),N=v(null),P=v(null),T=v(null),S=v(!1),j=v(!1),C=oe();le(()=>{(!r.value||r.value.length===0)&&(y.value&&y.value.length>0?D.value=[...y.value]:D.value=[])}),se(r,_=>{if(_&&_.length>0){const l=_.flatMap(d=>d.projects);D.value=l}else y.value&&y.value.length>0?D.value=[...y.value]:D.value=[]});const V=_=>{const l=_,d=new Date(l),s=d.getFullYear(),n=String(d.getMonth()+1).padStart(2,"0"),c=String(d.getDate()).padStart(2,"0");return`${s}-${n}-${c}`},L=async()=>{var a,g,u,F,f,E;if(p.value&&!m.value||!p.value&&m.value)return S.value=!1,C.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const _=z("token");S.value=!0;const l=V(p.value),d=V(m.value);let s;r.value&&r.value.length>0&&(s=(a=r.value)==null?void 0:a.map(w=>w.id),console.log("Space ID",s));let n;b.value&&b.value.length>0&&(n=(g=b.value)==null?void 0:g.map(w=>w.id),console.log("Project ID",n));const{data:c,error:x}=await W(`${R.public.apiUrl}/project-report/view?space_ids=${s||""}&project_ids=${n||""}&start_date=${p.value?l:""}&end_date=${m.value?d:""}`,{method:"GET",headers:{Authorization:`Bearer ${_.value}`}},"$tkCbN62YMP");return((u=c.value)==null?void 0:u.code)==200?(N.value=(F=c.value.data)==null?void 0:F.overView.map((w,k)=>({...w,index:k+1})),P.value=(f=c.value.data)==null?void 0:f.projectWiseCount.map((w,k)=>({...w,index:k+1})),T.value=(E=c.value.data)==null?void 0:E.sprintTask.map((w,k)=>({...w,index:k+1})),S.value=!1):(S.value=!1,C.add({severity:"error",summary:"Failed",detail:"Failed to generate!",group:"br",life:3e3}))},H=async()=>{var a,g;const _=z("token");if(j.value=!0,p.value&&!m.value||!p.value&&m.value)return S.value=!1,C.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const l=V(p.value),d=V(m.value);let s;r.value&&r.value.length>0&&(s=(a=r.value)==null?void 0:a.map(u=>u.id),console.log("Space ID",s));let n;b.value&&b.value.length>0&&(n=(g=b.value)==null?void 0:g.map(u=>u.id),console.log("Project ID",n));const{data:c,error:x}=await W(`${R.public.apiUrl}/project-report/download?space_ids=${s||""}&project_ids=${n||""}&start_date=${p.value?l:""}&end_date=${m.value?d:""}`,{method:"GET",headers:{Authorization:`Bearer ${_.value}`}},"$tccjGN5izh");if(x.value)return console.log(x),j.value=!1;if(c.value.code==200){const u=document.createElement("a");return u.href=c.value.download_path,u.target="_blank",u.click(),j.value=!1}else return j.value=!1,C.add({severity:"error",summary:"Failed",detail:"Failed to download",group:"br",life:3e3})};return(_,l)=>{const d=O,s=Y,n=q,c=J,x=K,a=Q,g=X,u=Z,F=ee;return $(),G("div",ce,[e(d,{position:"bottom-right",group:"br"}),ue,e(F,{onTabChange:_.onTabChange,class:"mt-3"},{default:h(()=>[e(u,{class:"file-upload",header:"Project Report"},{default:h(()=>[t("div",pe,[e(d,{position:"bottom-right",group:"br"}),me,e(x,{class:"border-0 px-0"},{start:h(()=>[t("div",_e,[t("div",fe,[ve,t("div",he,[e(s,{display:"chip",modelValue:o(r),"onUpdate:modelValue":l[0]||(l[0]=f=>B(r)?r.value=f:null),options:o(A),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Spaces",class:"w-full"},null,8,["modelValue","options"])])]),t("div",be,[ge,t("div",we,[e(s,{display:"chip",modelValue:o(b),"onUpdate:modelValue":l[1]||(l[1]=f=>B(b)?b.value=f:null),options:o(D),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Projects",class:"w-full"},null,8,["modelValue","options"])])]),t("div",ye,[De,e(n,{modelValue:o(p),"onUpdate:modelValue":l[2]||(l[2]=f=>B(p)?p.value=f:null),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])]),t("div",Se,[je,e(n,{modelValue:o(m),"onUpdate:modelValue":l[3]||(l[3]=f=>B(m)?m.value=f:null),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])])])]),end:h(()=>[e(c,{onClick:L,class:"w-full",label:"Generate",loading:o(S)},null,8,["loading"])]),_:1})]),o(N)||o(P)||o(T)?($(),G("div",xe,[t("div",ke,[$e,e(c,{onClick:H,class:"w-fit",label:"Download",loading:o(j)},null,8,["loading"])]),t("div",Ie,[o(N)?($(),U(g,{key:0,value:o(N),tableStyle:"min-width: 50rem"},{empty:h(()=>[Ne]),default:h(()=>[e(a,{field:"index",header:"Serial",sortable:""}),e(a,{field:"unit_name",header:"Unit Name"}),e(a,{field:"total_iteration",header:"Total Number of Iteration"}),e(a,{field:"total_missed_deadline",header:"No. of Missed Deadlines"}),e(a,{field:"missed_deadline_percentage",header:"% of Missed Deadlines"})]),_:1},8,["value"])):M("",!0)]),Pe,t("div",Te,[Ce,o(P)?($(),U(g,{key:0,value:o(P),tableStyle:"min-width: 50rem"},{empty:h(()=>[Ve]),default:h(()=>[e(a,{field:"index",header:"Serial",sortable:""}),e(a,{field:"project_name",header:"Project Name"}),e(a,{field:"unit_name",header:"Unit Name"}),e(a,{field:"total_iteration",header:"No. of Iteration"}),e(a,{field:"total_missed_deadline",header:"No.of Missed Deadlines"})]),_:1},8,["value"])):M("",!0)]),Fe,t("div",Be,[Me,o(T)?($(),U(g,{key:0,value:o(T),tableStyle:"min-width: 50rem"},{empty:h(()=>[Ue]),default:h(()=>[e(a,{field:"index",header:"Serial",sortable:""}),e(a,{field:"unit_name",style:{width:"40%"},header:"Task Name"}),e(a,{field:"project_name",header:"Project Name"}),e(a,{field:"status",header:"Status"}),e(a,{field:"due_date",header:"Due Date"}),e(a,{field:"end_date",header:"End Date"}),e(a,{field:"duration",header:"Duration"}),e(a,{field:"unit_name",header:"Unit Name"}),e(a,{field:"missed_deadline",header:"Missed Deadlines"})]),_:1},8,["value"])):M("",!0)])])):M("",!0)]),_:1})]),_:1},8,["onTabChange"])])}}},$t=te(Re,[["__scopeId","data-v-86912460"]]);export{$t as default};
