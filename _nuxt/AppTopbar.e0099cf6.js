import Ut from"./toast.esm.cb355044.js";import At from"./button.esm.618db59f.js";import{_ as Lt}from"./nuxt-link.a0ca2aea.js";import{N as at,a as Ot,_ as Vt,b as qt,c as Rt}from"./Search.74a5a094.js";import zt from"./dialog.esm.deaa99fc.js";import{a6 as F,ad as Ft,$ as s,cd as Gt,ae as st,am as Jt,V as Qt,ab as Ht,Y as Wt,a7 as Yt,ai as Kt,b as D,l as u,w as k,i as o,u as i,e as U,c as G,s as J,k as Q,ag as Xt,r as Zt,a as te,o as c,t as ee,ca as oe}from"./entry.adada75d.js";import{u as it}from"./fetch.079d260e.js";import{u as lt}from"./cookie.5d273b70.js";import{_ as ae}from"./avatar.c78ac217.js";import{u as nt}from"./user.d0ba0f9a.js";import{u as rt}from"./clock.a2345e38.js";import{u as ut,o as se,m as ie}from"./auth.44d7461d.js";import"./password.esm.bc89bb62.js";import{u as le}from"./layout.e70b181f.js";import"./portal.esm.39957f2b.js";import"./basecomponent.esm.83c9d650.js";import"./index.esm.5ba39205.js";import"./baseicon.esm.d10b284b.js";import"./index.esm.9f75852a.js";import"./index.esm.5f422ca7.js";import"./index.esm.eede3173.js";import"./badge.esm.87264ac3.js";import"./index.esm.0e5550b4.js";import"./inputtext.esm.447a6bf2.js";import"./floatlabel.esm.ef5866ae.js";import"./tabpanel.esm.80ee0319.js";import"./tabview.esm.a333e13c.js";import"./index.esm.b3310d1a.js";import"./index.esm.b59d805a.js";import"./radiobutton.esm.09c9afe0.js";import"./editor.esm.4b1eb960.js";import"./company.bc3d6c99.js";import"./workCompany.5f1846f7.js";import"./inputicon.esm.1fbfdda3.js";import"./iconfield.esm.8ef790eb.js";import"./card.esm.4a4fb986.js";import"./_commonjsHelpers.87174ba5.js";import"./index.esm.65c6764f.js";import"./overlayeventbus.esm.3d8cd3db.js";const ne={class:"layout-topbar"},re=o("img",{src:ae,alt:"logo"},null,-1),ue=o("i",{class:"pi pi-bars"},null,-1),ce=[ue],de={class:"p-link layout-topbar-menu-button layout-topbar-button"},me={key:0,class:"notification"},pe=o("i",{class:"pi pi-bell"},null,-1),ve=o("i",{class:"pi pi-ellipsis-v"},null,-1),fe=[ve],_e=o("i",{class:"pi pi-moon"},null,-1),be=o("i",{class:"pi pi-sun"},null,-1),ke=o("i",{class:"pi pi-search"},null,-1),he=o("span",null,"Search",-1),ge=[ke,he],ye={class:"relative"},Te={key:0,class:"ping-container"},Ce=o("span",{class:"ping-outer"},null,-1),Se=o("span",{class:"ping-inner"},null,-1),De=[Ce,Se],Ie=o("i",{class:"pi pi-bell"},null,-1),we=o("span",{class:"ml-4"},"Notification",-1),Me=[Ie,we],$e={key:1,class:"notification"},xe={key:0,class:"flex align-items-center gap-2"},Ne={class:"userImage"},Ee=["src"],Pe={key:1,src:Ot,alt:"",style:{height:"50px",width:"50px","border-radius":"50%","object-fit":"cover"}},Be=o("span",{class:"ml-4"},"Profile",-1),je={class:"nclock-wrapper relative ml-2"},Ue=o("i",{class:Q("pi pi-stop text-white"),style:{"font-size":"11px","font-weight":"700"}},null,-1),Ae=[Ue],Le={class:"text-sm absolute text-black time-int",id:"timer-interval"},Oe=o("i",{class:"pi pi-sign-out"},null,-1),Ve=o("span",null,"Sign Out",-1),qe=[Oe,Ve],No={__name:"AppTopbar",setup(Re){var et;const{getStoreTimer:ct,handleCloseDeadlineJustify:H}=rt(),{timerData:r,isTImerStopped:dt,deadlineMissModal:I,deadlineTaskId:mt,deadlineProjectId:pt,deadlineDueDate:vt}=F(rt()),{getUserData:ft}=nt(),{userProfile:A}=F(nt()),_t=Ft(),{layoutConfig:f,onMenuToggle:bt}=le(),h=s(null),w=s(!1),kt=Gt(),W=oe();s("name"),s(null);const{logUserOut:ht}=ut();F(ut());const P=s(!1),L=s(!1),_=s(!1),gt=()=>{ht(),location.reload(),kt.push("/login")};st(()=>{Ct()}),Jt(()=>{St()});const yt=()=>{w.value=!w.value},Tt=Qt(()=>({"layout-topbar-menu-mobile-active":w.value})),Ct=()=>{h.value||(h.value=e=>{Dt(e)&&(w.value=!1)},document.addEventListener("click",h.value))},St=()=>{h.value&&(document.removeEventListener("click",h),h.value=null)},Dt=e=>{if(!w.value)return;const t=document.querySelector(".layout-topbar-menu"),l=document.querySelector(".layout-topbar-menu-button");return!(t.isSameNode(e.target)||t.contains(e.target)||l.isSameNode(e.target)||l.contains(e.target))},It=()=>{_.value&&(_.value=!1,y.value=!1)},Y=e=>{_.value=e},g={beforeMount(e,t){e.clickOutsideEvent=l=>{e==l.target||e.contains(l.target)||t.value(l)},document==null||document.body.addEventListener("click",e.clickOutsideEvent)},unmounted(e){var t;(t=document==null?void 0:document.body)==null||t.removeEventListener("click",e.clickOutsideEvent)}};Ht(()=>{const e=document.querySelector(".relative");g==null||g.unmounted(e)}),ft();const wt=()=>{P.value=!P.value},Mt=Wt(),$t=(e,t)=>{Mt.changeTheme(f.theme.value,e,"theme-css",()=>{f.theme.value=e,f.darkTheme.value=t})},B=e=>{const t=e?f.theme.value.replace("light","dark"):f.theme.value.replace("dark","light");console.log("New Theme: ==>",t),e?localStorage.setItem("mode","dark"):localStorage.setItem("mode","light"),f.darkTheme.value=e,$t(t,e)};st(async()=>{const e=document.querySelector(".relative");g==null||g.beforeMount(e,{value:It}),localStorage.getItem("mode")==="dark"?await B(!0):await B(!1)});const y=s(!1);(async()=>{const e=lt("token");try{const{data:t,pending:l,error:d}=await it(`${W.public.apiUrl}/notification/list?limit=5&page=1`,{method:"GET",headers:{Authorization:`Bearer ${e.value}`}},"$QWEnQlnRVH");t.value&&(t.value.data.find(m=>m.is_read===0)?y.value=!0:y.value=!1)}catch(t){console.log(t)}})();const K=()=>{_.value=!_.value,y.value&&(y.value=!1)};s(!1);const O=s(),X=s(),Z=s(),M=s(),tt=localStorage.getItem("storeTaskCompanyID");localStorage.getItem("storeTaskSpaceID"),localStorage.getItem("storeTaskProjectID"),localStorage.getItem("storeTaskID");const xt=s(),V=s();(async()=>{var t,l,d,m,p,C,v,S,b,$,x,N,E;const e=lt("token");try{const{data:n,pending:R,error:z}=await it(`${W.public.apiUrl}/tasks/timer-history`,{method:"GET",headers:{Authorization:`Bearer ${e.value}`}},"$h9G4Eef10F");n.value&&(xt.value=(l=(t=n.value)==null?void 0:t.data)==null?void 0:l.is_timer_start,((m=(d=n.value)==null?void 0:d.data)==null?void 0:m.is_timer_start)==="true"&&(O.value=(p=n.value)==null?void 0:p.data.company_id,X.value=(v=(C=n.value)==null?void 0:C.data)==null?void 0:v.space_id,Z.value=(b=(S=n.value)==null?void 0:S.data)==null?void 0:b.project_id,M.value=(x=($=n.value)==null?void 0:$.data)==null?void 0:x.task_id,V.value=(E=(N=n.value)==null?void 0:N.data)==null?void 0:E.start_time))}catch(n){console.log(n)}})();const Nt=s();r.value&&(Nt.value=(et=r.value)==null?void 0:et.task_id),tt&&(O.value=tt),Yt(r,(e,t)=>{t&&(M.value=t.task_id)});let T=null;function q(e){const t=document.getElementById("timer-interval");if(e==="stop"){T&&(clearInterval(T),T=null);return}else{let d=function(){const p=new Date-l,C=Math.floor(p/(1e3*60*60)),v=Math.floor(p%(1e3*60*60)/(1e3*60)),S=Math.floor(p%(1e3*60)/1e3);return`${String(C).padStart(2,"0")}:${String(v).padStart(2,"0")}:${String(S).padStart(2,"0")}`};const l=new Date(e);return t&&(t.style.visibility="hidden"),setTimeout(()=>{t&&(t.style.visibility="visible")},500),T&&clearInterval(T),T=setInterval(()=>{t&&(t.textContent=d())},1e3),d()}}ct(),Kt(async()=>{dt.value===!0&&(M.value=null,q("stop")),r.value||M.value?L.value=!0:L.value=!1});const j=s(!1),Et=e=>{j.value=!1},Pt=()=>{I.value=!1,H()},Bt=()=>{I.value=!1,H()};return se(ie,e=>{console.log(e),_t.add({severity:"contrast",summary:e.notification.title,detail:e.notification.body,life:3e3})}),(e,t)=>{var $,x,N,E,n,R,z;const l=Ut,d=Zt("router-link"),m=At,p=Lt,C=qt,v=zt,S=Rt,b=te("tooltip");return c(),D("div",ne,[u(l,{position:"bottom-right",group:"br"}),u(d,{to:"/",class:"layout-topbar-logo absolute"},{default:k(()=>[re]),_:1}),o("button",{class:"p-link layout-menu-button layout-topbar-button",style:{"margin-left":"0 !important"},onClick:t[0]||(t[0]=a=>i(bt)())},ce),o("div",de,[o("button",{class:"nav-btn",onClick:K},[_.value?(c(),D("div",me,[u(at,{onCloseNotification:t[1]||(t[1]=a=>Y(a))})])):U("",!0),pe]),o("button",{class:"nav-btn",onClick:t[2]||(t[2]=a=>yt())},fe)]),o("div",{class:Q(["layout-topbar-menu",Tt.value])},[i(f).darkTheme.value?(c(),G(m,{key:0,onClick:t[3]||(t[3]=()=>B(!1)),class:"p-link layout-topbar-button",text:"",rounded:"","aria-label":"Filter"},{default:k(()=>[_e]),_:1})):(c(),G(m,{key:1,onClick:t[4]||(t[4]=()=>B(!0)),class:"p-link layout-topbar-button",text:"",rounded:"","aria-label":"Filter"},{default:k(()=>[be]),_:1})),o("button",{class:"p-link layout-topbar-button ml-0",onClick:t[5]||(t[5]=a=>j.value=!0),style:{"padding-top":"0.1rem"}},ge),o("div",ye,[y.value?(c(),D("div",Te,De)):U("",!0),o("button",{onClick:K,class:"p-link layout-topbar-button notify-btn ml-0"},Me),_.value?(c(),D("div",$e,[u(at,{onCloseNotification:t[6]||(t[6]=a=>Y(a))})])):U("",!0)]),o("button",{onClick:wt,class:"p-link layout-topbar-button"},[(x=($=i(A))==null?void 0:$.data)!=null&&x.image?J((c(),D("div",xe,[o("div",Ne,[o("img",{src:`${(E=(N=i(A))==null?void 0:N.data)==null?void 0:E.image}`,class:"",style:{height:"100%",width:"100%","object-fit":"cover"}},null,8,Ee)])])),[[b,{value:"Profile"},void 0,{bottom:!0}]]):J((c(),D("img",Pe,null,512)),[[b,{value:"Profile"},void 0,{bottom:!0}]]),Be]),L.value?J((c(),G(p,{key:2,to:{path:`/companies/${O.value}/spaces/${i(r)?(n=i(r))==null?void 0:n.space_id:X.value}/projects/${i(r)?(R=i(r))==null?void 0:R.project_id:Z.value}`,query:{task_key:i(r)?(z=i(r))==null?void 0:z.task_id:M.value}},class:"flex absolute gap-2 align-items-center ntask-timer-wrapper mr-2"},{default:k(()=>{var a,ot;return[o("div",je,[o("div",{class:Q("nclock-btn bg-pink-300"),onClick:t[7]||(t[7]=(...jt)=>e.handleClickClock&&e.handleClickClock(...jt))},Ae),o("div",Le,ee((a=i(r))!=null&&a.timerStartTime?q((ot=i(r))==null?void 0:ot.timerStartTime):V.value?q(V.value):" "),1)])]}),_:1},8,["to"])),[[b,{value:"Active Task"},void 0,{left:!0}]]):U("",!0),o("button",{onClick:gt,class:"p-link layout-topbar-button"},qe)],2),u(v,{visible:P.value,"onUpdate:visible":t[8]||(t[8]=a=>P.value=a),modal:"",header:"Profile",dismissableMask:"true",style:{width:"65rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:k(()=>[u(C,{userProfile:i(A)},null,8,["userProfile"])]),_:1},8,["visible"]),u(v,{visible:i(I),"onUpdate:visible":[t[10]||(t[10]=a=>Xt(I)?I.value=a:null),Bt],modal:"",header:"Deadline Miss Justification",style:{width:"45rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:k(()=>[u(S,{onCloseMissDeadlineModal:t[9]||(t[9]=a=>Pt(a)),deadlineTaskId:i(mt),deadlineProjectId:i(pt),deadlineDueDate:i(vt)},null,8,["deadlineTaskId","deadlineProjectId","deadlineDueDate"])]),_:1},8,["visible"]),u(v,{visible:j.value,"onUpdate:visible":t[12]||(t[12]=a=>j.value=a),modal:"",header:"Search",dismissableMask:"true",position:"top",class:"search-container"},{default:k(()=>[u(Vt,{onCloseSearch:t[11]||(t[11]=a=>Et(a))})]),_:1},8,["visible"])])}}};export{No as default};
