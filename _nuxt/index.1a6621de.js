import{ao as D,o as b,b as x,ap as T,aq as V,i as h,an as M,$ as p,al as N,a4 as z,l as n,c as R,e as G,w as g,q as H,K as L,t as O,a6 as q,a2 as Y}from"./entry.570ab878.js";import K from"./calendar.esm.b28ea8e1.js";import j from"./dropdown.esm.4fa36b0b.js";import J from"./button.esm.a55c2431.js";import Q from"./column.esm.6208f1b7.js";import W from"./datatable.esm.3837e306.js";import{u as f,a as X}from"./cookie.3ed14f9e.js";import{u as k}from"./fetch.11b9759f.js";import{a as Z}from"./usePermission.23a55d5e.js";import"./baseicon.esm.c7f0dea4.js";import"./basecomponent.esm.c7fbaad5.js";import"./index.esm.d468d720.js";import"./index.esm.7c91399e.js";import"./index.esm.b806f7cb.js";import"./index.esm.e138fc7f.js";import"./overlayeventbus.esm.c91907e9.js";import"./portal.esm.1e4af6e4.js";import"./badge.esm.54d3e6c5.js";import"./index.esm.b72e702d.js";import"./index.esm.330f474a.js";import"./index.esm.2cce7489.js";import"./index.esm.c6f3b761.js";import"./virtualscroller.esm.84c3372a.js";import"./paginator.esm.23dce669.js";import"./index.esm.c592065e.js";import"./inputnumber.esm.9d737ca0.js";import"./index.esm.bb3da758.js";import"./index.esm.e450f24c.js";import"./inputtext.esm.5cd40da3.js";import"./index.esm.f3846021.js";import"./index.esm.feb1baca.js";import"./checkbox.esm.1ad534d4.js";import"./radiobutton.esm.b232767f.js";import"./index.esm.a8b59750.js";import"./index.esm.ecdc2543.js";const ee=o=>(T("data-v-aed9c1b5"),o=o(),V(),o),te={class:"header pl-0"},ae=ee(()=>h("h3",null,"Employee Attendance Report",-1)),oe=[ae],ne={__name:"AttendanceHeader",props:{createModal:Boolean},setup(o){return(i,l)=>(b(),x("header",te,oe))}},re=D(ne,[["__scopeId","data-v-aed9c1b5"]]),C=M("attendanceStore",{state:()=>({attendance:[]}),actions:{async getAttendance(o,i=null){const l=f("token");try{const u=await k(`https://pbe.singularitybd.net/api/v1/attendance/list?user=${i||""}&month=`,{method:"GET",headers:{Authorization:`Bearer ${l.value}`}},"$Wa8V9mUymk");if(u)this.data=u.data;else throw new Error("Failed to fetch attendance ")}catch(u){console.log("Get Attendance: ",u)}},async googleAttendance(o){const i=f("token");try{if(!(await k("",{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:o},"$KaQ3yky8u2")).ok)throw new Error("Failed to post Google Attendance")}catch(l){console.log("Google Attendance: ",l)}}}});const se=o=>(T("data-v-1fdadbb5"),o=o(),V(),o),le={class:"flex justify-content-between py-2"},ce={class:"flex align-items-center"},de=se(()=>h("p",{class:"text-center"},"No Data found.",-1)),ie={__name:"AttendanceTable",setup(o){const i=p(Z("all_user_attendance")),l=q(),u=p({present:"green",absent:"red",late:"orange"}),c=p(null);c.value=new Date(new Date().getFullYear(),new Date().getMonth(),1);const v=p(null),S=p([]),B=async r=>{var a,d,e;const t=f("token"),{data:s,pending:_,error:m}=await X("taskAssignModalData",()=>$fetch(`${l.public.apiUrl}/users/list${r?`?role_id=${r}`:""}`,{headers:{Authorization:`Bearer ${t.value}`}}));((d=(a=s.value)==null?void 0:a.data)==null?void 0:d.length)>0&&(S.value=(e=s.value)==null?void 0:e.data.map((I,U)=>({...I,index:U+1})))},y=p(null),w=p(null);N(c,()=>console.log(c));const $=async()=>{const r=`${c.value.getFullYear()}-${String(c.value.getMonth()+1).padStart(2,"0")}`;y.value=r,console.log("formattedDate",y.value),w.value=v.value?v.value.id:"",await F(y.value,w.value)},E=()=>{c.value=new Date(new Date().getFullYear(),new Date().getMonth(),1),v.value=null,w.value=null,$()},A=p([]),F=async(r="",t="")=>{try{const s=f("token"),_=r?`&month=${r}`:"",m=t?`&user[]=${t}`:"",{data:a,error:d}=await k(`${l.public.apiUrl}/attendance/list?${_}${m}`,{method:"GET",headers:{Authorization:`Bearer ${s.value}`}},"$RNaJqT9hwn");if(d.value){console.error("Error fetching attendance data:",d.value);return}a.value?A.value=a.value.data:(A.value=[],console.warn("API returned no data. Check the server or parameters"))}catch(s){console.error("An unexpected error occurred:",s)}},P=async()=>{const r=f("token"),t=y.value,s=w.value,_=t?`month=${t}`:"",m=s?`&user[]=${s}`:"",{data:a,error:d}=await k(`${l.public.apiUrl}/attendance/download?${_}${m}`,{method:"GET",headers:{Authorization:`Bearer ${r.value}`}},"$0AyfFtvo6V");if(d.value){console.error("Error fetching attendance data:",d.value);return}if(a.value){const e=document.createElement("a");e.href=a.value.download_path,e.target="_blank",e.setAttribute("download",`attendance-${t}.csv`),document.body.appendChild(e),e.click()}else console.warn("API returned no data. Check the server or parameters")};return B(),z(()=>{$()}),(r,t)=>{const s=K,_=j,m=J,a=Q,d=W;return b(),x("div",null,[h("div",le,[h("div",ce,[n(s,{onDateSelect:t[0]||(t[0]=e=>$(e,r.slotProps)),modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),view:"month",dateFormat:"mm/yy",placeholder:"Select Month"},null,8,["modelValue"]),i.value?(b(),R(_,{key:0,onChange:t[2]||(t[2]=e=>$()),modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),options:S.value,filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Employee",class:"w-full md:w-17rem ml-2"},null,8,["modelValue","options"])):G("",!0),n(m,{onClick:P,label:"Download",class:"ml-2",severity:"primary"}),n(m,{onClick:E,label:"Reset",class:"ml-2",severity:"secondary"})])]),n(d,{class:"table-st",value:A.value,rowHover:!0,paginator:!1,rows:30,stripedRows:"",scrollable:"",scrollHeight:"62vh",tableStyle:"min-width: 50rem",rowsPerPageOptions:[5,10,20,50]},{empty:g(()=>[de]),loading:g(()=>[H(" Loading. Please wait... ")]),default:g(()=>[n(a,{style:{width:"12%"},field:"user_name",header:"Name"}),n(a,{style:{width:"12%"},field:"date",header:"Date"}),n(a,{style:{width:"12%"},field:"day",header:"Day"}),n(a,{style:{width:"12%"},field:"start_time",header:"IN"}),n(a,{style:{width:"12%"},field:"end_time",header:"OUT"}),n(a,{style:{width:"12%"},field:"type",header:"Type"}),n(a,{style:{width:"12%"},field:"status",header:"Status"},{body:g(e=>[h("div",null,[h("span",{style:L(`color:${u.value[e.data.status.toLowerCase()]}; text-transform:capitalize `)},O(e.data.status),5)])]),_:1})]),_:1},8,["value"])])}}},ue=D(ie,[["__scopeId","data-v-1fdadbb5"]]);const pe={class:"card"},me={__name:"index",setup(o){return C(),Y(C()),(i,l)=>{const u=re,c=ue;return b(),x("div",pe,[n(u),n(c)])}}},Je=D(me,[["__scopeId","data-v-159d9ec0"]]);export{Je as default};
