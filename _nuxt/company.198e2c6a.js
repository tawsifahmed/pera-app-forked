import{u as d,a as S}from"./cookie.3ed14f9e.js";import{u as v}from"./fetch.11b9759f.js";import{an as F}from"./entry.570ab878.js";import{u as Y}from"./workCompany.886927d5.js";const $=Y(),R=F("workStation",{state:()=>({loading:!1,createCompany:null,isCompanyCreated:!1,isCompanyDeleted:!1,isCompanyEdited:!1,compList:null,companyId:null,singleCompany:null,singleCompanySpaces:null,singleCompanyName:null,isCompanySwitched:!1,companySwitchToast:null,spaceList:null,isSpaceCreated:!1,isSpaceDeleted:!1,isSpaceEdited:!1,singleSpace:null,singleSpaceProjects:null,spaceSidebarlist:[],projectList:null,isProjectCreated:!1,isProjectEdited:!1,isProjectDeleted:!1,singleProject:null,taskList:null,isTaskCreated:!1,detectDuplicateTask:!1,isTaskDeleted:!1,isTaskEdited:!1,tasks:[],kanbanTasks:[],calendarTasks:[],ganttChartData:[],recentTaskData:[],tasksAttachments:[],totalTaskCount:[],countTasksByStatus:[],taskStatusCounts:[],asngUsers:[],subTasks:[],isGetApiCalled:!1,taskDetails:[],taskActivity:[],taskStatus:[],users:[],tags:[],priorityList:[],singleTaskComments:null,isTaskCommentCreated:!1,statuslist:[],modStatusList:[],chartProjectInfo:null,totalDashboardProjects:null,completedTasksChartData:0,inProgressTasksChartData:0,unAssignedTasksChartData:0,inProgressCnt:null,chartClosedTaskInfo:null,rolesLists:null,cookieOptions:{maxAge:60*60*24*30,priority:"high",sameSite:!0,secure:!0}}),actions:{async getCompanyList(){var i,s,n;const e=d("token"),{data:t,pending:a,error:c}=await S("compList",()=>$fetch("https://pbe.singularitybd.net/api/v1/company/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.compList=(i=t.value)==null?void 0:i.data.map((o,r)=>({...o,index:r+1})),this.singleCompanyName=(n=(s=t.value)==null?void 0:s.data[0])==null?void 0:n.name},async getSingleCompany(e){var s,n;const t=d("token"),{data:a,pending:c,error:i}=await S("singleCompany",()=>$fetch(`https://pbe.singularitybd.net/api/v1/company/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleCompany=(s=a.value)==null?void 0:s.data,this.singleCompanySpaces=(n=this.singleCompany)==null?void 0:n.spaces.map((o,r)=>({...o,index:r+1}))},async createCompany({name:e,email:t,address:a,contact_number:c,number_of_employees:i,company_type:s,logo:n}){var k,y,D,w,P,A;const o=d("token"),r=new FormData;r.append("name",e),r.append("email",t),r.append("address",a),r.append("contact_number",c),r.append("number_of_employees",i),r.append("company_type",s),n!=null&&r.append("image",n);const{data:l,pending:m}=await v("https://pbe.singularitybd.net/api/v1/company/create",{method:"POST",headers:{Authorization:`Bearer ${o.value}`},body:r},"$FPXU5moxCx");if(((k=l.value)==null?void 0:k.app_message)==="success"){localStorage.setItem("userCompany",JSON.stringify((D=(y=l.value)==null?void 0:y.data)==null?void 0:D.id)),this.isCompanyCreated=!0,this.companyId=(P=(w=l.value)==null?void 0:w.data)==null?void 0:P.id;const b=d("rolePermission",this.cookieOptions);b.value=(A=l==null?void 0:l.value)==null?void 0:A.permissions,await this.getCompanyList(),await $.getCompany()}},async editCompany({id:e,name:t,email:a,address:c,contact_number:i,number_of_employees:s,company_type:n,logo:o}){var y;const r=d("token"),l=new FormData;l.append("name",t),l.append("email",a),l.append("address",c),l.append("contact_number",i),l.append("number_of_employees",s),l.append("company_type",n),o!=null?l.append("image",o):l.append("image",null);const{data:m,pending:k}=await v(`https://pbe.singularitybd.net/api/v1/company/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:l},"$LkMGR8lsUV");((y=m.value)==null?void 0:y.app_message)==="success"&&(this.isCompanyEdited=!0,this.getCompanyList(),await $.getCompany())},async switchCompany(e){var i,s,n;const t=d("token"),{data:a,pending:c}=await v("https://pbe.singularitybd.net/api/v1/switch-company",{method:"POST",headers:{Authorization:`Bearer ${t.value}`},body:{company_id:e}},"$y3MaeJU29x");if(((i=a.value)==null?void 0:i.code)===200){const o=d("userType");o.value=(s=a==null?void 0:a.value)==null?void 0:s.user_type;const r=d("rolePermission",this.cookieOptions);r.value=(n=a==null?void 0:a.value)==null?void 0:n.permissions,this.isCompanySwitched=!0,this.companySwitchToast=a.value.message,location.reload()}else this.isCompanySwitched=!1,this.companySwitchToast="Unable to switch company"},async deleteCompany(e){var i;const t=d("token"),{data:a,pending:c}=await v(`https://pbe.singularitybd.net/api/v1/company/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.value}`},body:{id:e}},"$m5SlSHdl7U");((i=a.value)==null?void 0:i.app_message)==="success"&&(this.isCompanyDeleted=!0,await $.getCompany(),this.getCompanyList())},async getSpaceList(){var a,c;let e=null;e=JSON.parse(localStorage.getItem("userCompany"));const t=d("token");if(e){const{data:i,pending:s,error:n}=await S("spaceList",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/list/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.spaceList=(a=i.value)==null?void 0:a.data,((c=this.spaceList)==null?void 0:c.length)>0&&(this.spaceSidebarlist=[],this.spaceList.forEach(o=>{let r={label:o==null?void 0:o.name,icon:"pi pi-globe",to:`/companies/${o==null?void 0:o.company_id}/spaces/${o==null?void 0:o.id}`};this.spaceSidebarlist.push(r)}))}},async getSingleSpace(e){var s,n;const t=d("token"),{data:a,pending:c,error:i}=await S("singleSpace",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleSpace=(s=a.value)==null?void 0:s.data,this.singleSpaceProjects=(n=this.singleSpace)==null?void 0:n.projects.map((o,r)=>({...o,index:r+1}))},async createSpace({name:e,description:t,company_id:a,color:c,users:i}){var r;const s=d("token"),{data:n,pending:o}=await v("https://pbe.singularitybd.net/api/v1/space/create",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{name:e,description:t,company_id:a,color:c,users:i}},"$RESrNdzmLo");((r=n.value)==null?void 0:r.app_message)==="success"&&(this.isSpaceCreated=!0)},async editSpace({id:e,name:t,description:a,company_id:c,color:i,users:s}){var l;const n=d("token"),{data:o,pending:r}=await v(`https://pbe.singularitybd.net/api/v1/space/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${n.value}`},body:{id:e,name:t,description:a,company_id:c,color:i,users:s}},"$11QSDyM4E2");((l=o.value)==null?void 0:l.app_message)==="success"&&(this.isSpaceEdited=!0,await $.getCompany(),this.getSingleCompany(c))},async deleteSpace(e,t){var s;const a=d("token"),{data:c,pending:i}=await v(`https://pbe.singularitybd.net/api/v1/space/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$lPsqIgvGMV");((s=c.value)==null?void 0:s.app_message)==="success"&&(this.isSpaceDeleted=!0,await $.getCompany(),this.getSingleCompany(t))},async getProjectList(){var i;const e=d("token"),{data:t,pending:a,error:c}=await S("projectList",()=>$fetch("https://pbe.singularitybd.net/api/v1/space/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.spaceList=(i=t.value)==null?void 0:i.data},async getSingleProject(e,t="",a="",c="",i="",s="",n=""){var _,O,N;this.isGetApiCalled=!1;const o=d("token");t&&(t=t.join(","));const{data:r,pending:l,error:m}=await S("singleProject",()=>$fetch(`
          https://pbe.singularitybd.net/api/v1/projects/show/${e}?assignees=${t}&priority=${a}&status=${c}&search=${i}&start=${s}&end=${n}`,{headers:{Authorization:`Bearer ${o.value}`}}));this.singleProject=(_=r.value)==null?void 0:_.data,this.tasks=(O=r.value)==null?void 0:O.tasks,this.isGetApiCalled=!0,this.statuslist=(N=r.value)==null?void 0:N.taskStatus;function k(p,f){return f.map(g=>{const u=[];function C(h){h.data.status.name===g.name&&u.push(h),h.children&&h.children.length>0&&h.children.forEach(T=>C(T))}return p.forEach(h=>C(h)),{name:g.name,statusColor:g.color_code,status:g,content:u}})}const y=k(this.tasks,this.statuslist);this.kanbanTasks=y;const D=this.tasks.map(p=>{var g,u;const f=C=>{const h=new Date(C),T=h.getFullYear(),L=String(h.getMonth()+1).padStart(2,"0"),B=String(h.getDate()).padStart(2,"0"),z=String(h.getHours()).padStart(2,"0"),I=String(h.getMinutes()).padStart(2,"0");return`${T}-${L}-${B} ${z}:${I}`};return{key:p.key,title:p.data.name,start:f(p.data.created_at),end:p.data.dueDate?f(p.data.dueDate):f(p.data.created_at),color:(u=(g=p.data)==null?void 0:g.status)==null?void 0:u.color_code}});this.calendarTasks=D,this.modStatusList=[{name:"All",code:""},...this.statuslist];function w(p){let f=[];function g(u){const{name:C,created_at:h,dueDate:T,status:L}=u.data;h&&T&&f.push({x:C,y:[new Date(h).getTime(),new Date(T).getTime()],fillColor:L.color_code}),u.children&&u.children.length>0&&u.children.forEach(B=>g(B))}return p.forEach(u=>g(u)),[{data:f}]}function P(p){let f=[];const g=new Date().getTime(),u=g-3*24*60*60*1e3;function C(h){const{name:T,created_at:L,dueDate:B,status:z}=h.data,{key:I}=h,x=new Date(L).getTime();x>=u&&x<=g&&f.push({key:I,taskName:T,dueDate:B,statusName:z.name,statusColor:z.color_code}),h.children&&h.children.length>0&&h.children.forEach(M=>C(M))}return p.forEach(h=>C(h)),f}function A(p){let f=0;function g(u){f++,u.children&&u.children.length>0&&u.children.forEach(C=>g(C))}return p.forEach(u=>g(u)),{totalTaskCount:f}}const b=this.statuslist.map(p=>({statusName:p.name,statusColor:p.color_code,taskCount:0}));function E(p){const f=p.data.status,g=b.findIndex(u=>u.statusName===f.name);g!==-1&&(b[g].taskCount+=1),p.children&&p.children.length>0&&p.children.forEach(u=>E(u))}this.tasks.forEach(p=>E(p)),this.countTasksByStatus=b;let j=A(this.tasks);this.recentTaskData=P(this.tasks),this.totalTaskCount=j.totalTaskCount,this.ganttChartData=w(this.tasks)},async createProject({name:e,description:t,space_id:a,statuses:c}){var o;const i=d("token"),{data:s,pending:n}=await v("https://pbe.singularitybd.net/api/v1/projects/create",{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:{name:e,description:t,space_id:a,statuses:c}},"$dFqFkzlBiI");((o=s.value)==null?void 0:o.app_message)==="success"&&(this.isProjectCreated=!0,await $.getCompany(),this.getSingleSpace(a),this.getChartData())},async editProject({id:e,name:t,description:a,space_id:c,statuses:i,git_project_id:s,git_token:n,is_archive:o}){var k;const r=d("token"),{data:l,pending:m}=await v(`https://pbe.singularitybd.net/api/v1/projects/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:{id:e,name:t,description:a,space_id:c,statuses:i,git_project_id:s,git_token:n,is_archive:o}},"$74BArWPOdE");((k=l.value)==null?void 0:k.app_message)==="success"&&(this.isProjectEdited=!0,await $.getCompany(),this.getSingleSpace(c))},async deleteProject(e,t){var s;const a=d("token"),{data:c,pending:i}=await v(`https://pbe.singularitybd.net/api/v1/projects/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$BnkY4zQQhW");((s=c.value)==null?void 0:s.app_message)==="success"&&(this.isProjectDeleted=!0,await $.getCompany(),this.getSingleSpace(t))},async getTaskDetails(e){var n,o,r,l,m;const t=d("token"),{data:a,pending:c,error:i}=await S("taskDetails",()=>$fetch(`https://pbe.singularitybd.net/api/v1/tasks/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.taskDetails=(n=a.value)==null?void 0:n.data,this.taskActivity=(o=a.value)==null?void 0:o.taskActivity,this.singleTaskComments=(r=a.value)==null?void 0:r.data.comments,this.subTasks=(l=a.value)==null?void 0:l.subTasks,this.taskStatus=[];let s=(m=a.value)==null?void 0:m.taskStatus;s&&s.length>0&&s.forEach(k=>{let y={name:k.name,code:k.id};this.taskStatus.push(y)})},async createTask({name:e,description:t,project_id:a,parent_task_id:c,dueDate:i,priority:s,assignees:n,tags:o}){const r=d("token"),{data:l,error:m,pending:k}=await v("https://pbe.singularitybd.net/api/v1/tasks/create",{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:{name:e,project_id:a,parent_task_id:c,due_date:i,priority:s,assignees:n,tags:o,description:t}},"$yabYYCCfIV");if(m.value&&m.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskCreated=!1),l.value&&l.value.code===201){this.isTaskCreated=!0,this.detectDuplicateTask=!1,this.getSingleProject(a);let y=Number(localStorage.getItem("taskDetailID"));return y&&this.getTaskDetails(y),l.value}},async editTask({id:e,name:t,description:a,project_id:c,dueDate:i,priority:s,assignees:n,tags:o}){const r=d("token"),{data:l,error:m,pending:k}=await v(`https://pbe.singularitybd.net/api/v1/tasks/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:{id:e,name:t,description:a,due_date:i,priority:s,assignees:n,tags:o,project_id:c}},"$vVLnpjK6QE");if(m.value&&m.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskEdited=!1),l.value&&l.value.code===200){this.isTaskEdited=!0,this.detectDuplicateTask=!1,this.getSingleProject(c);let y=Number(localStorage.getItem("taskDetailID"));y&&this.getTaskDetails(y)}},async deleteTask(e,t){var s;const a=d("token"),{data:c,pending:i}=await v(`https://pbe.singularitybd.net/api/v1/tasks/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$4BH7YSjOJ4");if(((s=c.value)==null?void 0:s.app_message)==="success"){this.isTaskDeleted=!0,this.getSingleProject(t);let n=Number(localStorage.getItem("taskDetailID"));n&&this.getTaskDetails(n)}},async getTaskAssignModalData(){var i,s,n;const e=d("token"),{data:t,pending:a,error:c}=await S("taskAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/users/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0&&(this.users=[],(n=t.value)==null||n.data.forEach(o=>{let r={id:o.id,name:o.name};this.users.push(r)}))},async getTagsAssignModalData(){var i,s,n;const e=d("token"),{data:t,pending:a,error:c}=await S("tagsAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/tag/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0&&(this.tags=[],(n=t.value)==null||n.data.forEach(o=>{let r={id:o.id,name:o.name};this.tags.push(r)}))},async addTaskComment(e,t,a,c=[]){var r;const i=new FormData;i.append("comment",t),i.append("commentable_id",e),i.append("file",a),(c==null?void 0:c.length)>0&&c.forEach((l,m)=>i.append(`user_id[${m}]`,l));const s=d("token"),{data:n,pending:o}=await v("https://pbe.singularitybd.net/api/v1/comments/create",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:i},"$Sdwr0JJQY2");((r=n.value)==null?void 0:r.app_message)==="success"&&(this.isTaskCommentCreated=!0,this.getTaskDetails(e))},async getChartData(){var i,s,n,o,r,l,m,k,y,D,w,P,A,b,E;const e=d("token"),{data:t,pending:a,error:c}=await S("chartData",()=>$fetch("https://pbe.singularitybd.net/api/v1/dashboard/task-status",{headers:{Authorization:`Bearer ${e.value}`}}));((i=t==null?void 0:t.value)==null?void 0:i.code)===200?(this.chartProjectInfo=(n=(s=t==null?void 0:t.value)==null?void 0:s.data)==null?void 0:n.projectCounts.map(j=>{let _=j.project_name;return _.length>7&&(_=_.substring(0,7)+"..."),_}),this.inProgressCnt=(r=(o=t==null?void 0:t.value)==null?void 0:o.data)==null?void 0:r.projectCounts.map(j=>j.inProgressCounts),this.chartClosedTaskInfo=(m=(l=t==null?void 0:t.value)==null?void 0:l.data)==null?void 0:m.projectCounts.map(j=>j.completedCounts),this.totalDashboardProjects=(y=(k=t==null?void 0:t.value)==null?void 0:k.data)==null?void 0:y.projectCounts.length,this.completedTasksChartData=(w=(D=t==null?void 0:t.value)==null?void 0:D.data)==null?void 0:w.completed,this.inProgressTasksChartData=(A=(P=t==null?void 0:t.value)==null?void 0:P.data)==null?void 0:A.inProgress,this.unAssignedTasksChartData=(E=(b=t==null?void 0:t.value)==null?void 0:b.data)==null?void 0:E.unAssigneeCount):(this.chartProjectInfo=[],this.inProgressCnt=[])},async getRoles(){var i,s,n;const e=d("token"),{data:t,pending:a,error:c}=await S("roleLit",()=>$fetch("https://pbe.singularitybd.net/api/v1/roles/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(i=t.value)==null?void 0:i.data)==null?void 0:s.length)>0?this.rolesLists=(n=t.value)==null?void 0:n.data:this.rolesLists=[]},formatDate(e){const t=new Date(e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}/${t.getFullYear()}`}}});export{R as u};
