import M from"./toast.esm.f0a01f39.js";import R from"./multiselect.esm.10f8f47c.js";import U from"./calendar.esm.284caf7a.js";import G from"./button.esm.e7b23919.js";import Y from"./toolbar.esm.4653dd33.js";import z from"./column.esm.3284b2fd.js";import A from"./datatable.esm.43a9b326.js";import O from"./tabpanel.esm.2d0cd081.js";import W from"./tabview.esm.6d631f88.js";import{a2 as H,a3 as L,$ as b,a4 as q,b as T,l as e,w as v,o as C,i as l,u as _,a7 as $,e as J,a8 as K,a9 as Q,ca as X}from"./entry.270ea170.js";import{u as V}from"./fetch.673ab5ce.js";import{u as F}from"./cookie.ea11622d.js";import{u as Z}from"./workCompany.bb99db00.js";import"./radiobutton.esm.a42e80d6.js";import"./portal.esm.0b1180d3.js";import"./basecomponent.esm.d974fda6.js";import"./index.esm.ca71834f.js";import"./baseicon.esm.35ad2674.js";import"./index.esm.197fbc24.js";import"./index.esm.a78582f4.js";import"./index.esm.09cf9c34.js";import"./checkbox.esm.531a9fa5.js";import"./index.esm.090b1be6.js";import"./index.esm.5dc4405e.js";import"./index.esm.bca9d4ac.js";import"./overlayeventbus.esm.0874a092.js";import"./virtualscroller.esm.090b77e5.js";import"./index.esm.c95a04a6.js";import"./index.esm.e20745fc.js";import"./index.esm.885ac60e.js";import"./badge.esm.185cbf9d.js";import"./paginator.esm.ed4347f3.js";import"./index.esm.afc0758e.js";import"./dropdown.esm.1b351a9c.js";import"./inputnumber.esm.a416a7c7.js";import"./index.esm.081327b9.js";import"./index.esm.b4bf39a7.js";import"./inputtext.esm.522665ec.js";import"./index.esm.71df58de.js";import"./index.esm.72830395.js";import"./index.esm.789de33f.js";import"./index.esm.e0bbe8f4.js";const h=y=>(K("data-v-10953739"),y=y(),Q(),y),ee={class:"card"},te=h(()=>l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"Project Reports")],-1)),ae={class:"card"},oe=h(()=>l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"Task Reports")],-1)),le={class:"flex gap-2 flex-wrap align-items-center"},se={class:"user-selection w-full md:w-14rem w-full"},re=h(()=>l("label",{class:"font-bold block mb-2"},"Project:",-1)),ne={class:"flex justify-content-center"},ie={class:"flex-auto"},de=h(()=>l("label",{for:"icondisplay",class:"font-bold block mb-2"},"From: ",-1)),ce={class:"flex-auto"},ue=h(()=>l("label",{for:"icondisplay",class:"font-bold block mb-2"},"To: ",-1)),pe={key:0,class:"card"},me={class:"flex align-items-center justify-content-between gap-2 mb-5"},fe=h(()=>l("h5",{class:"m-0"},"Preview",-1)),_e=h(()=>l("p",{class:"text-center"},"No Data found...",-1)),ve={__name:"index",setup(y){const{totalProjects:I}=L(Z()),j=X(),s=b(""),r=b(""),d=b(),x=b(null),g=b(!1),D=b(!1),k=q(),S=c=>{const a=c,o=new Date(a),n=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),m=String(o.getDate()).padStart(2,"0");return`${n}-${i}-${m}`},B=async()=>{var f,t;if(s.value&&!r.value||!s.value&&r.value)return g.value=!1,k.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const c=F("token");g.value=!0;const a=S(s.value),o=S(r.value);let n;d.value&&d.value.length>0&&(n=(f=d.value)==null?void 0:f.map(u=>u.id),console.log("Project ID",n)),s.value&&r.value&&(formData.append("start_date",a),formData.append("end_date",o));const{data:i,error:m}=await V(`${j.public.apiUrl}/projects/report-view?project_ids=${n||""}?start_date=${s.value?a:""}?end_date=${r.value?o:""}`,{method:"GET",headers:{Authorization:`Bearer ${c.value}`}},"$tkCbN62YMP");return((t=i.value)==null?void 0:t.code)==200?(x.value=i.value.data.map((u,w)=>({...u,index:w+1})),g.value=!1):(g.value=!1,k.add({severity:"error",summary:"Failed",detail:"Failed to generate!",group:"br",life:3e3}))},N=async()=>{var f;const c=F("token");if(D.value=!0,s.value&&!r.value||!s.value&&r.value)return g.value=!1,k.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const a=S(s.value),o=S(r.value),n=new FormData;if(d.value&&d.value.length>0){const t=(f=d.value)==null?void 0:f.map(u=>u.id);console.log("Project ID",t),t.length>0&&t.forEach(u=>{n.append("project_id[]",u)})}s.value&&r.value&&(n.append("start_due_date",a),n.append("end_due_date",o));const{data:i,error:m}=await V(`${j.public.apiUrl}/project-wise-task-report-download`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:n},"$tccjGN5izh");if(m.value)return console.log(m),D.value=!1;if(i.value.code==200){const t=document.createElement("a");return t.href=i.value.download_path,t.target="_blank",t.click(),D.value=!1}else return D.value=!1,k.add({severity:"error",summary:"Failed",detail:"Failed to download",group:"br",life:3e3})},P=(c,a)=>{const o=new Date(a);c=="startDate"?s.value=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate():r.value=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()};return(c,a)=>{const o=M,n=R,i=U,m=G,f=Y,t=z,u=A,w=O,E=W;return C(),T("div",ee,[e(o,{position:"bottom-right",group:"br"}),te,e(E,{onTabChange:c.onTabChange,class:"mt-3"},{default:v(()=>[e(w,{class:"file-upload",header:"Project Report"},{default:v(()=>[l("div",ae,[e(o,{position:"bottom-right",group:"br"}),oe,e(f,{class:"border-0 px-0"},{start:v(()=>[l("div",le,[l("div",se,[re,l("div",ne,[e(n,{display:"chip",modelValue:_(d),"onUpdate:modelValue":a[0]||(a[0]=p=>$(d)?d.value=p:null),options:_(I),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Project",class:"w-full"},null,8,["modelValue","options"])])]),l("div",ie,[de,e(i,{modelValue:_(s),"onUpdate:modelValue":a[1]||(a[1]=p=>$(s)?s.value=p:null),onDateSelect:a[2]||(a[2]=p=>P("startDate",p)),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])]),l("div",ce,[ue,e(i,{modelValue:_(r),"onUpdate:modelValue":a[3]||(a[3]=p=>$(r)?r.value=p:null),onDateSelect:a[4]||(a[4]=p=>P("endtDate",p)),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])])])]),end:v(()=>[e(m,{onClick:B,class:"w-full",label:"Generate",loading:_(g)},null,8,["loading"])]),_:1})]),_(x)?(C(),T("div",pe,[l("div",null,[l("div",me,[fe,e(m,{onClick:N,class:"w-fit",label:"Download",loading:_(D)},null,8,["loading"])]),e(u,{value:_(x),tableStyle:"min-width: 50rem"},{empty:v(()=>[_e]),default:v(()=>[e(t,{field:"index",header:"Serial",sortable:""}),e(t,{field:"task_name",style:{width:"40%"},header:"Task Name"}),e(t,{field:"project_name",header:"Project Name"}),e(t,{field:"task_status",header:"Status"}),e(t,{field:"task_due_date",header:"Due Date"}),e(t,{field:"task_date_done",header:"Date Done"}),e(t,{field:"duration",header:"Duration"}),e(t,{field:"unit",header:"Unit"}),e(t,{field:"overdue",header:"Missed Deadlines"})]),_:1},8,["value"])])])):J("",!0)]),_:1}),e(w,{header:"Specific Monthly Summary"}),e(w,{header:"Executive Summary"},{default:v(()=>[e(f,{class:"border-0 px-0"})]),_:1})]),_:1},8,["onTabChange"])])}}},st=H(ve,[["__scopeId","data-v-10953739"]]);export{st as default};
