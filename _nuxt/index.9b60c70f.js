import ue from"./toast.esm.ef8cdcd7.js";import J from"./button.esm.a55c2431.js";import ce from"./inputicon.esm.d7523654.js";import Q from"./inputtext.esm.5cd40da3.js";import me from"./iconfield.esm.1b32a169.js";import pe from"./toolbar.esm.473997f4.js";import ve from"./progressspinner.esm.2773c17b.js";import ae from"./checkbox.esm.1ad534d4.js";import ie from"./divider.esm.24843105.js";import{a3 as Z,$ as n,a4 as ee,ar as ne,o as p,b as y,i as l,l as d,u as e,a5 as R,F as A,f as D,t as O,q as K,a6 as te,ao as fe,al as _e,ap as he,aq as ge,w as x,e as G,P as ye,c as Y,bP as be}from"./entry.570ab878.js";import{u as re}from"./fetch.11b9759f.js";import{u as z,a as se}from"./cookie.3ed14f9e.js";import q from"./column.esm.6208f1b7.js";import xe from"./datatable.esm.3837e306.js";import{a as H}from"./usePermission.23a55d5e.js";import oe from"./dialog.esm.0b6d087d.js";import"./portal.esm.1e4af6e4.js";import"./basecomponent.esm.c7fbaad5.js";import"./index.esm.330f474a.js";import"./baseicon.esm.c7f0dea4.js";import"./index.esm.2547ec1e.js";import"./index.esm.c6f3b761.js";import"./index.esm.417f68ee.js";import"./badge.esm.54d3e6c5.js";import"./index.esm.b72e702d.js";import"./paginator.esm.23dce669.js";import"./index.esm.c592065e.js";import"./dropdown.esm.4fa36b0b.js";import"./index.esm.d468d720.js";import"./index.esm.2cce7489.js";import"./overlayeventbus.esm.c91907e9.js";import"./virtualscroller.esm.84c3372a.js";import"./inputnumber.esm.9d737ca0.js";import"./index.esm.bb3da758.js";import"./index.esm.e450f24c.js";import"./index.esm.f3846021.js";import"./index.esm.b806f7cb.js";import"./index.esm.feb1baca.js";import"./radiobutton.esm.b232767f.js";import"./index.esm.a8b59750.js";import"./index.esm.ecdc2543.js";const $e={class:"field"},we=l("label",{for:"company"},[K("Role Name"),l("i",{class:"text-red-400 text-italic"},"*")],-1),Ce=l("div",{class:"mb-3"},[l("label",null,[K("Permissions"),l("i",{class:"text-red-400 text-italic"},"*")])],-1),Pe={class:"groupPer-container mb-3"},ke={class:"flex align-items-start justify-content-between w-full mb-3"},Re={class:"flex justify-content-start",style:{width:"50%"}},Ve={class:"group-selection"},Se=["for"],Ie={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},Ee=["for"],Ne={class:"create-btn-wrapper mb-0"},Te={__name:"CreateRole",props:{param:{type:Object,required:!0}},emits:["closeCreateModal"],setup(V,{emit:U}){const L=te(),P=V,_=Z(),m=n(""),b=n(P.param.groupPermissions),u=n([]),i=n([]),v=n(!0),$=U,g=n(!1),M=c=>{const s=c.group.id,r=c.children.map(o=>o.id);i.value.includes(s)?u.value=[...new Set([...u.value,...r])]:u.value=u.value.filter(o=>!r.includes(o))},B=c=>{c.children.map(o=>o.id).every(o=>u.value.includes(o))?i.value.includes(c.group.id)||i.value.push(c.group.id):i.value=i.value.filter(o=>o!==c.group.id)},F=async()=>{var c;if(m.value===""){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(u.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(m.value===""&&u.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{g.value=!0;const s=z("token"),{data:r,pending:o}=await re(`${L.public.apiUrl}/roles/create`,{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{name:m.value,permissions:u.value}},"$lLTkTCcXoV");((c=r.value)==null?void 0:c.code)===201?(m.value=null,v.value=!1,g.value=!1,$("closeCreateModal",!1),_.add({severity:"success",summary:"Success",detail:"Role Created successfully!",group:"br",life:3e3})):(g.value=!1,_.add({severity:"error",summary:"Error",detail:"Role Creation Failed!",group:"br",life:3e3}))}};return ee(()=>{const c=document.getElementById("createRoleName");ne(()=>{c&&c.focus()})}),(c,s)=>{const r=Q,o=ae,w=ie,j=J;return p(),y("div",null,[l("div",$e,[we,d(r,{id:"createRoleName",modelValue:e(m),"onUpdate:modelValue":s[0]||(s[0]=h=>R(m)?m.value=h:null),class:"w-full",placeholder:"Enter role name"},null,8,["modelValue"])]),Ce,l("div",Pe,[(p(!0),y(A,null,D(e(b),h=>(p(),y("div",{key:h.group.id},[l("div",ke,[l("div",Re,[l("div",Ve,[d(o,{modelValue:e(i),"onUpdate:modelValue":s[1]||(s[1]=a=>R(i)?i.value=a:null),inputId:"group-"+h.group.id,value:h.group.id,onChange:a=>M(h)},null,8,["modelValue","inputId","value","onChange"]),l("label",{class:"grp-title ml-2",for:"group-"+h.group.id},O(h.group.name),9,Se)])]),l("div",Ie,[(p(!0),y(A,null,D(h.children,a=>(p(),y("div",{key:a.id,class:"flex align-items-center"},[d(o,{modelValue:e(u),"onUpdate:modelValue":s[2]||(s[2]=t=>R(u)?u.value=t:null),inputId:a.id,value:a.id,onChange:t=>B(h)},null,8,["modelValue","inputId","value","onChange"]),l("label",{for:a.id,class:"ml-2"},O(a.name),9,Ee)]))),128))])]),d(w)]))),128))]),l("div",Ne,[d(j,{label:"Save",icon:"pi pi-check",text:"",loading:e(g),onClick:F},null,8,["loading"])])])}}};const de=V=>(he("data-v-e7fed618"),V=V(),ge(),V),Ue={class:"field"},Me=de(()=>l("label",{for:"company"},[K("Role Name"),l("i",{class:"text-red-400 text-italic"},"*")],-1)),Be=de(()=>l("div",{class:"mb-3"},[l("label",null,[K("Permissions"),l("i",{class:"text-red-400 text-italic"},"*")])],-1)),Le={class:"groupPer-container mb-3"},Fe={class:"flex align-items-start justify-content-between w-full mb-3"},je={class:"flex justify-content-start",style:{width:"50%"}},Ae={class:"group-selection"},De={class:"grp-title ml-2"},Oe={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},We=["for"],Ge={class:"create-btn-wrappe"},qe={__name:"EditRole",props:{param:{type:Object,required:!0}},emits:["closeEditModal"],setup(V,{emit:U}){const L=te(),P=V,_=Z(),m=n(P.param.id),b=n(P.param.name);n(P.param.permissionsList);const u=n(P.param.groupPermissions),i=n(P.param.slctdPermissions||[]),v=n([]),$=n(!0),g=n(!1),M=U,B=()=>{u.value.forEach(s=>{s.children.every(o=>i.value.includes(o.id))&&v.value.push(s.group.id)})},F=s=>{const r=s.children.map(o=>o.id);v.value.includes(s.group.id)?i.value=[...new Set([...i.value,...r])]:i.value=i.value.filter(o=>!r.includes(o))};_e(i,()=>{u.value.forEach(s=>{const r=s.children.every(o=>i.value.includes(o.id));r&&!v.value.includes(s.group.id)?v.value.push(s.group.id):!r&&v.value.includes(s.group.id)&&(v.value=v.value.filter(o=>o!==s.group.id))})});const c=async()=>{var s;if(b.value===""){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(i.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(b.value===""&&i.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{g.value=!0;const r=z("token"),{data:o,pending:w}=await re(`${L.public.apiUrl}/roles/update/${m.value}`,{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:{name:b.value,permissions:i.value}},"$AftFLbfnYe");((s=o.value)==null?void 0:s.code)===200?($.value=!1,g.value=!1,M("closeEditModal",!1),_.add({severity:"success",summary:"Success",detail:"Role updated successfully!",group:"br",life:3e3})):(g.value=!1,_.add({severity:"error",summary:"Error",detail:"Failed to update role!",group:"br",life:3e3}))}};return ee(async()=>{B();const s=document.getElementById("editTeamName");ne(()=>{s&&s.focus()})}),(s,r)=>{const o=Q,w=ae,j=ie,h=J;return p(),y("div",null,[l("div",Ue,[Me,d(o,{id:"editTeamName",disabled:e(b)==="Admin",modelValue:e(b),"onUpdate:modelValue":r[0]||(r[0]=a=>R(b)?b.value=a:null),class:"w-full",placeholder:"Edit role name"},null,8,["disabled","modelValue"])]),Be,l("div",Le,[(p(!0),y(A,null,D(e(u),a=>(p(),y("div",{key:a.group.id},[l("div",Fe,[l("div",je,[l("div",Ae,[d(w,{modelValue:e(v),"onUpdate:modelValue":r[1]||(r[1]=t=>R(v)?v.value=t:null),value:a.group.id,onChange:t=>F(a)},null,8,["modelValue","value","onChange"]),l("label",De,O(a.group.name),1)])]),l("div",Oe,[(p(!0),y(A,null,D(a.children,t=>(p(),y("div",{key:t.id,class:"flex align-items-center"},[d(w,{modelValue:e(i),"onUpdate:modelValue":r[2]||(r[2]=S=>R(i)?i.value=S:null),inputId:t.id,value:t.id},null,8,["modelValue","inputId","value"]),l("label",{for:t.id,class:"ml-2"},O(t.name),9,We)]))),128))])]),d(j)]))),128))]),l("div",Ge,[d(h,{label:"Update",icon:"pi pi-check",loading:e(g),text:"",onClick:c},null,8,["loading"])])])}}},ze=fe(qe,[["__scopeId","data-v-e7fed618"]]);const Ke={key:0,class:"card"},Xe=l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"User Role")],-1),Ye=l("i",{class:"pi pi-search"},null,-1),He=l("p",{class:"text-center"},"No Data found...",-1),Je={style:{display:"flex","flex-wrap":"wrap",gap:"5px"}},jt={__name:"index",setup(V){const U=te(),L=n(H("read_role")),P=n(H("create_role")),_=n(H("update_role")),m=n(),b=n(!0);Z();const u=n(!1),i=n(!1),v=n([]),$=n([]),g=n([]),M=n(""),B=n(""),F=a=>{u.value=!1,o()},c=a=>{i.value=!1,o()},s=()=>{u.value=!0,o()},r=a=>{var S;i.value=!0,M.value=a.id,B.value=a.name,$.value=$.value;let t=[];((S=a==null?void 0:a.permissions)==null?void 0:S.length)>0&&a.permissions.map(k=>{$.value.map(C=>{k.id===C.id&&t.push({id:C.id})})}),g.value=t.map(k=>k.id),console.log("sPp",be(g.value))},o=async()=>{var C,I,E;const a=z("token"),{data:t,pending:S,error:k}=await se("roleList",()=>$fetch(`${U.public.apiUrl}/roles/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((I=(C=t.value)==null?void 0:C.data)==null?void 0:I.length)>0&&(v.value=(E=t.value)==null?void 0:E.data.map((N,T)=>({...N,index:T+1})))},w=n([]),j=async()=>{var C,I,E;const a=z("token"),{data:t,pending:S,error:k}=await se("permissionList",()=>$fetch(`${U.public.apiUrl}/permissions/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((I=(C=t.value)==null?void 0:C.data)==null?void 0:I.length)>0&&($.value=(E=t.value)==null?void 0:E.data.map((N,T)=>({...N,index:T+1})),w.value=Object.entries(t.value.group).map(([N,T],X)=>({group:{name:N,id:X+1},children:T.map(W=>({id:W.id,name:W.name}))})),console.log(w.value))},h=()=>{m.value={global:{value:null,matchMode:ye.CONTAINS}}};return ee(()=>{o(),j(),b.value=!1}),h(),(a,t)=>{const S=ue,k=J,C=ce,I=Q,E=me,N=pe,T=ve,X=Te,W=ze;return e(L)?(p(),y("div",Ke,[d(S,{position:"bottom-right",group:"br"}),Xe,d(N,{class:"border-0 px-0"},{start:x(()=>[e(P)?(p(),Y(k,{key:0,icon:"pi pi-plus",label:"Create",onClick:s,class:"mr-2",severity:"secondary"})):G("",!0)]),end:x(()=>[d(E,{iconPosition:"right",raised:""},{default:x(()=>[d(C,null,{default:x(()=>[Ye]),_:1}),d(I,{modelValue:e(m).global.value,"onUpdate:modelValue":t[0]||(t[0]=f=>e(m).global.value=f),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})]),_:1}),d(e(xe),{filters:e(m),"onUpdate:filters":t[1]||(t[1]=f=>R(m)?m.value=f:null),class:"table-stR",value:e(v),stripedRows:"",paginator:"",tableStyle:"min-width: 50rem",rows:15,rowsPerPageOptions:[10,15,20,50],dataKey:"id",filterDisplay:"menu",loading:e(b)},{empty:x(()=>[He]),loading:x(()=>[d(T,{style:{width:"50px",height:"50px"}})]),default:x(()=>[d(e(q),{field:"index",header:"Serial",sortable:""}),d(e(q),{style:{"text-wrap":"nowrap"},field:"name",header:"Role Name"}),d(e(q),{field:"permissions",header:"Permission"},{body:x(f=>[l("div",Je,[(p(!0),y(A,null,D(f.data.permissions,le=>(p(),y("div",{class:"border rounded",key:a.permission,style:{border:"1px solid rgba(167, 167, 167, 0.486)","border-radius":"5px",padding:"2px 5px"}},[l("p",null,O(le.name),1)]))),128))])]),_:1}),d(e(q),{field:"action",header:"Action"},{body:x(f=>[e(_)?(p(),Y(k,{key:0,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",onClick:le=>r(f.data)},null,8,["onClick"])):G("",!0),e(_)?G("",!0):(p(),Y(k,{key:1,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",style:{visibility:"hidden"}}))]),_:1})]),_:1},8,["filters","value","loading"]),d(e(oe),{visible:e(u),"onUpdate:visible":t[3]||(t[3]=f=>R(u)?u.value=f:null),modal:"",header:"Create Role",dismissableMask:"true",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[d(X,{param:{permissionsList:e($),groupPermissions:e(w)},onCloseCreateModal:t[2]||(t[2]=f=>F(f))},null,8,["param"])]),_:1},8,["visible"]),d(e(oe),{visible:e(i),"onUpdate:visible":t[5]||(t[5]=f=>R(i)?i.value=f:null),modal:"",header:"Edit Role",dismissableMask:"true",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[d(W,{param:{id:e(M),name:e(B),permissionsList:e($),groupPermissions:e(w),slctdPermissions:e(g)},onCloseEditModal:t[4]||(t[4]=f=>c(f))},null,8,["param"])]),_:1},8,["visible"])])):G("",!0)}}};export{jt as default};
