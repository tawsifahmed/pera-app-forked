import{u as p,a as C}from"./cookie.9dea65c9.js";import{u as f}from"./fetch.10fa1737.js";import{ao as M}from"./entry.f1083d62.js";import{u as F}from"./workCompany.9fc24a14.js";const T=F(),R=M("workStation",{state:()=>({loading:!1,createCompany:null,isCompanyCreated:!1,isCompanyDeleted:!1,isCompanyEdited:!1,compList:null,companyId:null,singleCompany:null,singleCompanySpaces:null,singleCompanyName:null,isCompanySwitched:!1,companySwitchToast:null,spaceList:null,isSpaceCreated:!1,isSpaceDeleted:!1,isSpaceEdited:!1,singleSpace:null,singleSpaceProjects:null,spaceSidebarlist:[],projectList:null,isProjectCreated:!1,isProjectEdited:!1,isProjectDeleted:!1,singleProject:null,taskList:null,isTaskCreated:!1,detectDuplicateTask:!1,isTaskDeleted:!1,isTaskEdited:!1,tasks:[],kanbanTasks:[],calendarTasks:[],ganttChartData:[],recentTaskData:[],tasksAttachments:[],totalTaskCount:[],countTasksByStatus:[],taskStatusCounts:[],asngUsers:[],subTasks:[],taskDetails:[],taskActivity:[],taskStatus:[],users:[],tags:[],priorityList:[],singleTaskComments:null,isTaskCommentCreated:!1,statuslist:[],modStatusList:[],chartProjectInfo:null,totalDashboardProjects:null,completedTasksChartData:null,inProgressTasksChartData:null,unAssignedTasksChartData:null,inProgressCnt:null,chartClosedTaskInfo:null,rolesLists:null}),actions:{async getCompanyList(){var n,s,o;const e=p("token"),{data:t,pending:a,error:r}=await C("compList",()=>$fetch("https://pbe.singularitybd.net/api/v1/company/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.compList=(n=t.value)==null?void 0:n.data.map((i,c)=>({...i,index:c+1})),this.singleCompanyName=(o=(s=t.value)==null?void 0:s.data[0])==null?void 0:o.name},async getSingleCompany(e){var s,o;const t=p("token"),{data:a,pending:r,error:n}=await C("singleCompany",()=>$fetch(`https://pbe.singularitybd.net/api/v1/company/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleCompany=(s=a.value)==null?void 0:s.data,this.singleCompanySpaces=(o=this.singleCompany)==null?void 0:o.spaces.map((i,c)=>({...i,index:c+1}))},async createCompany({name:e,email:t,address:a,contact_number:r,number_of_employees:n,company_type:s,logo:o}){var v,m,D,$,w,b;const i=p("token"),c=new FormData;c.append("name",e),c.append("email",t),c.append("address",a),c.append("contact_number",r),c.append("number_of_employees",n),c.append("company_type",s),o!=null&&c.append("image",o);const{data:l,pending:k}=await f("https://pbe.singularitybd.net/api/v1/company/create",{method:"POST",headers:{Authorization:`Bearer ${i.value}`},body:c},"$FPXU5moxCx");if(((v=l.value)==null?void 0:v.app_message)==="success"){localStorage.setItem("userCompany",JSON.stringify((D=(m=l.value)==null?void 0:m.data)==null?void 0:D.id)),this.isCompanyCreated=!0,this.companyId=(w=($=l.value)==null?void 0:$.data)==null?void 0:w.id;const P=p("rolePermission");P.value=(b=l==null?void 0:l.value)==null?void 0:b.permissions,await this.getCompanyList(),await T.getCompany()}},async editCompany({id:e,name:t,email:a,address:r,contact_number:n,number_of_employees:s,company_type:o,logo:i}){var m;const c=p("token"),l=new FormData;l.append("name",t),l.append("email",a),l.append("address",r),l.append("contact_number",n),l.append("number_of_employees",s),l.append("company_type",o),i!=null?l.append("image",i):l.append("image",null);const{data:k,pending:v}=await f(`https://pbe.singularitybd.net/api/v1/company/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:l},"$LkMGR8lsUV");((m=k.value)==null?void 0:m.app_message)==="success"&&(this.isCompanyEdited=!0,this.getCompanyList(),await T.getCompany())},async switchCompany(e){var n,s,o;const t=p("token"),{data:a,pending:r}=await f("https://pbe.singularitybd.net/api/v1/switch-company",{method:"POST",headers:{Authorization:`Bearer ${t.value}`},body:{company_id:e}},"$y3MaeJU29x");if(((n=a.value)==null?void 0:n.code)===200){const i=p("userType");i.value=(s=a==null?void 0:a.value)==null?void 0:s.user_type;const c=p("rolePermission");c.value=(o=a==null?void 0:a.value)==null?void 0:o.permissions,this.isCompanySwitched=!0,this.companySwitchToast=a.value.message,location.reload()}else this.isCompanySwitched=!1,this.companySwitchToast="Unable to switch company"},async deleteCompany(e){var n;const t=p("token"),{data:a,pending:r}=await f(`https://pbe.singularitybd.net/api/v1/company/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.value}`},body:{id:e}},"$m5SlSHdl7U");((n=a.value)==null?void 0:n.app_message)==="success"&&(this.isCompanyDeleted=!0,await T.getCompany(),this.getCompanyList())},async getSpaceList(){var a,r;let e=null;e=JSON.parse(localStorage.getItem("userCompany"));const t=p("token");if(e){const{data:n,pending:s,error:o}=await C("spaceList",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/list/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.spaceList=(a=n.value)==null?void 0:a.data,((r=this.spaceList)==null?void 0:r.length)>0&&(this.spaceSidebarlist=[],this.spaceList.forEach(i=>{let c={label:i==null?void 0:i.name,icon:"pi pi-globe",to:`/companies/${i==null?void 0:i.company_id}/spaces/${i==null?void 0:i.id}`};this.spaceSidebarlist.push(c)}))}},async getSingleSpace(e){var s,o;const t=p("token"),{data:a,pending:r,error:n}=await C("singleSpace",()=>$fetch(`https://pbe.singularitybd.net/api/v1/space/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.singleSpace=(s=a.value)==null?void 0:s.data,this.singleSpaceProjects=(o=this.singleSpace)==null?void 0:o.projects.map((i,c)=>({...i,index:c+1}))},async createSpace({name:e,description:t,company_id:a,color:r,users:n}){var c;const s=p("token"),{data:o,pending:i}=await f("https://pbe.singularitybd.net/api/v1/space/create",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{name:e,description:t,company_id:a,color:r,users:n}},"$RESrNdzmLo");((c=o.value)==null?void 0:c.app_message)==="success"&&(this.isSpaceCreated=!0)},async editSpace({id:e,name:t,description:a,company_id:r,color:n,users:s}){var l;const o=p("token"),{data:i,pending:c}=await f(`https://pbe.singularitybd.net/api/v1/space/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${o.value}`},body:{id:e,name:t,description:a,company_id:r,color:n,users:s}},"$11QSDyM4E2");((l=i.value)==null?void 0:l.app_message)==="success"&&(this.isSpaceEdited=!0,await T.getCompany(),this.getSingleCompany(r))},async deleteSpace(e,t){var s;const a=p("token"),{data:r,pending:n}=await f(`https://pbe.singularitybd.net/api/v1/space/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$lPsqIgvGMV");((s=r.value)==null?void 0:s.app_message)==="success"&&(this.isSpaceDeleted=!0,await T.getCompany(),this.getSingleCompany(t))},async getProjectList(){var n;const e=p("token"),{data:t,pending:a,error:r}=await C("projectList",()=>$fetch("https://pbe.singularitybd.net/api/v1/space/list",{headers:{Authorization:`Bearer ${e.value}`}}));this.spaceList=(n=t.value)==null?void 0:n.data},async getSingleProject(e,t="",a="",r="",n="",s="",o=""){var j,_,E;const i=p("token");t&&(t=t.join(","));const{data:c,pending:l,error:k}=await C("singleProject",()=>$fetch(`
          https://pbe.singularitybd.net/api/v1/projects/show/${e}?assignees=${t}&priority=${a}&status=${r}&search=${n}&start=${s}&end=${o}`,{headers:{Authorization:`Bearer ${i.value}`}}));this.singleProject=(j=c.value)==null?void 0:j.data,this.tasks=(_=c.value)==null?void 0:_.tasks,this.statuslist=(E=c.value)==null?void 0:E.taskStatus;const v=this.statuslist.map(d=>{const h=this.tasks.filter(g=>g.data.status.name===d.name);return{name:d.name,statusColor:d.color_code,status:d,content:h}});this.kanbanTasks=v;const m=this.tasks.map(d=>{var g,u;const h=S=>{const y=new Date(S),A=y.getFullYear(),L=String(y.getMonth()+1).padStart(2,"0"),B=String(y.getDate()).padStart(2,"0"),I=String(y.getHours()).padStart(2,"0"),O=String(y.getMinutes()).padStart(2,"0");return`${A}-${L}-${B} ${I}:${O}`};return{key:d.key,title:d.data.name,start:h(d.data.created_at),end:d.data.dueDate?h(d.data.dueDate):h(d.data.created_at),color:(u=(g=d.data)==null?void 0:g.status)==null?void 0:u.color_code}});this.calendarTasks=m,this.modStatusList=[{name:"All",code:""},...this.statuslist];function D(d){let h=[];function g(u){const{name:S,created_at:y,dueDate:A,status:L}=u.data;y&&A&&h.push({x:S,y:[new Date(y).getTime(),new Date(A).getTime()],fillColor:L.color_code}),u.children&&u.children.length>0&&u.children.forEach(B=>g(B))}return d.forEach(u=>g(u)),[{data:h}]}function $(d){let h=[];const g=new Date().getTime(),u=g-3*24*60*60*1e3;function S(y){const{name:A,created_at:L,dueDate:B,status:I}=y.data,{key:O}=y,N=new Date(L).getTime();N>=u&&N<=g&&h.push({key:O,taskName:A,dueDate:B,statusName:I.name,statusColor:I.color_code}),y.children&&y.children.length>0&&y.children.forEach(x=>S(x))}return d.forEach(y=>S(y)),h}function w(d){let h=0;function g(u){h++,u.children&&u.children.length>0&&u.children.forEach(S=>g(S))}return d.forEach(u=>g(u)),{totalTaskCount:h}}const b=this.statuslist.map(d=>({statusName:d.name,statusColor:d.color_code,taskCount:0}));function P(d){const h=d.data.status,g=b.findIndex(u=>u.statusName===h.name);g!==-1&&(b[g].taskCount+=1),d.children&&d.children.length>0&&d.children.forEach(u=>P(u))}this.tasks.forEach(d=>P(d)),this.countTasksByStatus=b;let z=w(this.tasks);this.recentTaskData=$(this.tasks),this.totalTaskCount=z.totalTaskCount,this.ganttChartData=D(this.tasks)},async createProject({name:e,description:t,space_id:a,statuses:r}){var i;const n=p("token"),{data:s,pending:o}=await f("https://pbe.singularitybd.net/api/v1/projects/create",{method:"POST",headers:{Authorization:`Bearer ${n.value}`},body:{name:e,description:t,space_id:a,statuses:r}},"$dFqFkzlBiI");((i=s.value)==null?void 0:i.app_message)==="success"&&(this.isProjectCreated=!0,await T.getCompany(),this.getSingleSpace(a),this.getChartData())},async editProject({id:e,name:t,description:a,space_id:r,statuses:n,git_project_id:s}){var l;const o=p("token"),{data:i,pending:c}=await f(`https://pbe.singularitybd.net/api/v1/projects/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${o.value}`},body:{id:e,name:t,description:a,space_id:r,statuses:n,git_project_id:s}},"$74BArWPOdE");((l=i.value)==null?void 0:l.app_message)==="success"&&(this.isProjectEdited=!0,await T.getCompany(),this.getSingleSpace(r))},async deleteProject(e,t){var s;const a=p("token"),{data:r,pending:n}=await f(`https://pbe.singularitybd.net/api/v1/projects/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$BnkY4zQQhW");((s=r.value)==null?void 0:s.app_message)==="success"&&(this.isProjectDeleted=!0,await T.getCompany(),this.getSingleSpace(t))},async getTaskDetails(e){var o,i,c,l,k;const t=p("token"),{data:a,pending:r,error:n}=await C("taskDetails",()=>$fetch(`https://pbe.singularitybd.net/api/v1/tasks/show/${e}`,{headers:{Authorization:`Bearer ${t.value}`}}));this.taskDetails=(o=a.value)==null?void 0:o.data,this.taskActivity=(i=a.value)==null?void 0:i.taskActivity,this.singleTaskComments=(c=a.value)==null?void 0:c.data.comments,this.subTasks=(l=a.value)==null?void 0:l.subTasks,this.taskStatus=[];let s=(k=a.value)==null?void 0:k.taskStatus;s&&s.length>0&&s.forEach(v=>{let m={name:v.name,code:v.id};this.taskStatus.push(m)})},async createTask({name:e,description:t,project_id:a,parent_task_id:r,dueDate:n,priority:s,assignees:o,tags:i}){const c=p("token"),{data:l,error:k,pending:v}=await f("https://pbe.singularitybd.net/api/v1/tasks/create",{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:{name:e,project_id:a,parent_task_id:r,due_date:n,priority:s,assignees:o,tags:i,description:t}},"$yabYYCCfIV");if(k.value&&k.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskCreated=!1),l.value&&l.value.code===201){this.isTaskCreated=!0,this.detectDuplicateTask=!1,this.getSingleProject(a);let m=Number(localStorage.getItem("taskDetailID"));m&&this.getTaskDetails(m)}},async editTask({id:e,name:t,description:a,project_id:r,dueDate:n,priority:s,assignees:o,tags:i}){const c=p("token"),{data:l,error:k,pending:v}=await f(`https://pbe.singularitybd.net/api/v1/tasks/update/${e}`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:{id:e,name:t,description:a,due_date:n,priority:s,assignees:o,tags:i,project_id:r}},"$vVLnpjK6QE");if(k.value&&k.value.data.code===400&&(this.detectDuplicateTask=!0,this.isTaskEdited=!1),l.value&&l.value.code===200){this.isTaskEdited=!0,this.detectDuplicateTask=!1,this.getSingleProject(r);let m=Number(localStorage.getItem("taskDetailID"));m&&this.getTaskDetails(m)}},async deleteTask(e,t){var s;const a=p("token"),{data:r,pending:n}=await f(`https://pbe.singularitybd.net/api/v1/tasks/delete/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.value}`},body:{id:e}},"$4BH7YSjOJ4");if(((s=r.value)==null?void 0:s.app_message)==="success"){this.isTaskDeleted=!0,this.getSingleProject(t);let o=Number(localStorage.getItem("taskDetailID"));o&&this.getTaskDetails(o)}},async getTaskAssignModalData(){var n,s,o;const e=p("token"),{data:t,pending:a,error:r}=await C("taskAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/users/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(n=t.value)==null?void 0:n.data)==null?void 0:s.length)>0&&(this.users=[],(o=t.value)==null||o.data.forEach(i=>{let c={id:i.id,name:i.name};this.users.push(c)}))},async getTagsAssignModalData(){var n,s,o;const e=p("token"),{data:t,pending:a,error:r}=await C("tagsAssignModalData",()=>$fetch("https://pbe.singularitybd.net/api/v1/tag/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(n=t.value)==null?void 0:n.data)==null?void 0:s.length)>0&&(this.tags=[],(o=t.value)==null||o.data.forEach(i=>{let c={id:i.id,name:i.name};this.tags.push(c)}))},async addTaskComment(e,t,a){var i;const r=new FormData;r.append("comment",t),r.append("commentable_id",e),r.append("file",a);const n=p("token"),{data:s,pending:o}=await f("https://pbe.singularitybd.net/api/v1/comments/create",{method:"POST",headers:{Authorization:`Bearer ${n.value}`},body:r},"$Sdwr0JJQY2");((i=s.value)==null?void 0:i.app_message)==="success"&&(this.isTaskCommentCreated=!0,this.getTaskDetails(e))},async getChartData(){var n,s,o,i,c,l,k,v,m,D,$,w,b,P,z,j,_,E,d,h,g;const e=p("token"),{data:t,pending:a,error:r}=await C("chartData",()=>$fetch("https://pbe.singularitybd.net/api/v1/dashboard/task-status",{headers:{Authorization:`Bearer ${e.value}`}}));((n=t==null?void 0:t.value)==null?void 0:n.code)===200?(this.chartProjectInfo=(o=(s=t==null?void 0:t.value)==null?void 0:s.data)==null?void 0:o.projectCounts.map(u=>{let S=u.project_name;return S.length>7&&(S=S.substring(0,7)+"..."),S}),this.inProgressCnt=(c=(i=t==null?void 0:t.value)==null?void 0:i.data)==null?void 0:c.projectCounts.map(u=>u.inProgressCounts),this.chartClosedTaskInfo=(k=(l=t==null?void 0:t.value)==null?void 0:l.data)==null?void 0:k.projectCounts.map(u=>u.completedCounts),this.totalDashboardProjects=(m=(v=t==null?void 0:t.value)==null?void 0:v.data)==null?void 0:m.projectCounts.length,this.completedTasksChartData=($=(D=t==null?void 0:t.value)==null?void 0:D.data)==null?void 0:$.completed,localStorage.setItem("completedTasksChartData",JSON.stringify((b=(w=t==null?void 0:t.value)==null?void 0:w.data)==null?void 0:b.completed)),this.inProgressTasksChartData=(z=(P=t==null?void 0:t.value)==null?void 0:P.data)==null?void 0:z.inProgress,localStorage.setItem("inProgressTasksChartData",JSON.stringify((_=(j=t==null?void 0:t.value)==null?void 0:j.data)==null?void 0:_.inProgress)),this.unAssignedTasksChartData=(d=(E=t==null?void 0:t.value)==null?void 0:E.data)==null?void 0:d.unAssigneeCount,localStorage.setItem("unAssignedTasksChartData",JSON.stringify((g=(h=t==null?void 0:t.value)==null?void 0:h.data)==null?void 0:g.unAssigneeCount))):(this.chartProjectInfo=[],this.inProgressCnt=[])},async getRoles(){var n,s,o;const e=p("token"),{data:t,pending:a,error:r}=await C("roleLit",()=>$fetch("https://pbe.singularitybd.net/api/v1/roles/list",{headers:{Authorization:`Bearer ${e.value}`}}));((s=(n=t.value)==null?void 0:n.data)==null?void 0:s.length)>0?this.rolesLists=(o=t.value)==null?void 0:o.data:this.rolesLists=[]},formatDate(e){const t=new Date(e);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}/${t.getFullYear()}`}}});export{R as u};
