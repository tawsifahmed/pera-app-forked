import ue from"./toast.esm.d902c718.js";import J from"./button.esm.06795703.js";import ce from"./inputicon.esm.3f25cd45.js";import Q from"./inputtext.esm.7d8fbb7d.js";import me from"./iconfield.esm.6514eb03.js";import pe from"./toolbar.esm.52d293d1.js";import ve from"./progressspinner.esm.dac4ce64.js";import ae from"./checkbox.esm.84c794b4.js";import ie from"./divider.esm.89ec8fab.js";import{a6 as Z,$ as n,a7 as ee,a8 as ne,o as p,b as y,i as l,l as d,u as e,a9 as R,F as j,f as D,t as O,q as K,ca as te,a2 as fe,ar as _e,a3 as he,a4 as be,w as x,e as G,P as ge,c as Y,bO as ye}from"./entry.b31b648d.js";import{u as re}from"./fetch.56444aa5.js";import{u as q,a as se}from"./cookie.2bc80624.js";import z from"./column.esm.60393863.js";import xe from"./datatable.esm.851a04ac.js";import{a as H}from"./usePermission.9cde9ba2.js";import oe from"./dialog.esm.e1b85788.js";import"./portal.esm.ceeefb70.js";import"./basecomponent.esm.6d5a3703.js";import"./index.esm.19f38c84.js";import"./baseicon.esm.2abcf816.js";import"./index.esm.919e0985.js";import"./index.esm.df24a5dc.js";import"./index.esm.5f32c08d.js";import"./badge.esm.81211e44.js";import"./index.esm.273d0379.js";import"./paginator.esm.e419c7c9.js";import"./index.esm.13945bc0.js";import"./dropdown.esm.00589248.js";import"./index.esm.817067de.js";import"./index.esm.612a4e62.js";import"./overlayeventbus.esm.ae3a1b75.js";import"./virtualscroller.esm.5e4c9976.js";import"./inputnumber.esm.fc40c696.js";import"./index.esm.73b2237d.js";import"./index.esm.a55a9385.js";import"./index.esm.c8fc8bd4.js";import"./index.esm.c7141748.js";import"./index.esm.39a4ff55.js";import"./radiobutton.esm.e8bad4a5.js";import"./index.esm.b100a647.js";import"./index.esm.6d3ae283.js";const $e={class:"field"},we=l("label",{for:"company"},[K("Role Name"),l("i",{class:"text-red-400 text-italic"},"*")],-1),Ce=l("div",{class:"mb-3"},[l("label",null,[K("Permissions"),l("i",{class:"text-red-400 text-italic"},"*")])],-1),ke={class:"groupPer-container mb-3"},Pe={class:"flex align-items-start justify-content-between w-full mb-3"},Re={class:"flex justify-content-start",style:{width:"50%"}},Ve={class:"group-selection"},Se=["for"],Ie={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},Ee=["for"],Ne={class:"create-btn-wrapper mb-0"},Te={__name:"CreateRole",props:{param:{type:Object,required:!0}},emits:["closeCreateModal"],setup(V,{emit:U}){const L=te(),k=V,_=Z(),m=n(""),b=n(k.param.groupPermissions),u=n([]),i=n([]),v=n(!0),$=U,g=n(!1),M=c=>{const s=c.group.id,r=c.children.map(o=>o.id);i.value.includes(s)?u.value=[...new Set([...u.value,...r])]:u.value=u.value.filter(o=>!r.includes(o))},B=c=>{c.children.map(o=>o.id).every(o=>u.value.includes(o))?i.value.includes(c.group.id)||i.value.push(c.group.id):i.value=i.value.filter(o=>o!==c.group.id)},F=async()=>{var c;if(m.value===""){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(u.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(m.value===""&&u.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{g.value=!0;const s=q("token"),{data:r,pending:o}=await re(`${L.public.apiUrl}/roles/create`,{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{name:m.value,permissions:u.value}},"$lLTkTCcXoV");((c=r.value)==null?void 0:c.code)===201?(m.value=null,v.value=!1,g.value=!1,$("closeCreateModal",!1),_.add({severity:"success",summary:"Success",detail:"Role Created successfully!",group:"br",life:3e3})):(g.value=!1,_.add({severity:"error",summary:"Error",detail:"Role Creation Failed!",group:"br",life:3e3}))}};return ee(()=>{const c=document.getElementById("createRoleName");ne(()=>{c&&c.focus()})}),(c,s)=>{const r=Q,o=ae,w=ie,A=J;return p(),y("div",null,[l("div",$e,[we,d(r,{id:"createRoleName",modelValue:e(m),"onUpdate:modelValue":s[0]||(s[0]=h=>R(m)?m.value=h:null),class:"w-full",placeholder:"Enter role name"},null,8,["modelValue"])]),Ce,l("div",ke,[(p(!0),y(j,null,D(e(b),h=>(p(),y("div",{key:h.group.id},[l("div",Pe,[l("div",Re,[l("div",Ve,[d(o,{modelValue:e(i),"onUpdate:modelValue":s[1]||(s[1]=a=>R(i)?i.value=a:null),inputId:"group-"+h.group.id,value:h.group.id,onChange:a=>M(h)},null,8,["modelValue","inputId","value","onChange"]),l("label",{class:"grp-title ml-2",for:"group-"+h.group.id},O(h.group.name),9,Se)])]),l("div",Ie,[(p(!0),y(j,null,D(h.children,a=>(p(),y("div",{key:a.id,class:"flex align-items-center"},[d(o,{modelValue:e(u),"onUpdate:modelValue":s[2]||(s[2]=t=>R(u)?u.value=t:null),inputId:a.id,value:a.id,onChange:t=>B(h)},null,8,["modelValue","inputId","value","onChange"]),l("label",{for:a.id,class:"ml-2"},O(a.name),9,Ee)]))),128))])]),d(w)]))),128))]),l("div",Ne,[d(A,{label:"Save",icon:"pi pi-check",text:"",loading:e(g),onClick:F},null,8,["loading"])])])}}};const de=V=>(he("data-v-047b5113"),V=V(),be(),V),Ue={class:"field"},Me=de(()=>l("label",{for:"company"},[K("Role Name"),l("i",{class:"text-red-400 text-italic"},"*")],-1)),Be=de(()=>l("div",{class:"mb-3"},[l("label",null,[K("Permissions"),l("i",{class:"text-red-400 text-italic"},"*")])],-1)),Le={class:"groupPer-container mb-3"},Fe={class:"flex align-items-start justify-content-between w-full mb-3"},Ae={class:"flex justify-content-start",style:{width:"50%"}},je={class:"group-selection"},De={class:"grp-title ml-2"},Oe={class:"flex flex-column gap-3 justify-content-start",style:{width:"50%"}},We=["for"],Ge={class:"create-btn-wrappe"},ze={__name:"EditRole",props:{param:{type:Object,required:!0}},emits:["closeEditModal"],setup(V,{emit:U}){const L=te(),k=V,_=Z(),m=n(k.param.id),b=n(k.param.name);n(k.param.permissionsList);const u=n(k.param.groupPermissions),i=n(k.param.slctdPermissions||[]),v=n([]),$=n(!0),g=n(!1),M=U,B=()=>{u.value.forEach(s=>{s.children.every(o=>i.value.includes(o.id))&&v.value.push(s.group.id)})},F=s=>{const r=s.children.map(o=>o.id);v.value.includes(s.group.id)?i.value=[...new Set([...i.value,...r])]:i.value=i.value.filter(o=>!r.includes(o))};_e(i,()=>{u.value.forEach(s=>{const r=s.children.every(o=>i.value.includes(o.id));r&&!v.value.includes(s.group.id)?v.value.push(s.group.id):!r&&v.value.includes(s.group.id)&&(v.value=v.value.filter(o=>o!==s.group.id))})});const c=async()=>{var s;if(b.value===""){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name",group:"br",life:3e3});return}else if(i.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please select roles",group:"br",life:3e3});return}else if(b.value===""&&i.value.length===0){_.add({severity:"warn",summary:"Warning",detail:"Please enter role name and select role",group:"br",life:3e3});return}else{g.value=!0;const r=q("token"),{data:o,pending:w}=await re(`${L.public.apiUrl}/roles/update/${m.value}`,{method:"POST",headers:{Authorization:`Bearer ${r.value}`},body:{name:b.value,permissions:i.value}},"$AftFLbfnYe");((s=o.value)==null?void 0:s.code)===200?($.value=!1,g.value=!1,M("closeEditModal",!1),_.add({severity:"success",summary:"Success",detail:"Role updated successfully!",group:"br",life:3e3})):(g.value=!1,_.add({severity:"error",summary:"Error",detail:"Failed to update role!",group:"br",life:3e3}))}};return ee(async()=>{B();const s=document.getElementById("editTeamName");ne(()=>{s&&s.focus()})}),(s,r)=>{const o=Q,w=ae,A=ie,h=J;return p(),y("div",null,[l("div",Ue,[Me,d(o,{id:"editTeamName",disabled:e(b)==="Admin",modelValue:e(b),"onUpdate:modelValue":r[0]||(r[0]=a=>R(b)?b.value=a:null),class:"w-full",placeholder:"Edit role name"},null,8,["disabled","modelValue"])]),Be,l("div",Le,[(p(!0),y(j,null,D(e(u),a=>(p(),y("div",{key:a.group.id},[l("div",Fe,[l("div",Ae,[l("div",je,[d(w,{modelValue:e(v),"onUpdate:modelValue":r[1]||(r[1]=t=>R(v)?v.value=t:null),value:a.group.id,onChange:t=>F(a)},null,8,["modelValue","value","onChange"]),l("label",De,O(a.group.name),1)])]),l("div",Oe,[(p(!0),y(j,null,D(a.children,t=>(p(),y("div",{key:t.id,class:"flex align-items-center"},[d(w,{modelValue:e(i),"onUpdate:modelValue":r[2]||(r[2]=S=>R(i)?i.value=S:null),inputId:t.id,value:t.id},null,8,["modelValue","inputId","value"]),l("label",{for:t.id,class:"ml-2"},O(t.name),9,We)]))),128))])]),d(A)]))),128))]),l("div",Ge,[d(h,{disabled:e(b)==="Admin",label:"Update",icon:"pi pi-check",loading:e(g),text:"",onClick:c},null,8,["disabled","loading"])])])}}},qe=fe(ze,[["__scopeId","data-v-047b5113"]]);const Ke={key:0,class:"card"},Xe=l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"User Role")],-1),Ye=l("i",{class:"pi pi-search"},null,-1),He=l("p",{class:"text-center"},"No Data found...",-1),Je={style:{display:"flex","flex-wrap":"wrap",gap:"5px"}},At={__name:"index",setup(V){const U=te(),L=n(H("read_role")),k=n(H("create_role")),_=n(H("update_role")),m=n(),b=n(!0);Z();const u=n(!1),i=n(!1),v=n([]),$=n([]),g=n([]),M=n(""),B=n(""),F=a=>{u.value=!1,o()},c=a=>{i.value=!1,o()},s=()=>{u.value=!0,o()},r=a=>{var S;i.value=!0,M.value=a.id,B.value=a.name,$.value=$.value;let t=[];((S=a==null?void 0:a.permissions)==null?void 0:S.length)>0&&a.permissions.map(P=>{$.value.map(C=>{P.id===C.id&&t.push({id:C.id})})}),g.value=t.map(P=>P.id),console.log("sPp",ye(g.value))},o=async()=>{var C,I,E;const a=q("token"),{data:t,pending:S,error:P}=await se("roleList",()=>$fetch(`${U.public.apiUrl}/roles/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((I=(C=t.value)==null?void 0:C.data)==null?void 0:I.length)>0&&(v.value=(E=t.value)==null?void 0:E.data.map((N,T)=>({...N,index:T+1})))},w=n([]),A=async()=>{var C,I,E;const a=q("token"),{data:t,pending:S,error:P}=await se("permissionList",()=>$fetch(`${U.public.apiUrl}/permissions/list`,{headers:{Authorization:`Bearer ${a.value}`}}));((I=(C=t.value)==null?void 0:C.data)==null?void 0:I.length)>0&&($.value=(E=t.value)==null?void 0:E.data.map((N,T)=>({...N,index:T+1})),w.value=Object.entries(t.value.group).map(([N,T],X)=>({group:{name:N,id:X+1},children:T.map(W=>({id:W.id,name:W.name}))})),console.log(w.value))},h=()=>{m.value={global:{value:null,matchMode:ge.CONTAINS}}};return ee(()=>{o(),A(),b.value=!1}),h(),(a,t)=>{const S=ue,P=J,C=ce,I=Q,E=me,N=pe,T=ve,X=Te,W=qe;return e(L)?(p(),y("div",Ke,[d(S,{position:"bottom-right",group:"br"}),Xe,d(N,{class:"border-0 px-0"},{start:x(()=>[e(k)?(p(),Y(P,{key:0,icon:"pi pi-plus",label:"Create",onClick:s,class:"mr-2",severity:"secondary"})):G("",!0)]),end:x(()=>[d(E,{iconPosition:"right",raised:""},{default:x(()=>[d(C,null,{default:x(()=>[Ye]),_:1}),d(I,{modelValue:e(m).global.value,"onUpdate:modelValue":t[0]||(t[0]=f=>e(m).global.value=f),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})]),_:1}),d(e(xe),{filters:e(m),"onUpdate:filters":t[1]||(t[1]=f=>R(m)?m.value=f:null),class:"table-stR",value:e(v),stripedRows:"",paginator:"",tableStyle:"min-width: 50rem",rows:15,rowsPerPageOptions:[10,15,20,50],dataKey:"id",filterDisplay:"menu",loading:e(b)},{empty:x(()=>[He]),loading:x(()=>[d(T,{style:{width:"50px",height:"50px"}})]),default:x(()=>[d(e(z),{field:"index",header:"Serial",sortable:""}),d(e(z),{style:{"text-wrap":"nowrap"},field:"name",header:"Role Name"}),d(e(z),{field:"permissions",header:"Permission"},{body:x(f=>[l("div",Je,[(p(!0),y(j,null,D(f.data.permissions,le=>(p(),y("div",{class:"border rounded",key:a.permission,style:{border:"1px solid rgba(167, 167, 167, 0.486)","border-radius":"5px",padding:"2px 5px"}},[l("p",null,O(le.name),1)]))),128))])]),_:1}),d(e(z),{field:"action",header:"Action"},{body:x(f=>[e(_)?(p(),Y(P,{key:0,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",onClick:le=>r(f.data)},null,8,["onClick"])):G("",!0),e(_)?G("",!0):(p(),Y(P,{key:1,icon:"pi pi-pencil",text:"",class:"mr-2",severity:"success",rounded:"",style:{visibility:"hidden"}}))]),_:1})]),_:1},8,["filters","value","loading"]),d(e(oe),{visible:e(u),"onUpdate:visible":t[3]||(t[3]=f=>R(u)?u.value=f:null),modal:"",header:"Create Role",dismissableMask:"true",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[d(X,{param:{permissionsList:e($),groupPermissions:e(w)},onCloseCreateModal:t[2]||(t[2]=f=>F(f))},null,8,["param"])]),_:1},8,["visible"]),d(e(oe),{visible:e(i),"onUpdate:visible":t[5]||(t[5]=f=>R(i)?i.value=f:null),modal:"",header:"Edit Role",dismissableMask:"true",style:{width:"38rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:x(()=>[d(W,{param:{id:e(M),name:e(B),permissionsList:e($),groupPermissions:e(w),slctdPermissions:e(g)},onCloseEditModal:t[4]||(t[4]=f=>c(f))},null,8,["param"])]),_:1},8,["visible"])])):G("",!0)}}};export{At as default};
