import M from"./toast.esm.d842993e.js";import R from"./multiselect.esm.99ce2362.js";import U from"./calendar.esm.f3a196ce.js";import G from"./button.esm.9b4b1887.js";import Y from"./toolbar.esm.ac97789a.js";import z from"./column.esm.94912f90.js";import A from"./datatable.esm.50801007.js";import O from"./tabpanel.esm.9f7f26f3.js";import W from"./tabview.esm.b1510684.js";import{a2 as H,a3 as L,$ as b,a4 as q,b as T,l as e,w as v,o as C,i as l,u as _,a7 as $,e as J,a8 as K,a9 as Q,ca as X}from"./entry.46470eb9.js";import{u as V}from"./fetch.4cfb7fd9.js";import{u as F}from"./cookie.7154b123.js";import{u as Z}from"./workCompany.a70f2bf3.js";import"./radiobutton.esm.82eab427.js";import"./portal.esm.3f8ef478.js";import"./basecomponent.esm.ae1894d8.js";import"./index.esm.731f0653.js";import"./baseicon.esm.17c13817.js";import"./index.esm.80a15596.js";import"./index.esm.4bd6b6f1.js";import"./index.esm.ea39f55c.js";import"./checkbox.esm.7e6cea9a.js";import"./index.esm.8c191e48.js";import"./index.esm.00ae83f4.js";import"./index.esm.09f18abe.js";import"./overlayeventbus.esm.362d8f7d.js";import"./virtualscroller.esm.28e05953.js";import"./index.esm.01233409.js";import"./index.esm.0fc36935.js";import"./index.esm.a3ab836e.js";import"./badge.esm.d2d36dc3.js";import"./paginator.esm.1479ca34.js";import"./index.esm.1c015d97.js";import"./dropdown.esm.1f53e962.js";import"./inputnumber.esm.38749b41.js";import"./index.esm.295abb01.js";import"./index.esm.68717131.js";import"./inputtext.esm.3c27d15f.js";import"./index.esm.8e711a3c.js";import"./index.esm.75014c5c.js";import"./index.esm.4f3bbff9.js";import"./index.esm.19ea0197.js";const h=y=>(K("data-v-10953739"),y=y(),Q(),y),ee={class:"card"},te=h(()=>l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"Project Reports")],-1)),ae={class:"card"},oe=h(()=>l("div",{class:"d-flex mr-2"},[l("h5",{class:"mb-1"},"Task Reports")],-1)),le={class:"flex gap-2 flex-wrap align-items-center"},se={class:"user-selection w-full md:w-14rem w-full"},re=h(()=>l("label",{class:"font-bold block mb-2"},"Project:",-1)),ne={class:"flex justify-content-center"},ie={class:"flex-auto"},de=h(()=>l("label",{for:"icondisplay",class:"font-bold block mb-2"},"From: ",-1)),ce={class:"flex-auto"},ue=h(()=>l("label",{for:"icondisplay",class:"font-bold block mb-2"},"To: ",-1)),pe={key:0,class:"card"},me={class:"flex align-items-center justify-content-between gap-2 mb-5"},fe=h(()=>l("h5",{class:"m-0"},"Preview",-1)),_e=h(()=>l("p",{class:"text-center"},"No Data found...",-1)),ve={__name:"index",setup(y){const{totalProjects:I}=L(Z()),j=X(),s=b(""),r=b(""),d=b(),x=b(null),g=b(!1),D=b(!1),k=q(),S=c=>{const a=c,o=new Date(a),n=o.getFullYear(),i=String(o.getMonth()+1).padStart(2,"0"),m=String(o.getDate()).padStart(2,"0");return`${n}-${i}-${m}`},B=async()=>{var f,t;if(s.value&&!r.value||!s.value&&r.value)return g.value=!1,k.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const c=F("token");g.value=!0;const a=S(s.value),o=S(r.value);let n;d.value&&d.value.length>0&&(n=(f=d.value)==null?void 0:f.map(u=>u.id),console.log("Project ID",n)),s.value&&r.value&&(formData.append("start_date",a),formData.append("end_date",o));const{data:i,error:m}=await V(`${j.public.apiUrl}/projects/report-view?project_ids=${n||""}?start_date=${s.value?a:""}?end_date=${r.value?o:""}`,{method:"GET",headers:{Authorization:`Bearer ${c.value}`}},"$tkCbN62YMP");return((t=i.value)==null?void 0:t.code)==200?(x.value=i.value.data.map((u,w)=>({...u,index:w+1})),g.value=!1):(g.value=!1,k.add({severity:"error",summary:"Failed",detail:"Failed to generate!",group:"br",life:3e3}))},N=async()=>{var f;const c=F("token");if(D.value=!0,s.value&&!r.value||!s.value&&r.value)return g.value=!1,k.add({severity:"warn",summary:"Warning",detail:"Please Select Both Dates",group:"br",life:3e3});const a=S(s.value),o=S(r.value),n=new FormData;if(d.value&&d.value.length>0){const t=(f=d.value)==null?void 0:f.map(u=>u.id);console.log("Project ID",t),t.length>0&&t.forEach(u=>{n.append("project_id[]",u)})}s.value&&r.value&&(n.append("start_due_date",a),n.append("end_due_date",o));const{data:i,error:m}=await V(`${j.public.apiUrl}/project-wise-task-report-download`,{method:"POST",headers:{Authorization:`Bearer ${c.value}`},body:n},"$tccjGN5izh");if(m.value)return console.log(m),D.value=!1;if(i.value.code==200){const t=document.createElement("a");return t.href=i.value.download_path,t.target="_blank",t.click(),D.value=!1}else return D.value=!1,k.add({severity:"error",summary:"Failed",detail:"Failed to download",group:"br",life:3e3})},P=(c,a)=>{const o=new Date(a);c=="startDate"?s.value=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate():r.value=o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()};return(c,a)=>{const o=M,n=R,i=U,m=G,f=Y,t=z,u=A,w=O,E=W;return C(),T("div",ee,[e(o,{position:"bottom-right",group:"br"}),te,e(E,{onTabChange:c.onTabChange,class:"mt-3"},{default:v(()=>[e(w,{class:"file-upload",header:"Project Report"},{default:v(()=>[l("div",ae,[e(o,{position:"bottom-right",group:"br"}),oe,e(f,{class:"border-0 px-0"},{start:v(()=>[l("div",le,[l("div",se,[re,l("div",ne,[e(n,{display:"chip",modelValue:_(d),"onUpdate:modelValue":a[0]||(a[0]=p=>$(d)?d.value=p:null),options:_(I),filter:"",resetFilterOnHide:"",optionLabel:"name",placeholder:"Select Project",class:"w-full"},null,8,["modelValue","options"])])]),l("div",ie,[de,e(i,{modelValue:_(s),"onUpdate:modelValue":a[1]||(a[1]=p=>$(s)?s.value=p:null),onDateSelect:a[2]||(a[2]=p=>P("startDate",p)),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])]),l("div",ce,[ue,e(i,{modelValue:_(r),"onUpdate:modelValue":a[3]||(a[3]=p=>$(r)?r.value=p:null),onDateSelect:a[4]||(a[4]=p=>P("endtDate",p)),showIcon:"",iconDisplay:"input",inputId:"icondisplay"},null,8,["modelValue"])])])]),end:v(()=>[e(m,{onClick:B,class:"w-full",label:"Generate",loading:_(g)},null,8,["loading"])]),_:1})]),_(x)?(C(),T("div",pe,[l("div",null,[l("div",me,[fe,e(m,{onClick:N,class:"w-fit",label:"Download",loading:_(D)},null,8,["loading"])]),e(u,{value:_(x),tableStyle:"min-width: 50rem"},{empty:v(()=>[_e]),default:v(()=>[e(t,{field:"index",header:"Serial",sortable:""}),e(t,{field:"task_name",style:{width:"40%"},header:"Task Name"}),e(t,{field:"project_name",header:"Project Name"}),e(t,{field:"task_status",header:"Status"}),e(t,{field:"task_due_date",header:"Due Date"}),e(t,{field:"task_date_done",header:"Date Done"}),e(t,{field:"duration",header:"Duration"}),e(t,{field:"unit",header:"Unit"}),e(t,{field:"overdue",header:"Missed Deadlines"})]),_:1},8,["value"])])])):J("",!0)]),_:1}),e(w,{header:"Specific Monthly Summary"}),e(w,{header:"Executive Summary"},{default:v(()=>[e(f,{class:"border-0 px-0"})]),_:1})]),_:1},8,["onTabChange"])])}}},st=H(ve,[["__scopeId","data-v-10953739"]]);export{st as default};
